import{j as P}from"./jsx-runtime-AgcCsxC8.js";import{r as Z}from"./index-XiNr8FW2.js";import{g as Yn,c as Te}from"./_commonjsHelpers-5-cIlDoe.js";import{H as eo,i as an}from"./Header-txUrkSlq.js";import{S as to}from"./sidebar-GdxJuyHK.js";const Tn="/_partitionKey",p={HttpHeaders:{Authorization:"authorization",ETag:"etag",MethodOverride:"X-HTTP-Method",Slug:"Slug",ContentType:"Content-Type",LastModified:"Last-Modified",ContentEncoding:"Content-Encoding",CharacterSet:"CharacterSet",UserAgent:"User-Agent",IfModifiedSince:"If-Modified-Since",IfMatch:"If-Match",IfNoneMatch:"If-None-Match",ContentLength:"Content-Length",AcceptEncoding:"Accept-Encoding",KeepAlive:"Keep-Alive",CacheControl:"Cache-Control",TransferEncoding:"Transfer-Encoding",ContentLanguage:"Content-Language",ContentLocation:"Content-Location",ContentMd5:"Content-Md5",ContentRange:"Content-Range",Accept:"Accept",AcceptCharset:"Accept-Charset",AcceptLanguage:"Accept-Language",IfRange:"If-Range",IfUnmodifiedSince:"If-Unmodified-Since",MaxForwards:"Max-Forwards",ProxyAuthorization:"Proxy-Authorization",AcceptRanges:"Accept-Ranges",ProxyAuthenticate:"Proxy-Authenticate",RetryAfter:"Retry-After",SetCookie:"Set-Cookie",WwwAuthenticate:"Www-Authenticate",Origin:"Origin",Host:"Host",AccessControlAllowOrigin:"Access-Control-Allow-Origin",AccessControlAllowHeaders:"Access-Control-Allow-Headers",KeyValueEncodingFormat:"application/x-www-form-urlencoded",WrapAssertionFormat:"wrap_assertion_format",WrapAssertion:"wrap_assertion",WrapScope:"wrap_scope",SimpleToken:"SWT",HttpDate:"date",Prefer:"Prefer",Location:"Location",Referer:"referer",A_IM:"A-IM",Query:"x-ms-documentdb-query",IsQuery:"x-ms-documentdb-isquery",IsQueryPlan:"x-ms-cosmos-is-query-plan-request",SupportedQueryFeatures:"x-ms-cosmos-supported-query-features",QueryVersion:"x-ms-cosmos-query-version",Continuation:"x-ms-continuation",ContinuationToken:"x-ms-continuation-token",PageSize:"x-ms-max-item-count",ItemCount:"x-ms-item-count",ActivityId:"x-ms-activity-id",PreTriggerInclude:"x-ms-documentdb-pre-trigger-include",PreTriggerExclude:"x-ms-documentdb-pre-trigger-exclude",PostTriggerInclude:"x-ms-documentdb-post-trigger-include",PostTriggerExclude:"x-ms-documentdb-post-trigger-exclude",IndexingDirective:"x-ms-indexing-directive",SessionToken:"x-ms-session-token",ConsistencyLevel:"x-ms-consistency-level",XDate:"x-ms-date",CollectionPartitionInfo:"x-ms-collection-partition-info",CollectionServiceInfo:"x-ms-collection-service-info",RetryAfterInMilliseconds:"x-ms-retry-after-ms",RetryAfterInMs:"x-ms-retry-after-ms",IsFeedUnfiltered:"x-ms-is-feed-unfiltered",ResourceTokenExpiry:"x-ms-documentdb-expiry-seconds",EnableScanInQuery:"x-ms-documentdb-query-enable-scan",EmitVerboseTracesInQuery:"x-ms-documentdb-query-emit-traces",EnableCrossPartitionQuery:"x-ms-documentdb-query-enablecrosspartition",ParallelizeCrossPartitionQuery:"x-ms-documentdb-query-parallelizecrosspartitionquery",ResponseContinuationTokenLimitInKB:"x-ms-documentdb-responsecontinuationtokenlimitinkb",PopulateQueryMetrics:"x-ms-documentdb-populatequerymetrics",QueryMetrics:"x-ms-documentdb-query-metrics",PopulateIndexMetrics:"x-ms-cosmos-populateindexmetrics",IndexUtilization:"x-ms-cosmos-index-utilization",Version:"x-ms-version",OwnerFullName:"x-ms-alt-content-path",OwnerId:"x-ms-content-path",PartitionKey:"x-ms-documentdb-partitionkey",PartitionKeyRangeID:"x-ms-documentdb-partitionkeyrangeid",StartEpk:"x-ms-start-epk",EndEpk:"x-ms-end-epk",ReadFeedKeyType:"x-ms-read-key-type",MaxEntityCount:"x-ms-root-entity-max-count",CurrentEntityCount:"x-ms-root-entity-current-count",CollectionQuotaInMb:"x-ms-collection-quota-mb",CollectionCurrentUsageInMb:"x-ms-collection-usage-mb",MaxMediaStorageUsageInMB:"x-ms-max-media-storage-usage-mb",CurrentMediaStorageUsageInMB:"x-ms-media-storage-usage-mb",RequestCharge:"x-ms-request-charge",PopulateQuotaInfo:"x-ms-documentdb-populatequotainfo",MaxResourceQuota:"x-ms-resource-quota",OfferType:"x-ms-offer-type",OfferThroughput:"x-ms-offer-throughput",AutoscaleSettings:"x-ms-cosmos-offer-autopilot-settings",DisableRUPerMinuteUsage:"x-ms-documentdb-disable-ru-per-minute-usage",IsRUPerMinuteUsed:"x-ms-documentdb-is-ru-per-minute-used",OfferIsRUPerMinuteThroughputEnabled:"x-ms-offer-is-ru-per-minute-throughput-enabled",IndexTransformationProgress:"x-ms-documentdb-collection-index-transformation-progress",LazyIndexingProgress:"x-ms-documentdb-collection-lazy-indexing-progress",IsUpsert:"x-ms-documentdb-is-upsert",SubStatus:"x-ms-substatus",EnableScriptLogging:"x-ms-documentdb-script-enable-logging",ScriptLogResults:"x-ms-documentdb-script-log-results",ALLOW_MULTIPLE_WRITES:"x-ms-cosmos-allow-tentative-writes",IsBatchRequest:"x-ms-cosmos-is-batch-request",IsBatchAtomic:"x-ms-cosmos-batch-atomic",BatchContinueOnError:"x-ms-cosmos-batch-continue-on-error",DedicatedGatewayPerRequestCacheStaleness:"x-ms-dedicatedgateway-max-age",ForceRefresh:"x-ms-force-refresh",PriorityLevel:"x-ms-cosmos-priority-level"},WritableLocations:"writableLocations",ReadableLocations:"readableLocations",LocationUnavailableExpirationTimeInMs:5*60*1e3,ENABLE_MULTIPLE_WRITABLE_LOCATIONS:"enableMultipleWriteLocations",DefaultUnavailableLocationExpirationTimeMS:5*60*1e3,ThrottleRetryCount:"x-ms-throttle-retry-count",ThrottleRetryWaitTimeInMs:"x-ms-throttle-retry-wait-time-ms",CurrentVersion:"2020-07-15",AzureNamespace:"Azure.Cosmos",AzurePackageName:"@azure/cosmos",SDKName:"azure-cosmos-js",SDKVersion:"4.0.0",CosmosDbDiagnosticLevelEnvVarName:"AZURE_COSMOSDB_DIAGNOSTICS_LEVEL",DefaultMaxBulkRequestBodySizeInBytes:220201,Quota:{CollectionSize:"collectionSize"},Path:{Root:"/",DatabasesPathSegment:"dbs",CollectionsPathSegment:"colls",UsersPathSegment:"users",DocumentsPathSegment:"docs",PermissionsPathSegment:"permissions",StoredProceduresPathSegment:"sprocs",TriggersPathSegment:"triggers",UserDefinedFunctionsPathSegment:"udfs",ConflictsPathSegment:"conflicts",AttachmentsPathSegment:"attachments",PartitionKeyRangesPathSegment:"pkranges",SchemasPathSegment:"schemas",OffersPathSegment:"offers",TopologyPathSegment:"topology",DatabaseAccountPathSegment:"databaseaccount"},PartitionKeyRange:{MinInclusive:"minInclusive",MaxExclusive:"maxExclusive",Id:"id"},QueryRangeConstants:{MinInclusive:"minInclusive",MaxExclusive:"maxExclusive",min:"min"},EffectiveParitionKeyConstants:{MinimumInclusiveEffectivePartitionKey:"",MaximumExclusiveEffectivePartitionKey:"FF"},EffectivePartitionKeyConstants:{MinimumInclusiveEffectivePartitionKey:"",MaximumExclusiveEffectivePartitionKey:"FF"}};var x;(function(n){n.none="",n.database="dbs",n.offer="offers",n.user="users",n.permission="permissions",n.container="colls",n.conflicts="conflicts",n.sproc="sprocs",n.udf="udfs",n.trigger="triggers",n.item="docs",n.pkranges="pkranges",n.partitionkey="partitionKey"})(x||(x={}));var z;(function(n){n.get="GET",n.patch="PATCH",n.post="POST",n.put="PUT",n.delete="DELETE"})(z||(z={}));var E;(function(n){n.Create="create",n.Replace="replace",n.Upsert="upsert",n.Delete="delete",n.Read="read",n.Query="query",n.Execute="execute",n.Batch="batch",n.Patch="patch"})(E||(E={}));var Er;(function(n){n.PrimaryMaster="PRIMARY_MASTER",n.SecondaryMaster="SECONDARY_MASTER",n.PrimaryReadOnly="PRIMARY_READONLY",n.SecondaryReadOnly="SECONDARY_READONLY"})(Er||(Er={}));var vr;(function(n){n.Item="ITEM",n.StoredProcedure="STORED_PROCEDURE",n.UserDefinedFunction="USER_DEFINED_FUNCTION",n.Trigger="TRIGGER"})(vr||(vr={}));var Ar;(function(n){n[n.ScopeAccountReadValue=1]="ScopeAccountReadValue",n[n.ScopeAccountListDatabasesValue=2]="ScopeAccountListDatabasesValue",n[n.ScopeDatabaseReadValue=4]="ScopeDatabaseReadValue",n[n.ScopeDatabaseReadOfferValue=8]="ScopeDatabaseReadOfferValue",n[n.ScopeDatabaseListContainerValue=16]="ScopeDatabaseListContainerValue",n[n.ScopeContainerReadValue=32]="ScopeContainerReadValue",n[n.ScopeContainerReadOfferValue=64]="ScopeContainerReadOfferValue",n[n.ScopeAccountCreateDatabasesValue=1]="ScopeAccountCreateDatabasesValue",n[n.ScopeAccountDeleteDatabasesValue=2]="ScopeAccountDeleteDatabasesValue",n[n.ScopeDatabaseDeleteValue=4]="ScopeDatabaseDeleteValue",n[n.ScopeDatabaseReplaceOfferValue=8]="ScopeDatabaseReplaceOfferValue",n[n.ScopeDatabaseCreateContainerValue=16]="ScopeDatabaseCreateContainerValue",n[n.ScopeDatabaseDeleteContainerValue=32]="ScopeDatabaseDeleteContainerValue",n[n.ScopeContainerReplaceValue=64]="ScopeContainerReplaceValue",n[n.ScopeContainerDeleteValue=128]="ScopeContainerDeleteValue",n[n.ScopeContainerReplaceOfferValue=256]="ScopeContainerReplaceOfferValue",n[n.ScopeAccountReadAllAccessValue=65535]="ScopeAccountReadAllAccessValue",n[n.ScopeDatabaseReadAllAccessValue=124]="ScopeDatabaseReadAllAccessValue",n[n.ScopeContainersReadAllAccessValue=96]="ScopeContainersReadAllAccessValue",n[n.ScopeAccountWriteAllAccessValue=65535]="ScopeAccountWriteAllAccessValue",n[n.ScopeDatabaseWriteAllAccessValue=508]="ScopeDatabaseWriteAllAccessValue",n[n.ScopeContainersWriteAllAccessValue=448]="ScopeContainersWriteAllAccessValue",n[n.ScopeContainerExecuteQueriesValue=1]="ScopeContainerExecuteQueriesValue",n[n.ScopeContainerReadFeedsValue=2]="ScopeContainerReadFeedsValue",n[n.ScopeContainerReadStoredProceduresValue=4]="ScopeContainerReadStoredProceduresValue",n[n.ScopeContainerReadUserDefinedFunctionsValue=8]="ScopeContainerReadUserDefinedFunctionsValue",n[n.ScopeContainerReadTriggersValue=16]="ScopeContainerReadTriggersValue",n[n.ScopeContainerReadConflictsValue=32]="ScopeContainerReadConflictsValue",n[n.ScopeItemReadValue=64]="ScopeItemReadValue",n[n.ScopeStoredProcedureReadValue=128]="ScopeStoredProcedureReadValue",n[n.ScopeUserDefinedFunctionReadValue=256]="ScopeUserDefinedFunctionReadValue",n[n.ScopeTriggerReadValue=512]="ScopeTriggerReadValue",n[n.ScopeContainerCreateItemsValue=1]="ScopeContainerCreateItemsValue",n[n.ScopeContainerReplaceItemsValue=2]="ScopeContainerReplaceItemsValue",n[n.ScopeContainerUpsertItemsValue=4]="ScopeContainerUpsertItemsValue",n[n.ScopeContainerDeleteItemsValue=8]="ScopeContainerDeleteItemsValue",n[n.ScopeContainerCreateStoredProceduresValue=16]="ScopeContainerCreateStoredProceduresValue",n[n.ScopeContainerReplaceStoredProceduresValue=32]="ScopeContainerReplaceStoredProceduresValue",n[n.ScopeContainerDeleteStoredProceduresValue=64]="ScopeContainerDeleteStoredProceduresValue",n[n.ScopeContainerExecuteStoredProceduresValue=128]="ScopeContainerExecuteStoredProceduresValue",n[n.ScopeContainerCreateTriggersValue=256]="ScopeContainerCreateTriggersValue",n[n.ScopeContainerReplaceTriggersValue=512]="ScopeContainerReplaceTriggersValue",n[n.ScopeContainerDeleteTriggersValue=1024]="ScopeContainerDeleteTriggersValue",n[n.ScopeContainerCreateUserDefinedFunctionsValue=2048]="ScopeContainerCreateUserDefinedFunctionsValue",n[n.ScopeContainerReplaceUserDefinedFunctionsValue=4096]="ScopeContainerReplaceUserDefinedFunctionsValue",n[n.ScopeContainerDeleteUserDefinedFunctionSValue=8192]="ScopeContainerDeleteUserDefinedFunctionSValue",n[n.ScopeContainerDeleteCONFLICTSValue=16384]="ScopeContainerDeleteCONFLICTSValue",n[n.ScopeItemReplaceValue=65536]="ScopeItemReplaceValue",n[n.ScopeItemUpsertValue=131072]="ScopeItemUpsertValue",n[n.ScopeItemDeleteValue=262144]="ScopeItemDeleteValue",n[n.ScopeStoredProcedureReplaceValue=1048576]="ScopeStoredProcedureReplaceValue",n[n.ScopeStoredProcedureDeleteValue=2097152]="ScopeStoredProcedureDeleteValue",n[n.ScopeStoredProcedureExecuteValue=4194304]="ScopeStoredProcedureExecuteValue",n[n.ScopeUserDefinedFunctionReplaceValue=8388608]="ScopeUserDefinedFunctionReplaceValue",n[n.ScopeUserDefinedFunctionDeleteValue=16777216]="ScopeUserDefinedFunctionDeleteValue",n[n.ScopeTriggerReplaceValue=33554432]="ScopeTriggerReplaceValue",n[n.ScopeTriggerDeleteValue=67108864]="ScopeTriggerDeleteValue",n[n.ScopeContainerReadAllAccessValue=4294967295]="ScopeContainerReadAllAccessValue",n[n.ScopeItemReadAllAccessValue=65]="ScopeItemReadAllAccessValue",n[n.ScopeContainerWriteAllAccessValue=4294967295]="ScopeContainerWriteAllAccessValue",n[n.ScopeItemWriteAllAccessValue=458767]="ScopeItemWriteAllAccessValue",n[n.NoneValue=0]="NoneValue"})(Ar||(Ar={}));var _r;(function(n){n[n.ContainerCreateItems=1]="ContainerCreateItems",n[n.ContainerReplaceItems=2]="ContainerReplaceItems",n[n.ContainerUpsertItems=4]="ContainerUpsertItems",n[n.ContainerDeleteItems=128]="ContainerDeleteItems",n[n.ContainerExecuteQueries=1]="ContainerExecuteQueries",n[n.ContainerReadFeeds=2]="ContainerReadFeeds",n[n.ContainerCreateStoreProcedure=16]="ContainerCreateStoreProcedure",n[n.ContainerReadStoreProcedure=4]="ContainerReadStoreProcedure",n[n.ContainerReplaceStoreProcedure=32]="ContainerReplaceStoreProcedure",n[n.ContainerDeleteStoreProcedure=64]="ContainerDeleteStoreProcedure",n[n.ContainerCreateTriggers=256]="ContainerCreateTriggers",n[n.ContainerReadTriggers=16]="ContainerReadTriggers",n[n.ContainerReplaceTriggers=512]="ContainerReplaceTriggers",n[n.ContainerDeleteTriggers=1024]="ContainerDeleteTriggers",n[n.ContainerCreateUserDefinedFunctions=2048]="ContainerCreateUserDefinedFunctions",n[n.ContainerReadUserDefinedFunctions=8]="ContainerReadUserDefinedFunctions",n[n.ContainerReplaceUserDefinedFunctions=4096]="ContainerReplaceUserDefinedFunctions",n[n.ContainerDeleteUserDefinedFunctions=8192]="ContainerDeleteUserDefinedFunctions",n[n.ContainerExecuteStoredProcedure=128]="ContainerExecuteStoredProcedure",n[n.ContainerReadConflicts=32]="ContainerReadConflicts",n[n.ContainerDeleteConflicts=16384]="ContainerDeleteConflicts",n[n.ContainerReadAny=64]="ContainerReadAny",n[n.ContainerFullAccess=4294967295]="ContainerFullAccess",n[n.ItemReadAny=65536]="ItemReadAny",n[n.ItemFullAccess=65]="ItemFullAccess",n[n.ItemRead=64]="ItemRead",n[n.ItemReplace=65536]="ItemReplace",n[n.ItemUpsert=131072]="ItemUpsert",n[n.ItemDelete=262144]="ItemDelete",n[n.StoreProcedureRead=128]="StoreProcedureRead",n[n.StoreProcedureReplace=1048576]="StoreProcedureReplace",n[n.StoreProcedureDelete=2097152]="StoreProcedureDelete",n[n.StoreProcedureExecute=4194304]="StoreProcedureExecute",n[n.UserDefinedFuntionRead=256]="UserDefinedFuntionRead",n[n.UserDefinedFuntionReplace=8388608]="UserDefinedFuntionReplace",n[n.UserDefinedFuntionDelete=16777216]="UserDefinedFuntionDelete",n[n.TriggerRead=512]="TriggerRead",n[n.TriggerReplace=33554432]="TriggerReplace",n[n.TriggerDelete=67108864]="TriggerDelete"})(_r||(_r={}));const Ri=new RegExp("^[/]+"),bi=new RegExp("[/]+$"),no=new RegExp("[/\\\\?#]"),ro=new RegExp("[/\\\\#]");function io(n){return JSON.stringify(n).replace(/[\u007F-\uFFFF]/g,e=>"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4))}function Ir(n){if(n.length===0)return{type:void 0,objectBody:void 0};n[n.length-1]!=="/"&&(n=n+"/"),n[0]!=="/"&&(n="/"+n);const e=n.split("/");let t,r;return e.length%2===0?(t=e[e.length-2],r=e[e.length-3]):(t=e[e.length-3],r=e[e.length-2]),{type:r,objectBody:{id:t,self:n}}}function ht(n){return n===E.Read||n===E.Query}function so(n){return new Promise(e=>{setTimeout(()=>{e()},n)})}function cn(n){return n.split("/").slice(0,4).join("/")}function Ci(n,e){return Ve(n)+e}function Ve(n){return n.replace(Ri,"").replace(bi,"")}function oo(n){const e=[];let t=0;const r=()=>{throw new Error("Path "+n+" is invalid at index "+t)},i=()=>{const o=n[t];let a=++t;for(;a=n.indexOf(o,a),a===-1&&r(),n[a-1]==="\\";)++a;const c=n.substr(t,a-t);return t=a+1,c},s=()=>{const o=n.indexOf("/",t);let a=null;return o===-1?(a=n.substr(t),t=n.length):(a=n.substr(t,o-t),t=o),a=a.trim(),a};for(;t<n.length&&(n[t]!=="/"&&r(),++t!==n.length);)n[t]==='"'||n[t]==="'"?e.push(i()):e.push(s());return e}function V(n,e){if(n.id){if(typeof n.id!="string")return e.message="Id must be a string.",!1;if(n.id.indexOf("/")!==-1||n.id.indexOf("\\")!==-1||n.id.indexOf("?")!==-1||n.id.indexOf("#")!==-1)return e.message="Id contains illegal chars.",!1;if(n.id[n.id.length-1]===" ")return e.message="Id ends with a space.",!1}return!0}function En(n,e){if(n.id){if(typeof n.id!="string")return e.message="Id must be a string.",!1;if(n.id.indexOf("/")!==-1||n.id.indexOf("\\")!==-1||n.id.indexOf("#")!==-1)return e.message="Id contains illegal chars.",!1}return!0}function v(n){return n=Ve(n),n}function T(n,e){return n=Ve(n),e?"/"+encodeURI(n)+"/"+e:"/"+encodeURI(n)}function Ti(n){return!n||/^\s*$/.test(n)}function Ee(n){if(typeof n!="string")throw new Error("invalid input: input is not string");return n.replace(Ri,"").replace(bi,"")}function Be(n){if(typeof n!="string"||Ti(n))throw new Error("Resource ID must be a string and cannot be undefined, null or empty");if(no.test(n))throw new Error("Illegal characters ['/', '\\', '#', '?'] cannot be used in Resource ID");return!0}function ao(n){if(typeof n!="string"||Ti(n))throw new Error("Resource ID must be a string and cannot be undefined, null or empty");if(ro.test(n))throw new Error("Illegal characters ['/', '\\', '#'] cannot be used in Resource ID");return!0}function co(n){if(!n||typeof n!="string")return null;const t=Ee(n).split("/");return t.length%2!==0?null:t[t.length-1]}function uo(n){const e=n.split(";"),{AccountEndpoint:t,AccountKey:r}=e.reduce((i,s)=>{const[o,...a]=s.split("=");return i[o]=a.join("="),i},{});if(!t||!r)throw new Error("Could not parse the provided connection string");return{endpoint:t,key:r}}const F={Ok:200,Created:201,Accepted:202,NoContent:204,NotModified:304,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,RequestTimeout:408,Conflict:409,Gone:410,PreconditionFailed:412,RequestEntityTooLarge:413,TooManyRequests:429,RetryWith:449,InternalServerError:500,ServiceUnavailable:503,ENOTFOUND:"ENOTFOUND",OperationPaused:1200,OperationCancelled:1201},Le={Unknown:0,CrossPartitionQueryNotServable:1004,PartitionKeyRangeGone:1002,CompletingSplit:1007,ReadSessionNotAvailable:1002,WriteForbidden:3,DatabaseAccountNotFound:1008};function Xn(n){return n=Ee(n),Be(n),p.Path.DatabasesPathSegment+"/"+n}function yt(n,e){return e=Ee(e),Be(e),Xn(n)+"/"+p.Path.CollectionsPathSegment+"/"+e}function Ei(n,e){return e=Ee(e),Be(e),Xn(n)+"/"+p.Path.UsersPathSegment+"/"+e}function lo(n,e,t){return t=Ee(t),ao(t),yt(n,e)+"/"+p.Path.DocumentsPathSegment+"/"+t}function ho(n,e,t){return t=Ee(t),Be(t),Ei(n,e)+"/"+p.Path.PermissionsPathSegment+"/"+t}function fo(n,e,t){return t=Ee(t),Be(t),yt(n,e)+"/"+p.Path.StoredProceduresPathSegment+"/"+t}function po(n,e,t){return t=Ee(t),Be(t),yt(n,e)+"/"+p.Path.TriggersPathSegment+"/"+t}function go(n,e,t){return t=Ee(t),Be(t),yt(n,e)+"/"+p.Path.UserDefinedFunctionsPathSegment+"/"+t}function vi(n){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}function mo(n){if(typeof btoa!="function")throw new Error("Your browser environment is missing the global `btoa` function");let e="";const t=new Uint8Array(n),r=t.byteLength;for(let i=0;i<r;i++)e+=String.fromCharCode(t[i]);return btoa(e)}let Ut;const Tt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",yo=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;typeof atob!="function"?Ut=n=>{if(n=String(n).replace(/[\t\n\f\r ]+/g,""),!yo.test(n))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");n+="==".slice(2-(n.length&3));let e,t="",r,i,s=0;for(;s<n.length;)e=Tt.indexOf(n.charAt(s++))<<18|Tt.indexOf(n.charAt(s++))<<12|(r=Tt.indexOf(n.charAt(s++)))<<6|(i=Tt.indexOf(n.charAt(s++))),t+=r===64?String.fromCharCode(e>>16&255):i===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,e&255);return t}:Ut=atob;const vn=typeof self>"u"?window:self;if(!vn)throw new Error("Could not find global");const ft=vn.crypto||vn.msCrypto;if(!ft||!ft.subtle)throw new Error("Browser does not support cryptography functions");async function wo(n,e){const t={name:"HMAC",hash:{name:"SHA-256"}},r=new Uint8Array([...unescape(encodeURIComponent(e))].map(a=>a.charCodeAt(0))),i=vi(Ut(n)),s=await ft.subtle.importKey("raw",i,t,!1,["sign"]),o=await ft.subtle.sign(t,s,r);return mo(o)}async function xo(n,e,t=x.none,r="",i=new Date){if(n.startsWith("type=sas&"))return{[p.HttpHeaders.Authorization]:encodeURIComponent(n),[p.HttpHeaders.XDate]:i.toUTCString()};const s=await Ro(n,e,t,r,i);return{[p.HttpHeaders.Authorization]:s,[p.HttpHeaders.XDate]:i.toUTCString()}}async function Ro(n,e,t,r="",i=new Date){const s="master",o="1.0",a=e.toLowerCase()+`
`+t.toLowerCase()+`
`+r+`
`+i.toUTCString().toLowerCase()+`

`,c=await wo(n,a);return encodeURIComponent("type="+s+"&ver="+o+"&sig="+c)}async function bo(n,e,t,r,i,s){if(n.permissionFeed){n.resourceTokens={};for(const o of n.permissionFeed){const a=co(o.resource);if(!a)throw new Error(`authorization error: ${a}                           is an invalid resourceId in permissionFeed`);n.resourceTokens[a]=o._token}}n.key?await Co(e,r,i,s,n.key):n.resourceTokens?s[p.HttpHeaders.Authorization]=encodeURIComponent(To(n.resourceTokens,t,r)):n.tokenProvider&&(s[p.HttpHeaders.Authorization]=encodeURIComponent(await n.tokenProvider({verb:e,path:t,resourceId:r,resourceType:i,headers:s})))}async function Co(n,e,t,r,i){t===x.offer&&(e=e&&e.toLowerCase()),r=Object.assign(r,await xo(i,n,t,e))}function To(n,e,t){if(n&&Object.keys(n).length>0){if(!e&&!t)return n[Object.keys(n)[0]];if(t&&n[t])return n[t];if(!e||e.length<4)return null;e=Ee(e);const r=e&&e.split("/")||[];if(r.length===6){const s=r.slice(0,4).map(decodeURIComponent).join("/");if(n[s])return n[s]}let i=r.length%2===0?r.length-1:r.length-2;for(;i>0;i-=2){const s=decodeURI(r[i]);if(n[s])return n[s]}}return null}function Eo(...n){if(n.length>0){const e=String(n[0]);e.includes(":error")?console.error(...n):e.includes(":warning")?console.warn(...n):e.includes(":info")?console.info(...n):e.includes(":verbose")?console.debug(...n):console.debug(...n)}}var Dr={};const Pr=typeof process<"u"&&Dr&&Dr.DEBUG||void 0;let Ai,An=[],_n=[];const Ft=[];Pr&&Zn(Pr);const Ge=Object.assign(n=>_i(n),{enable:Zn,enabled:Jn,disable:vo,log:Eo});function Zn(n){Ai=n,An=[],_n=[];const e=/\*/g,t=n.split(",").map(r=>r.trim().replace(e,".*?"));for(const r of t)r.startsWith("-")?_n.push(new RegExp(`^${r.substr(1)}$`)):An.push(new RegExp(`^${r}$`));for(const r of Ft)r.enabled=Jn(r.namespace)}function Jn(n){if(n.endsWith("*"))return!0;for(const e of _n)if(e.test(n))return!1;for(const e of An)if(e.test(n))return!0;return!1}function vo(){const n=Ai||"";return Zn(""),n}function _i(n){const e=Object.assign(t,{enabled:Jn(n),destroy:Ao,log:Ge.log,namespace:n,extend:_o});function t(...r){e.enabled&&(r.length>0&&(r[0]=`${n} ${r[0]}`),e.log(...r))}return Ft.push(e),e}function Ao(){const n=Ft.indexOf(this);return n>=0?(Ft.splice(n,1),!0):!1}function _o(n){const e=_i(`${this.namespace}:${n}`);return e.log=this.log,e}var Sr={};const Ii=new Set,Et=typeof process<"u"&&Sr&&Sr.AZURE_LOG_LEVEL||void 0;let In;const Dn=Ge("azure");Dn.log=(...n)=>{Ge.log(...n)};const er=["verbose","info","warning","error"];Et&&(Si(Et)?Io(Et):console.error(`AZURE_LOG_LEVEL set to unknown log level '${Et}'; logging is not enabled. Acceptable values: ${er.join(", ")}.`));function Io(n){if(n&&!Si(n))throw new Error(`Unknown log level '${n}'. Acceptable values: ${er.join(",")}`);In=n;const e=[];for(const t of Ii)Pi(t)&&e.push(t.namespace);Ge.enable(e.join(","))}const Mr={verbose:400,info:300,warning:200,error:100};function He(n){const e=Dn.extend(n);return Di(Dn,e),{error:vt(e,"error"),warning:vt(e,"warning"),info:vt(e,"info"),verbose:vt(e,"verbose")}}function Di(n,e){e.log=(...t)=>{n.log(...t)}}function vt(n,e){const t=Object.assign(n.extend(e),{level:e});if(Di(n,t),Pi(t)){const r=Ge.disable();Ge.enable(r+","+t.namespace)}return Ii.add(t),t}function Pi(n){return!!(In&&Mr[n.level]<=Mr[In])}function Si(n){return er.includes(n)}var Pn;(function(n){n[n.Gateway=0]="Gateway"})(Pn||(Pn={}));const Or=Object.freeze({connectionMode:Pn.Gateway,requestTimeout:6e4,enableEndpointDiscovery:!0,preferredLocations:[],retryOptions:{maxRetryAttemptCount:9,fixedRetryIntervalInMilliseconds:0,maxWaitTimeInSeconds:30},useMultipleWriteLocations:!0,endpointRefreshRateInMs:3e5,enableBackgroundEndpointRefreshing:!0});var Nt;(function(n){n.Strong="Strong",n.BoundedStaleness="BoundedStaleness",n.Session="Session",n.Eventual="Eventual",n.ConsistentPrefix="ConsistentPrefix"})(Nt||(Nt={}));class Do{get DatabasesLink(){return this.databasesLink}get MediaLink(){return this.mediaLink}get MaxMediaStorageUsageInMB(){return this.maxMediaStorageUsageInMB}get CurrentMediaStorageUsageInMB(){return this.currentMediaStorageUsageInMB}get ConsistencyPolicy(){return this.consistencyPolicy}constructor(e,t){this.writableLocations=[],this.readableLocations=[],this.databasesLink="/dbs/",this.mediaLink="/media/",this.maxMediaStorageUsageInMB=t[p.HttpHeaders.MaxMediaStorageUsageInMB],this.currentMediaStorageUsageInMB=t[p.HttpHeaders.CurrentMediaStorageUsageInMB],this.consistencyPolicy=e.userConsistencyPolicy?e.userConsistencyPolicy.defaultConsistencyLevel:Nt.Session,e[p.WritableLocations]&&e.id!=="localhost"&&(this.writableLocations=e[p.WritableLocations]),e[p.ReadableLocations]&&e.id!=="localhost"&&(this.readableLocations=e[p.ReadableLocations]),e[p.ENABLE_MULTIPLE_WRITABLE_LOCATIONS]&&(this.enableMultipleWritableLocations=e[p.ENABLE_MULTIPLE_WRITABLE_LOCATIONS]===!0||e[p.ENABLE_MULTIPLE_WRITABLE_LOCATIONS]==="true")}}const ze={},Sn=null;function tr(n){return Array.isArray(n)?n.map(e=>e===void 0?ze:e):[n]}var Mn;(function(n){n[n.V1=1]="V1",n[n.V2=2]="V2"})(Mn||(Mn={}));var ut;(function(n){n.Hash="Hash",n.MultiHash="MultiHash"})(ut||(ut={}));const Lr=He("extractPartitionKey");function pt(n,e){if(e&&e.paths&&e.paths.length>0){if(e.systemKey===!0)return[];if(e.paths.length===1&&e.paths[0]===Tn)return[kr(Tn,n)];const t=[];return e.paths.forEach(r=>{const i=kr(r,n);if(i===void 0){Lr.warning("Unsupported PartitionKey found.");return}t.push(i)}),t}Lr.error("Unexpected Partition Key Definition Found.")}function kr(n,e){const t=oo(n);for(const r of t)if(typeof e=="object"&&e!==null&&r in e)e=e[r];else{e=void 0;break}if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(e===Sn)return Sn;if(e===void 0||JSON.stringify(e)===JSON.stringify(ze))return ze}function qt(n){return n.systemKey===!0?[]:n.paths.map(()=>ze)}var At,Po=new Uint8Array(16);function So(){if(!At&&(At=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!At))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return At(Po)}const Mo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Oo(n){return typeof n=="string"&&Mo.test(n)}var Q=[];for(var un=0;un<256;++un)Q.push((un+256).toString(16).substr(1));function Lo(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Q[n[e+0]]+Q[n[e+1]]+Q[n[e+2]]+Q[n[e+3]]+"-"+Q[n[e+4]]+Q[n[e+5]]+"-"+Q[n[e+6]]+Q[n[e+7]]+"-"+Q[n[e+8]]+Q[n[e+9]]+"-"+Q[n[e+10]]+Q[n[e+11]]+Q[n[e+12]]+Q[n[e+13]]+Q[n[e+14]]+Q[n[e+15]]).toLowerCase();if(!Oo(t))throw TypeError("Stringified UUID is invalid");return t}function wt(n,e,t){n=n||{};var r=n.random||(n.rng||So)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return Lo(r)}function On(n,e){if(n!==void 0)return n;throw new Error(e||"Unexpected 'undefined' value encountered")}function nr(n){return ko(n)||Ho(n)||Uo(n)}function ko(n){return typeof n=="string"||typeof n=="boolean"||typeof n=="number"}function Ho(n){return n!==void 0&&JSON.stringify(n)===JSON.stringify(ze)}function Uo(n){return n===Sn}function Hr(n){return nr(n)||Array.isArray(n)}const Fo=He("cosmosdb");function No(n){return JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function rr(n){return typeof n=="object"?No(n):n}const Ur="application/json";async function qo({clientOptions:n,defaultHeaders:e,verb:t,path:r,resourceId:i,resourceType:s,options:o={},partitionKeyRangeId:a,useMultipleWriteLocations:c,partitionKey:l}){const u=Object.assign({[p.HttpHeaders.ResponseContinuationTokenLimitInKB]:1,[p.HttpHeaders.EnableCrossPartitionQuery]:!0},e);return c&&(u[p.HttpHeaders.ALLOW_MULTIPLE_WRITES]=!0),o.continuationTokenLimitInKB&&(u[p.HttpHeaders.ResponseContinuationTokenLimitInKB]=o.continuationTokenLimitInKB),o.continuationToken?u[p.HttpHeaders.Continuation]=o.continuationToken:o.continuation&&(u[p.HttpHeaders.Continuation]=o.continuation),o.preTriggerInclude&&(u[p.HttpHeaders.PreTriggerInclude]=o.preTriggerInclude.constructor===Array?o.preTriggerInclude.join(","):o.preTriggerInclude),o.postTriggerInclude&&(u[p.HttpHeaders.PostTriggerInclude]=o.postTriggerInclude.constructor===Array?o.postTriggerInclude.join(","):o.postTriggerInclude),o.offerType&&(u[p.HttpHeaders.OfferType]=o.offerType),o.offerThroughput&&(u[p.HttpHeaders.OfferThroughput]=o.offerThroughput),o.maxItemCount&&(u[p.HttpHeaders.PageSize]=o.maxItemCount),o.accessCondition&&(o.accessCondition.type==="IfMatch"?u[p.HttpHeaders.IfMatch]=o.accessCondition.condition:u[p.HttpHeaders.IfNoneMatch]=o.accessCondition.condition),o.useIncrementalFeed&&(u[p.HttpHeaders.A_IM]="Incremental Feed"),o.indexingDirective&&(u[p.HttpHeaders.IndexingDirective]=o.indexingDirective),o.consistencyLevel&&(u[p.HttpHeaders.ConsistencyLevel]=o.consistencyLevel),o.priorityLevel&&(u[p.HttpHeaders.PriorityLevel]=o.priorityLevel),o.maxIntegratedCacheStalenessInMs&&s===x.item&&(typeof o.maxIntegratedCacheStalenessInMs=="number"?u[p.HttpHeaders.DedicatedGatewayPerRequestCacheStaleness]=o.maxIntegratedCacheStalenessInMs.toString():(Fo.error(`RangeError: maxIntegratedCacheStalenessInMs "${o.maxIntegratedCacheStalenessInMs}" is not a valid parameter.`),u[p.HttpHeaders.DedicatedGatewayPerRequestCacheStaleness]="null")),o.resourceTokenExpirySeconds&&(u[p.HttpHeaders.ResourceTokenExpiry]=o.resourceTokenExpirySeconds),o.sessionToken&&(u[p.HttpHeaders.SessionToken]=o.sessionToken),o.enableScanInQuery&&(u[p.HttpHeaders.EnableScanInQuery]=o.enableScanInQuery),o.populateQuotaInfo&&(u[p.HttpHeaders.PopulateQuotaInfo]=o.populateQuotaInfo),o.populateQueryMetrics&&(u[p.HttpHeaders.PopulateQueryMetrics]=o.populateQueryMetrics),o.maxDegreeOfParallelism!==void 0&&(u[p.HttpHeaders.ParallelizeCrossPartitionQuery]=!0),o.populateQuotaInfo&&(u[p.HttpHeaders.PopulateQuotaInfo]=!0),l!==void 0&&!u[p.HttpHeaders.PartitionKey]&&(u[p.HttpHeaders.PartitionKey]=io(l)),(n.key||n.tokenProvider)&&(u[p.HttpHeaders.XDate]=new Date().toUTCString()),(t===z.post||t===z.put)&&(u[p.HttpHeaders.ContentType]||(u[p.HttpHeaders.ContentType]=Ur)),u[p.HttpHeaders.Accept]||(u[p.HttpHeaders.Accept]=Ur),a!==void 0&&(u[p.HttpHeaders.PartitionKeyRangeID]=a),o.enableScriptLogging&&(u[p.HttpHeaders.EnableScriptLogging]=o.enableScriptLogging),o.disableRUPerMinuteUsage&&(u[p.HttpHeaders.DisableRUPerMinuteUsage]=!0),o.populateIndexMetrics&&(u[p.HttpHeaders.PopulateIndexMetrics]=o.populateIndexMetrics),(n.key||n.resourceTokens||n.tokenProvider||n.permissionFeed)&&await bo(n,t,r,i,s,u),u}const Mi=wt;function zo(n,e,t){const r=t.localeCompare(n)>=0,i=t.localeCompare(e)<0;return r&&i}const Re={Create:"Create",Upsert:"Upsert",Read:"Read",Delete:"Delete",Replace:"Replace",Patch:"Patch"};function jo(n,e,t={}){Bo(n,t);let r;if(Object.prototype.hasOwnProperty.call(n,"partitionKey"))n.partitionKey===void 0?r=e.paths.map(()=>ze):r=tr(n.partitionKey);else switch(n.operationType){case Re.Create:case Re.Replace:case Re.Upsert:r=On(pt(n.resourceBody,e),"Unexpected undefined Partition Key Found.");break;case Re.Read:case Re.Delete:case Re.Patch:r=e.paths.map(()=>ze)}return{operation:Object.assign(Object.assign({},n),{partitionKey:JSON.stringify(r)}),partitionKey:r}}function Bo(n,e){(n.operationType===Re.Create||n.operationType===Re.Upsert)&&(n.resourceBody.id===void 0||n.resourceBody.id==="")&&!e.disableAutomaticIdGeneration&&(n.resourceBody.id=Mi())}function Ko(n){if((n==null?void 0:n.operations)===void 0||n.operations.length<1)return[];let e=Fr(n.operations[0]),t=Object.assign(Object.assign({},n),{operations:[n.operations[0]],indexes:[n.indexes[0]]});const r=[];r.push(t);for(let i=1;i<n.operations.length;i++){const s=n.operations[i],o=Fr(s);e+o>p.DefaultMaxBulkRequestBodySizeInBytes&&(t=Object.assign(Object.assign({},n),{operations:[],indexes:[]}),r.push(t),e=0),t.operations.push(s),t.indexes.push(n.indexes[i]),e+=o}return r}function Fr(n){return new TextEncoder().encode(rr(n)).length}function Wo(n,e={}){return(n.operationType===Re.Create||n.operationType===Re.Upsert)&&(n.resourceBody.id===void 0||n.resourceBody.id==="")&&!e.disableAutomaticIdGeneration&&(n.resourceBody.id=Mi()),n}class j extends Error{}class ee{constructor(e,t,r,i,s){this.resource=e,this.headers=t,this.statusCode=r,this.diagnostics=i,this.substatus=s}get requestCharge(){return Number(this.headers[p.HttpHeaders.RequestCharge])||0}get activityId(){return this.headers[p.HttpHeaders.ActivityId]}get etag(){return this.headers[p.HttpHeaders.ETag]}}class ke{constructor(e){this.requestCharge=e}add(...e){let t=this.requestCharge;for(const r of e){if(r==null)throw new Error("clientSideMetrics has null or undefined item(s)");t+=r.requestCharge}return new ke(t)}static createFromArray(...e){if(e==null)throw new Error("clientSideMetricsArray is null or undefined item(s)");return this.zero.add(...e)}}ke.zero=new ke(0);const D={RetrievedDocumentCount:"retrievedDocumentCount",RetrievedDocumentSize:"retrievedDocumentSize",OutputDocumentCount:"outputDocumentCount",OutputDocumentSize:"outputDocumentSize",IndexHitRatio:"indexUtilizationRatio",IndexHitDocumentCount:"indexHitDocumentCount",TotalQueryExecutionTimeInMs:"totalExecutionTimeInMs",QueryCompileTimeInMs:"queryCompileTimeInMs",LogicalPlanBuildTimeInMs:"queryLogicalPlanBuildTimeInMs",PhysicalPlanBuildTimeInMs:"queryPhysicalPlanBuildTimeInMs",QueryOptimizationTimeInMs:"queryOptimizationTimeInMs",IndexLookupTimeInMs:"indexLookupTimeInMs",DocumentLoadTimeInMs:"documentLoadTimeInMs",VMExecutionTimeInMs:"VMExecutionTimeInMs",DocumentWriteTimeInMs:"writeOutputTimeInMs",QueryEngineTimes:"queryEngineTimes",SystemFunctionExecuteTimeInMs:"systemFunctionExecuteTimeInMs",UserDefinedFunctionExecutionTimeInMs:"userFunctionExecuteTimeInMs",RetrievedDocumentCountText:"Retrieved Document Count",RetrievedDocumentSizeText:"Retrieved Document Size",OutputDocumentCountText:"Output Document Count",OutputDocumentSizeText:"Output Document Size",IndexUtilizationText:"Index Utilization",TotalQueryExecutionTimeText:"Total Query Execution Time",QueryPreparationTimesText:"Query Preparation Times",QueryCompileTimeText:"Query Compilation Time",LogicalPlanBuildTimeText:"Logical Plan Build Time",PhysicalPlanBuildTimeText:"Physical Plan Build Time",QueryOptimizationTimeText:"Query Optimization Time",QueryEngineTimesText:"Query Engine Times",IndexLookupTimeText:"Index Lookup Time",DocumentLoadTimeText:"Document Load Time",WriteOutputTimeText:"Document Write Time",RuntimeExecutionTimesText:"Runtime Execution Times",TotalExecutionTimeText:"Query Engine Execution Time",SystemFunctionExecuteTimeText:"System Function Execution Time",UserDefinedFunctionExecutionTimeText:"User-defined Function Execution Time",ClientSideQueryMetricsText:"Client Side Metrics",RetriesText:"Retry Count",RequestChargeText:"Request Charge",FetchExecutionRangesText:"Partition Execution Timeline",SchedulingMetricsText:"Scheduling Metrics"},qe=1e4,Qo=1/qe,ir=qe*1e3,$o=1/ir,Oi=ir*60,Vo=1/Oi,sr=Oi*60,Go=1/sr,Li=sr*24,Yo=1/Li,ki=1e3,Hi=ki*60,Ui=Hi*60,Xo=Ui*24,Nr=Number.MAX_SAFE_INTEGER/qe,qr=Number.MIN_SAFE_INTEGER/qe;class _{constructor(e,t,r,i,s){if(!Number.isInteger(e))throw new Error("days is not an integer");if(!Number.isInteger(t))throw new Error("hours is not an integer");if(!Number.isInteger(r))throw new Error("minutes is not an integer");if(!Number.isInteger(i))throw new Error("seconds is not an integer");if(!Number.isInteger(s))throw new Error("milliseconds is not an integer");const o=(e*3600*24+t*3600+r*60+i)*1e3+s;if(o>Nr||o<qr)throw new Error("Total number of milliseconds was either too large or too small");this._ticks=o*qe}add(e){if(_.additionDoesOverflow(this._ticks,e._ticks))throw new Error("Adding the two timestamps causes an overflow.");const t=this._ticks+e._ticks;return _.fromTicks(t)}subtract(e){if(_.subtractionDoesUnderflow(this._ticks,e._ticks))throw new Error("Subtracting the two timestamps causes an underflow.");const t=this._ticks-e._ticks;return _.fromTicks(t)}compareTo(e){if(e==null)return 1;if(!_.isTimeSpan(e))throw new Error("Argument must be a TimeSpan object");return _.compare(this,e)}duration(){return _.fromTicks(this._ticks>=0?this._ticks:-this._ticks)}equals(e){return _.isTimeSpan(e)?this._ticks===e._ticks:!1}negate(){return _.fromTicks(-this._ticks)}days(){return Math.floor(this._ticks/Li)}hours(){return Math.floor(this._ticks/sr)}milliseconds(){return Math.floor(this._ticks/qe)}seconds(){return Math.floor(this._ticks/ir)}ticks(){return this._ticks}totalDays(){return this._ticks*Yo}totalHours(){return this._ticks*Go}totalMilliseconds(){return this._ticks*Qo}totalMinutes(){return this._ticks*Vo}totalSeconds(){return this._ticks*$o}static fromTicks(e){const t=new _(0,0,0,0,0);return t._ticks=e,t}static isTimeSpan(e){return e._ticks}static additionDoesOverflow(e,t){const r=e+t;return e!==r-t||t!==r-e}static subtractionDoesUnderflow(e,t){const r=e-t;return e!==r+t||t!==e-r}static compare(e,t){return e._ticks>t._ticks?1:e._ticks<t._ticks?-1:0}static interval(e,t){if(isNaN(e))throw new Error("value must be a number");const r=e*t;if(r>Nr||r<qr)throw new Error("timespan too long");return _.fromTicks(Math.floor(r*qe))}static fromMilliseconds(e){return _.interval(e,1)}static fromSeconds(e){return _.interval(e,ki)}static fromMinutes(e){return _.interval(e,Hi)}static fromHours(e){return _.interval(e,Ui)}static fromDays(e){return _.interval(e,Xo)}}_.zero=new _(0,0,0,0,0);_.maxValue=_.fromTicks(Number.MAX_SAFE_INTEGER);_.minValue=_.fromTicks(Number.MIN_SAFE_INTEGER);function or(n){if(n==null)throw new Error("delimitedString is null or undefined");const e={},t=n.split(";");for(const r of t){const i=r.split("=");if(i.length!==2)throw new Error("recieved a malformed delimited string");const s=i[0],o=parseFloat(i[1]);e[s]=o}return e}function Y(n,e){return e in n?_.fromMilliseconds(n[e]):_.zero}class _e{constructor(e,t,r,i){this.queryCompilationTime=e,this.logicalPlanBuildTime=t,this.physicalPlanBuildTime=r,this.queryOptimizationTime=i}add(...e){let t=this.queryCompilationTime,r=this.logicalPlanBuildTime,i=this.physicalPlanBuildTime,s=this.queryOptimizationTime;for(const o of e){if(o==null)throw new Error("queryPreparationTimesArray has null or undefined item(s)");t=t.add(o.queryCompilationTime),r=r.add(o.logicalPlanBuildTime),i=i.add(o.physicalPlanBuildTime),s=s.add(o.queryOptimizationTime)}return new _e(t,r,i,s)}toDelimitedString(){return`${D.QueryCompileTimeInMs}=${this.queryCompilationTime.totalMilliseconds()};${D.LogicalPlanBuildTimeInMs}=${this.logicalPlanBuildTime.totalMilliseconds()};${D.PhysicalPlanBuildTimeInMs}=${this.physicalPlanBuildTime.totalMilliseconds()};${D.QueryOptimizationTimeInMs}=${this.queryOptimizationTime.totalMilliseconds()}`}static createFromArray(e){if(e==null)throw new Error("queryPreparationTimesArray is null or undefined item(s)");return _e.zero.add(...e)}static createFromDelimitedString(e){const t=or(e);return new _e(Y(t,D.QueryCompileTimeInMs),Y(t,D.LogicalPlanBuildTimeInMs),Y(t,D.PhysicalPlanBuildTimeInMs),Y(t,D.QueryOptimizationTimeInMs))}}_e.zero=new _e(_.zero,_.zero,_.zero,_.zero);class Ie{constructor(e,t,r){this.queryEngineExecutionTime=e,this.systemFunctionExecutionTime=t,this.userDefinedFunctionExecutionTime=r}add(...e){let t=this.queryEngineExecutionTime,r=this.systemFunctionExecutionTime,i=this.userDefinedFunctionExecutionTime;for(const s of e){if(s==null)throw new Error("runtimeExecutionTimes has null or undefined item(s)");t=t.add(s.queryEngineExecutionTime),r=r.add(s.systemFunctionExecutionTime),i=i.add(s.userDefinedFunctionExecutionTime)}return new Ie(t,r,i)}toDelimitedString(){return`${D.SystemFunctionExecuteTimeInMs}=${this.systemFunctionExecutionTime.totalMilliseconds()};${D.UserDefinedFunctionExecutionTimeInMs}=${this.userDefinedFunctionExecutionTime.totalMilliseconds()}`}static createFromArray(e){if(e==null)throw new Error("runtimeExecutionTimesArray is null or undefined item(s)");return Ie.zero.add(...e)}static createFromDelimitedString(e){const t=or(e),r=Y(t,D.VMExecutionTimeInMs),i=Y(t,D.IndexLookupTimeInMs),s=Y(t,D.DocumentLoadTimeInMs),o=Y(t,D.DocumentWriteTimeInMs);let a=_.zero;return a=a.add(r),a=a.subtract(i),a=a.subtract(s),a=a.subtract(o),new Ie(a,Y(t,D.SystemFunctionExecuteTimeInMs),Y(t,D.UserDefinedFunctionExecutionTimeInMs))}}Ie.zero=new Ie(_.zero,_.zero,_.zero);class De{constructor(e,t,r,i,s,o,a,c,l,u,h,f,w){this.retrievedDocumentCount=e,this.retrievedDocumentSize=t,this.outputDocumentCount=r,this.outputDocumentSize=i,this.indexHitDocumentCount=s,this.totalQueryExecutionTime=o,this.queryPreparationTimes=a,this.indexLookupTime=c,this.documentLoadTime=l,this.vmExecutionTime=u,this.runtimeExecutionTimes=h,this.documentWriteTime=f,this.clientSideMetrics=w}get indexHitRatio(){return this.retrievedDocumentCount===0?1:this.indexHitDocumentCount/this.retrievedDocumentCount}add(e){let t=0,r=0,i=0,s=0,o=0,a=_.zero;const c=[];let l=_.zero,u=_.zero,h=_.zero;const f=[];let w=_.zero;const m=[];e.push(this);for(const g of e)g&&(t+=g.retrievedDocumentCount,r+=g.retrievedDocumentSize,i+=g.outputDocumentCount,s+=g.outputDocumentSize,o+=g.indexHitDocumentCount,a=a.add(g.totalQueryExecutionTime),c.push(g.queryPreparationTimes),l=l.add(g.indexLookupTime),u=u.add(g.documentLoadTime),h=h.add(g.vmExecutionTime),f.push(g.runtimeExecutionTimes),w=w.add(g.documentWriteTime),m.push(g.clientSideMetrics));return new De(t,r,i,s,o,a,_e.createFromArray(c),l,u,h,Ie.createFromArray(f),w,ke.createFromArray(...m))}toDelimitedString(){return D.RetrievedDocumentCount+"="+this.retrievedDocumentCount+";"+D.RetrievedDocumentSize+"="+this.retrievedDocumentSize+";"+D.OutputDocumentCount+"="+this.outputDocumentCount+";"+D.OutputDocumentSize+"="+this.outputDocumentSize+";"+D.IndexHitRatio+"="+this.indexHitRatio+";"+D.TotalQueryExecutionTimeInMs+"="+this.totalQueryExecutionTime.totalMilliseconds()+";"+this.queryPreparationTimes.toDelimitedString()+";"+D.IndexLookupTimeInMs+"="+this.indexLookupTime.totalMilliseconds()+";"+D.DocumentLoadTimeInMs+"="+this.documentLoadTime.totalMilliseconds()+";"+D.VMExecutionTimeInMs+"="+this.vmExecutionTime.totalMilliseconds()+";"+this.runtimeExecutionTimes.toDelimitedString()+";"+D.DocumentWriteTimeInMs+"="+this.documentWriteTime.totalMilliseconds()}static createFromArray(e){if(!e)throw new Error("queryMetricsArray is null or undefined item(s)");return De.zero.add(e)}static createFromDelimitedString(e,t){const r=or(e),i=r[D.IndexHitRatio]||0,s=r[D.RetrievedDocumentCount]||0,o=i*s,a=r[D.OutputDocumentCount]||0,c=r[D.OutputDocumentSize]||0,l=r[D.RetrievedDocumentSize]||0,u=Y(r,D.TotalQueryExecutionTimeInMs);return new De(s,l,a,c,o,u,_e.createFromDelimitedString(e),Y(r,D.IndexLookupTimeInMs),Y(r,D.DocumentLoadTimeInMs),Y(r,D.VMExecutionTimeInMs),Ie.createFromDelimitedString(e),Y(r,D.DocumentWriteTimeInMs),t||ke.zero)}}De.zero=new De(0,0,0,0,0,_.zero,_e.zero,_.zero,_.zero,_.zero,Ie.zero,_.zero,ke.zero);function Fi(n){if(typeof n=="number")return n;if(typeof n=="string")return parseFloat(n);if(n){const e=n[p.HttpHeaders.RequestCharge];return e?parseFloat(e):0}else return 0}function B(){const n={};return n[p.HttpHeaders.RequestCharge]=0,n[p.HttpHeaders.QueryMetrics]={},n}function ye(n,e){if(n[p.HttpHeaders.RequestCharge]===void 0&&(n[p.HttpHeaders.RequestCharge]=0),n[p.HttpHeaders.QueryMetrics]===void 0&&(n[p.HttpHeaders.QueryMetrics]=De.zero),!!e){if(n[p.HttpHeaders.RequestCharge]+=Fi(e),e[p.HttpHeaders.IsRUPerMinuteUsed]&&(n[p.HttpHeaders.IsRUPerMinuteUsed]=e[p.HttpHeaders.IsRUPerMinuteUsed]),p.HttpHeaders.QueryMetrics in e){const t=n[p.HttpHeaders.QueryMetrics],r=e[p.HttpHeaders.QueryMetrics];for(const i in r)if(t[i]){const s=t[i].add([r[i]]);t[i]=s}else t[i]=r[i]}p.HttpHeaders.IndexUtilization in e&&(n[p.HttpHeaders.IndexUtilization]=e[p.HttpHeaders.IndexUtilization])}}class de{constructor(e,t,r,i){this.UtilizedSingleIndexes=e,this.PotentialSingleIndexes=t,this.UtilizedCompositeIndexes=r,this.PotentialCompositeIndexes=i}static tryCreateFromDelimitedBase64String(e,t){return e==null?(t.result=de.Empty,!1):de.tryCreateFromDelimitedString(Buffer.from(e,"base64").toString(),t)}static tryCreateFromDelimitedString(e,t){if(e==null)return t.result=de.Empty,!1;try{return t.result=JSON.parse(e)||de.Empty,!0}catch{return t.result=de.Empty,!1}}static createFromString(e,t){var r;const i={result:void 0};return t?de.tryCreateFromDelimitedBase64String(e,i):de.tryCreateFromDelimitedString(e,i),(r=i.result)!==null&&r!==void 0?r:de.Empty}}de.Empty=new de([],[],[],[]);const pe={IndexUtilizationInfo:"Index Utilization Information",UtilizedSingleIndexes:"Utilized Single Indexes",PotentialSingleIndexes:"Potential Single Indexes",UtilizedCompositeIndexes:"Utilized Composite Indexes",PotentialCompositeIndexes:"Potential Composite Indexes",IndexExpression:"Index Spec",IndexImpactScore:"Index Impact Score",IndexUtilizationSeparator:"---"};class Zo{writeIndexMetrics(e){let t="";return t=this.writeBeforeIndexUtilizationInfo(t),t=this.writeIndexUtilizationInfo(t,e),t=this.writeAfterIndexUtilizationInfo(t),t}writeBeforeIndexUtilizationInfo(e){return e=this.appendNewlineToResult(e),e=this.appendHeaderToResult(e,pe.IndexUtilizationInfo,0),e}writeIndexUtilizationInfo(e,t){e=this.appendHeaderToResult(e,pe.UtilizedSingleIndexes,1);for(const r of t.UtilizedSingleIndexes)e=this.writeSingleIndexUtilizationEntity(e,r);e=this.appendHeaderToResult(e,pe.PotentialSingleIndexes,1);for(const r of t.PotentialSingleIndexes)e=this.writeSingleIndexUtilizationEntity(e,r);e=this.appendHeaderToResult(e,pe.UtilizedCompositeIndexes,1);for(const r of t.UtilizedCompositeIndexes)e=this.writeCompositeIndexUtilizationEntity(e,r);e=this.appendHeaderToResult(e,pe.PotentialCompositeIndexes,1);for(const r of t.PotentialCompositeIndexes)e=this.writeCompositeIndexUtilizationEntity(e,r);return e}writeAfterIndexUtilizationInfo(e){return e}writeSingleIndexUtilizationEntity(e,t){return e=this.appendHeaderToResult(e,`${pe.IndexExpression}: ${t.IndexSpec}`,2),e=this.appendHeaderToResult(e,`${pe.IndexImpactScore}: ${t.IndexImpactScore}`,2),e=this.appendHeaderToResult(e,pe.IndexUtilizationSeparator,2),e}writeCompositeIndexUtilizationEntity(e,t){return e=this.appendHeaderToResult(e,`${pe.IndexExpression}: ${t.IndexSpecs.join(", ")}`,2),e=this.appendHeaderToResult(e,`${pe.IndexImpactScore}: ${t.IndexImpactScore}`,2),e=this.appendHeaderToResult(e,pe.IndexUtilizationSeparator,2),e}appendNewlineToResult(e){return this.appendHeaderToResult(e,"",0)}appendHeaderToResult(e,t,r){const s=`${"  ".repeat(r)}${t}
`;return e+=s,e}}class ln{constructor(e,t,r,i){this.resources=e,this.headers=t,this.hasMoreResults=r,this.diagnostics=i}get continuation(){return this.continuationToken}get continuationToken(){return this.headers[p.HttpHeaders.Continuation]}get queryMetrics(){return this.headers[p.HttpHeaders.QueryMetrics]}get requestCharge(){return Fi(this.headers)}get activityId(){return this.headers[p.HttpHeaders.ActivityId]}get indexMetrics(){const e=new Zo,t=de.createFromString(this.headers[p.HttpHeaders.IndexUtilization],!0);return e.writeIndexMetrics(t)}}const gt="TimeoutError";class Jo extends Error{constructor(e="Timeout Error"){super(e),this.code=gt,this.name=gt}}function me(){return Date.now()}class ea{constructor(){this.failedAttempts=[],this.metadataLookups=[],this.gaterwayStatistics=[],this.locationEndpointsContacted=new Set,this.requestStartTimeUTCinMs=me()}recordFailedAttempt(e,t){const r={attemptNumber:t,startTimeUTCInMs:e.startTimeUTCInMs,durationInMs:e.durationInMs,statusCode:e.statusCode,substatusCode:e.subStatusCode,requestPayloadLengthInBytes:e.requestPayloadLengthInBytes,responsePayloadLengthInBytes:e.responsePayloadLengthInBytes,activityId:e.activityId,operationType:e.operationType,resourceType:e.resourceType};this.failedAttempts.push(r)}recordNetworkCall(e){this.gaterwayStatistics.push(e)}mergeDiagnostics(e,t){e.locationEndpointsContacted.forEach(r=>this.locationEndpointsContacted.add(r)),e.gaterwayStatistics.forEach(r=>this.metadataLookups.push({activityId:r.activityId,requestPayloadLengthInBytes:r.requestPayloadLengthInBytes,responsePayloadLengthInBytes:r.responsePayloadLengthInBytes,startTimeUTCInMs:r.startTimeUTCInMs,operationType:r.operationType,resourceType:r.resourceType,durationInMs:r.durationInMs,metaDataType:t})),e.metadataLookups.forEach(r=>this.metadataLookups.push(r)),e.failedAttempts.forEach(r=>this.failedAttempts.push(r))}getClientSideStats(e=me()){return{requestStartTimeUTCInMs:this.requestStartTimeUTCinMs,requestDurationInMs:e-this.requestStartTimeUTCinMs,totalRequestPayloadLengthInBytes:this.getTotalRequestPayloadLength(),totalResponsePayloadLengthInBytes:this.getTotalResponsePayloadLength(),locationEndpointsContacted:[...this.locationEndpointsContacted.values()],metadataDiagnostics:{metadataLookups:[...this.metadataLookups]},retryDiagnostics:{failedAttempts:[...this.failedAttempts]},gatewayStatistics:this.gaterwayStatistics}}getTotalRequestPayloadLength(){let e=0;return this.gaterwayStatistics.forEach(t=>e+=t.requestPayloadLengthInBytes),this.metadataLookups.forEach(t=>e+=t.requestPayloadLengthInBytes),this.failedAttempts.forEach(t=>e+=t.requestPayloadLengthInBytes),e}getTotalResponsePayloadLength(){let e=0;return this.gaterwayStatistics.forEach(t=>e+=t.responsePayloadLengthInBytes),this.metadataLookups.forEach(t=>e+=t.responsePayloadLengthInBytes),this.failedAttempts.forEach(t=>e+=t.responsePayloadLengthInBytes),e}recordEndpointResolution(e){this.locationEndpointsContacted.add(e)}}class Ni{constructor(e,t,r){this.clientSideRequestStatistics=e,this.diagnosticNode=t,this.clientConfig=r}}var Se;(function(n){n.PartitionKeyRangeLookUp="PARTITION_KEY_RANGE_LOOK_UP",n.DatabaseAccountLookUp="DATABASE_ACCOUNT_LOOK_UP",n.QueryPlanLookUp="QUERY_PLAN_LOOK_UP",n.DatabaseLookUp="DATABASE_LOOK_UP",n.ContainerLookUp="CONTAINER_LOOK_UP"})(Se||(Se={}));function qi(n){return n.parent?qi(n.parent):n}var K;(function(n){n.info="info",n.debug="debug",n.debugUnsafe="debug-unsafe"})(K||(K={}));const zr=[K.info,K.debug,K.debugUnsafe];function Ue(n,e){const t=zr.indexOf(n),r=zr.indexOf(e);return t===-1||r===-1?!1:t<=r}class je{constructor(e,t,r,i={},s=me(),o=new ea){this.id=wt(),this.nodeType=t,this.startTimeUTCInMs=s,this.data=i,this.children=[],this.durationInMs=0,this.parent=r,this.diagnosticCtx=o,this.diagnosticLevel=e}addLog(e){this.data.log||(this.data.log=[]),this.data.log.push(e)}sanitizeHeaders(e){return e}updateTimestamp(e=me()){this.durationInMs=e-this.startTimeUTCInMs}recordSuccessfulNetworkCall(e,t,r,i,s){const a={activityId:r.headers.toJSON()[p.HttpHeaders.ActivityId],startTimeUTCInMs:e,durationInMs:me()-e,statusCode:r.status,subStatusCode:i,requestPayloadLengthInBytes:jr(t),responsePayloadLengthInBytes:ta(r),operationType:t.operationType,resourceType:t.resourceType,partitionKeyRangeId:t.partitionKeyRangeId};let c={OperationType:a.operationType,resourceType:a.resourceType,requestPayloadLengthInBytes:a.requestPayloadLengthInBytes};Ue(K.debugUnsafe,this.diagnosticLevel)&&(c=Object.assign(Object.assign({},c),{headers:this.sanitizeHeaders(t.headers),requestBody:t.body,responseBody:r.bodyAsText,url:s})),this.addData({requestPayloadLengthInBytes:a.requestPayloadLengthInBytes,responsePayloadLengthInBytes:a.responsePayloadLengthInBytes,startTimeUTCInMs:a.startTimeUTCInMs,durationInMs:a.durationInMs,requestData:c}),this.diagnosticCtx.recordNetworkCall(a)}recordFailedNetworkCall(e,t,r,i,s,o){this.addData({failedAttempty:!0});const a=jr(t);this.diagnosticCtx.recordFailedAttempt({activityId:o[p.HttpHeaders.ActivityId],startTimeUTCInMs:e,durationInMs:me()-e,statusCode:i,subStatusCode:s,requestPayloadLengthInBytes:a,responsePayloadLengthInBytes:0,operationType:t.operationType,resourceType:t.resourceType},r);let c={OperationType:t.operationType,resourceType:t.resourceType,requestPayloadLengthInBytes:a};Ue(K.debugUnsafe,this.diagnosticLevel)&&(c=Object.assign(Object.assign({},c),{headers:this.sanitizeHeaders(t.headers),requestBody:t.body,url:Ci(t.endpoint,t.path)})),this.addData({failedAttempty:!0,requestData:c})}recordEndpointResolution(e){this.addData({selectedLocation:e}),this.diagnosticCtx.recordEndpointResolution(e)}addData(e,t,r=this.diagnosticLevel){r!==K.info&&(this.data=Object.assign(Object.assign({},this.data),e),t&&this.addLog(t))}addChildNode(e,t,r){return this.diagnosticCtx.mergeDiagnostics(e.diagnosticCtx,r),Ue(t,this.diagnosticLevel)&&(e.parent=this,this.children.push(e)),e}initializeChildNode(e,t,r={}){if(Ue(t,this.diagnosticLevel)){const i=new je(this.diagnosticLevel,e,this,r,me(),this.diagnosticCtx);return this.children.push(i),i}else return this}recordQueryResult(e,t){var r;if(Ue(t,this.diagnosticLevel)){const i=(r=this.data.queryRecordsRead)!==null&&r!==void 0?r:0;Array.isArray(e)&&(this.data.queryRecordsRead=i+e.length)}}toDiagnosticNode(){return{id:this.id,nodeType:this.nodeType,children:this.children.map(e=>e.toDiagnosticNode()),data:this.data,startTimeUTCInMs:this.startTimeUTCInMs,durationInMs:this.durationInMs}}toDiagnostic(e){const t=qi(this),r=Ue(K.debug,this.diagnosticLevel)?t.toDiagnosticNode():void 0,i=Ue(K.debug,this.diagnosticLevel)?e:void 0;return new Ni(this.diagnosticCtx.getClientSideStats(),r,i)}}var te;(function(n){n.CLIENT_REQUEST_NODE="CLIENT_REQUEST_NODE",n.METADATA_REQUEST_NODE="METADATA_REQUEST_NODE",n.HTTP_REQUEST="HTTP_REQUEST",n.BATCH_REQUEST="BATCH_REQUEST",n.PARALLEL_QUERY_NODE="PARALLEL_QUERY_NODE",n.DEFAULT_QUERY_NODE="DEFAULT_QUERY_NODE",n.QUERY_REPAIR_NODE="QUERY_REPAIR_NODE",n.BACKGROUND_REFRESH_THREAD="BACKGROUND_REFRESH_THREAD",n.REQUEST_ATTEMPTS="REQUEST_ATTEMPTS"})(te||(te={}));function ta(n){var e;return((e=n==null?void 0:n.bodyAsText)===null||e===void 0?void 0:e.length)||0}function jr(n){return n.body?n.body.length:0}function ae(n){return this instanceof ae?(this.v=n,this):new ae(n)}function $t(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(w){return new Promise(function(m,g){s.push([f,w,m,g])>1||a(f,w)})})}function a(f,w){try{c(r[f](w))}catch(m){h(s[0][3],m)}}function c(f){f.value instanceof ae?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,w){f(w),s.shift(),s.length&&a(s[0][0],s[0][1])}}function A(){return new Ni({requestDurationInMs:0,requestStartTimeUTCInMs:me(),totalRequestPayloadLengthInBytes:0,totalResponsePayloadLengthInBytes:0,locationEndpointsContacted:[],retryDiagnostics:{failedAttempts:[]},metadataDiagnostics:{metadataLookups:[]},gatewayStatistics:[]},{id:wt(),nodeType:te.CLIENT_REQUEST_NODE,children:[],data:{},startTimeUTCInMs:me(),durationInMs:0})}async function xt(n,e,t,r={}){const i=e.initializeChildNode(t,K.debug,r);try{const s=await n(i);return i.updateTimestamp(),s}catch(s){throw i.addData({failure:!0}),i.updateTimestamp(),s}}async function Ye(n,e,t){const r=new je(e.diagnosticLevel,te.METADATA_REQUEST_NODE,null);try{const i=await n(r);return e.addChildNode(r,K.debug,t),i}catch(i){throw e.addChildNode(r,K.debug,t),i}}async function C(n,e,t=te.CLIENT_REQUEST_NODE){const r=new je(e.diagnosticLevel,t,null);try{const i=await n(r);r.updateTimestamp();const s=r.toDiagnostic(e.getClientConfig());return typeof i=="object"&&i!==null&&(i.diagnostics=s),e.recordDiagnostics(s),i}catch(i){r.updateTimestamp(),r.addData({failure:!0});const s=r.toDiagnostic(e.getClientConfig());throw i.diagnostics=s,e.recordDiagnostics(s),i}}const Br=He("ClientContext");var Ln;(function(n){n.start="start",n.inProgress="inProgress",n.ended="ended"})(Ln||(Ln={}));class ie{get continuation(){return this.continuationToken}constructor(e,t){this.resources=[],this.currentIndex=0,this.currentPartitionIndex=0,this.fetchFunctions=Array.isArray(t)?t:[t],this.options=e||{},this.continuationToken=this.options.continuationToken||this.options.continuation||null,this.state=ie.STATES.start}async nextItem(e){return++this.currentIndex,await this.current(e)}async current(e){if(this.currentIndex<this.resources.length)return{result:this.resources[this.currentIndex],headers:B()};if(this._canFetchMore()){const{result:t,headers:r}=await this.fetchMore(e);return this.resources=t,this.resources.length===0?!this.continuationToken&&this.currentPartitionIndex>=this.fetchFunctions.length?(this.state=ie.STATES.ended,{result:void 0,headers:r}):this.current(e):{result:this.resources[this.currentIndex],headers:r}}else return this.state=ie.STATES.ended,{result:void 0,headers:B()}}hasMoreResults(){return this.state===ie.STATES.start||this.continuationToken!==void 0||this.currentIndex<this.resources.length-1||this.currentPartitionIndex<this.fetchFunctions.length}async fetchMore(e){return xt(async t=>{if(this.currentPartitionIndex>=this.fetchFunctions.length)return{headers:B(),result:void 0};const r=this.options.continuationToken||this.options.continuation;if(this.options.continuationToken=this.continuationToken,this.currentPartitionIndex>=this.fetchFunctions.length)return{headers:B(),result:void 0};let i,s;try{let o;this.nextFetchFunction!==void 0?(Br.verbose("using prefetch"),o=this.nextFetchFunction,this.nextFetchFunction=void 0):(Br.verbose("using fresh fetch"),o=this.fetchFunctions[this.currentPartitionIndex](t,this.options));const a=await o;if(i=a.result,t.recordQueryResult(i,K.debugUnsafe),s=a.headers,this.continuationToken=s[p.HttpHeaders.Continuation],this.continuationToken||++this.currentPartitionIndex,this.options&&this.options.bufferItems===!0){const c=this.fetchFunctions[this.currentPartitionIndex];this.nextFetchFunction=c?c(t,Object.assign(Object.assign({},this.options),{continuationToken:this.continuationToken})):void 0}}catch(o){throw this.state=ie.STATES.ended,o}if(this.state=ie.STATES.inProgress,this.currentIndex=0,this.options.continuationToken=r,this.options.continuation=r,p.HttpHeaders.QueryMetrics in s){const o=s[p.HttpHeaders.QueryMetrics];let a=De.createFromDelimitedString(o);if(p.HttpHeaders.RequestCharge in s){const c=Number(s[p.HttpHeaders.RequestCharge])||0;a=new De(a.retrievedDocumentCount,a.retrievedDocumentSize,a.outputDocumentCount,a.outputDocumentSize,a.indexHitDocumentCount,a.totalQueryExecutionTime,a.queryPreparationTimes,a.indexLookupTime,a.documentLoadTime,a.vmExecutionTime,a.runtimeExecutionTimes,a.documentWriteTime,new ke(c))}s[p.HttpHeaders.QueryMetrics]={},s[p.HttpHeaders.QueryMetrics][0]=a}return{result:i,headers:s}},e,te.DEFAULT_QUERY_NODE,{queryMethodIdentifier:"fetchMore"})}_canFetchMore(){return this.state===ie.STATES.start||this.continuationToken&&this.state===ie.STATES.inProgress||this.currentPartitionIndex<this.fetchFunctions.length&&this.state===ie.STATES.inProgress}}ie.STATES=Ln;class na{aggregate(e){e==null||e.sum==null||(this.sum==null&&(this.sum=0,this.count=0),this.sum+=e.sum,this.count+=e.count)}getResult(){if(!(this.sum==null||this.count<=0))return this.sum/this.count}}class ra{constructor(){this.value=0}aggregate(e){this.value+=e}getResult(){return this.value}}const Ke=Object.freeze({NoValue:{ord:0},undefined:{ord:1},boolean:{ord:2,compFunc:(n,e)=>n===e?0:n>e?1:-1},number:{ord:4,compFunc:(n,e)=>n===e?0:n>e?1:-1},string:{ord:5,compFunc:(n,e)=>n===e?0:n>e?1:-1}});class ar{constructor(e){this.sortOrder=e}targetPartitionKeyRangeDocProdComparator(e,t){const r=e.getTargetParitionKeyRange().minInclusive,i=t.getTargetParitionKeyRange().minInclusive;return r===i?0:r>i?1:-1}compare(e,t){if(e.gotSplit())return-1;if(t.gotSplit())return 1;const r=this.getOrderByItems(e.peekBufferedItems()[0]),i=this.getOrderByItems(t.peekBufferedItems()[0]);this.validateOrderByItems(r,i);for(let s=0;s<r.length;s++){const o=this.compareOrderByItem(r[s],i[s]);if(o!==0){if(this.sortOrder[s]==="Ascending")return o;if(this.sortOrder[s]==="Descending")return-o}}return this.targetPartitionKeyRangeDocProdComparator(e,t)}compareValue(e,t,r,i){if(t==="object"||i==="object")throw new Error("Tried to compare an object type");const s=Ke[t].ord,o=Ke[i].ord,a=s-o;if(a!==0)return a;if(s===Ke.undefined.ord||s===Ke.NoValue.ord)return 0;const c=Ke[t].compFunc;if(typeof c>"u")throw new Error("Cannot find the comparison function");return c(e,r)}compareOrderByItem(e,t){const r=this.getType(e),i=this.getType(t);return this.compareValue(e.item,r,t.item,i)}validateOrderByItems(e,t){if(e.length!==t.length)throw new Error(`Expected ${e.length}, but got ${t.length}.`);if(e.length!==this.sortOrder.length)throw new Error("orderByItems cannot have a different size than sort orders.");for(let r=0;r<this.sortOrder.length;r++){const i=this.getType(e[r]),s=this.getType(t[r]);if(i!==s)throw new Error(`Expected ${i}, but got ${s}. Cannot execute cross partition order-by queries on mixed types. Consider filtering your query using IS_STRING or IS_NUMBER to get around this exception.`)}}getType(e){if(e===void 0||e.item===void 0)return"NoValue";const t=typeof e.item;if(Ke[t]===void 0)throw new Error(`unrecognizable type ${t}`);return t}getOrderByItems(e){return e.orderByItems}}class ia{constructor(){this.value=void 0,this.comparer=new ar(["Ascending"])}aggregate(e){this.value===void 0?this.value=e.max:this.comparer.compareValue(e.max,typeof e.max,this.value,typeof this.value)>0&&(this.value=e.max)}getResult(){return this.value}}class sa{constructor(){this.value=void 0,this.comparer=new ar(["Ascending"])}aggregate(e){if(this.value===void 0)this.value=e.min;else{const t=e.min===null?"NoValue":typeof e.min,r=this.value===null?"NoValue":typeof this.value;this.comparer.compareValue(e.min,t,this.value,r)<0&&(this.value=e.min)}}getResult(){return this.value}}class oa{aggregate(e){e!==void 0&&(this.sum===void 0?this.sum=e:this.sum+=e)}getResult(){return this.sum}}class aa{aggregate(e){this.value===void 0&&(this.value=e)}getResult(){return this.value}}function zi(n){switch(n){case"Average":return new na;case"Count":return new ra;case"Max":return new ia;case"Min":return new sa;case"Sum":return new oa;default:return new aa}}var J;(function(n){n[n.Done=0]="Done",n[n.Exception=1]="Exception",n[n.Result=2]="Result"})(J||(J={}));class Kr{constructor(e,t){e!==void 0?(this.feedResponse=e,this.fetchResultType=J.Result):(this.error=t,this.fetchResultType=J.Exception)}}class zt{constructor(e,t,r,i,s){this.clientContext=e,this.generation=0,this.fetchFunction=async(o,a)=>{const c=T(this.collectionLink,x.item);o.addData({partitionKeyRangeId:this.targetPartitionKeyRange.id});const l=v(this.collectionLink);return this.clientContext.queryFeed({path:c,resourceType:x.item,resourceId:l,resultFn:u=>u.Documents,query:this.query,options:a,diagnosticNode:o,partitionKeyRangeId:this.targetPartitionKeyRange.id})},this.collectionLink=t,this.query=r,this.targetPartitionKeyRange=i,this.fetchResults=[],this.allFetched=!1,this.err=void 0,this.previousContinuationToken=void 0,this.continuationToken=void 0,this.respHeaders=B(),this.internalExecutionContext=new ie(s,this.fetchFunction)}peekBufferedItems(){const e=[];for(let t=0,r=!1;t<this.fetchResults.length&&!r;t++){const i=this.fetchResults[t];switch(i.fetchResultType){case J.Done:r=!0;break;case J.Exception:r=!0;break;case J.Result:e.push(i.feedResponse);break}}return e}hasMoreResults(){return this.internalExecutionContext.hasMoreResults()||this.fetchResults.length!==0}gotSplit(){const e=this.fetchResults[0];return!!(e.fetchResultType===J.Exception&&zt._needPartitionKeyRangeCacheRefresh(e.error))}_getAndResetActiveResponseHeaders(){const e=this.respHeaders;return this.respHeaders=B(),e}_updateStates(e,t){if(e){this.err=e;return}t&&(this.allFetched=!0),this.internalExecutionContext.continuationToken!==this.continuationToken&&(this.previousContinuationToken=this.continuationToken,this.continuationToken=this.internalExecutionContext.continuationToken)}static _needPartitionKeyRangeCacheRefresh(e){return e.code===F.Gone&&"substatus"in e&&e.substatus===Le.PartitionKeyRangeGone}async bufferMore(e){if(this.err)throw this.err;try{const{result:t,headers:r}=await this.internalExecutionContext.fetchMore(e);if(++this.generation,this._updateStates(void 0,t===void 0),t!==void 0&&t.forEach(i=>{this.fetchResults.push(new Kr(i,void 0))}),r!=null&&p.HttpHeaders.QueryMetrics in r){const i=r[p.HttpHeaders.QueryMetrics][0];r[p.HttpHeaders.QueryMetrics]={},r[p.HttpHeaders.QueryMetrics][this.targetPartitionKeyRange.id]=i}return{result:t,headers:r}}catch(t){if(zt._needPartitionKeyRangeCacheRefresh(t)){const r=new Kr(void 0,t);return this.fetchResults.push(r),{result:[r],headers:t.headers}}else throw this._updateStates(t,t.resources===void 0),t}}getTargetParitionKeyRange(){return this.targetPartitionKeyRange}async nextItem(e){if(this.err)throw this._updateStates(this.err,void 0),this.err;try{const{result:t,headers:r}=await this.current(e),i=this.fetchResults.shift();if(this._updateStates(void 0,t===void 0),i.feedResponse!==t)throw new Error(`Expected ${i.feedResponse} to equal ${t}`);switch(i.fetchResultType){case J.Done:return{result:void 0,headers:r};case J.Exception:throw i.error.headers=r,i.error;case J.Result:return{result:i.feedResponse,headers:r}}}catch(t){throw this._updateStates(t,t.item===void 0),t}}async current(e){if(this.fetchResults.length>0){const i=this.fetchResults[0];switch(i.fetchResultType){case J.Done:return{result:void 0,headers:this._getAndResetActiveResponseHeaders()};case J.Exception:throw i.error.headers=this._getAndResetActiveResponseHeaders(),i.error;case J.Result:return{result:i.feedResponse,headers:this._getAndResetActiveResponseHeaders()}}}if(this.allFetched)return{result:void 0,headers:this._getAndResetActiveResponseHeaders()};const{result:t,headers:r}=await this.bufferMore(e);return ye(this.respHeaders,r),t===void 0?{result:void 0,headers:this.respHeaders}:this.current(e)}}var ca=we;function we(n){this._comparator=n||we.DEFAULT_COMPARATOR,this._elements=[]}we.DEFAULT_COMPARATOR=function(n,e){return typeof n=="number"&&typeof e=="number"?n-e:(n=n.toString(),e=e.toString(),n==e?0:n>e?1:-1)};we.prototype.isEmpty=function(){return this.size()===0};we.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]};we.prototype.deq=function(){var n=this.peek(),e=this._elements.pop(),t=this.size();if(t===0)return n;this._elements[0]=e;for(var r=0;r<t;){var i=r,s=2*r+1,o=2*r+2;if(s<t&&this._compare(s,i)>=0&&(i=s),o<t&&this._compare(o,i)>=0&&(i=o),i===r)break;this._swap(i,r),r=i}return n};we.prototype.enq=function(n){for(var e=this._elements.push(n),t=e-1;t>0;){var r=Math.floor((t-1)/2);if(this._compare(t,r)<=0)break;this._swap(r,t),t=r}return e};we.prototype.size=function(){return this._elements.length};we.prototype.forEach=function(n){return this._elements.forEach(n)};we.prototype._compare=function(n,e){return this._comparator(this._elements[n],this._elements[e])};we.prototype._swap=function(n,e){var t=this._elements[n];this._elements[n]=this._elements[e],this._elements[e]=t};const ua=Yn(ca);var ji={exports:{}};(function(n,e){(function(t){var r=function(s){setTimeout(s,0)};typeof process<"u"&&process&&typeof process.nextTick=="function"&&(r=process.nextTick);function i(s){var o={capacity:s||1,current:0,queue:[],firstHere:!1,take:function(){if(o.firstHere===!1){o.current++,o.firstHere=!0;var a=1}else var a=0;var c={n:1};typeof arguments[0]=="function"?c.task=arguments[0]:c.n=arguments[0],arguments.length>=2&&(typeof arguments[1]=="function"?c.task=arguments[1]:c.n=arguments[1]);var l=c.task;if(c.task=function(){l(o.leave)},o.current+c.n-a>o.capacity)return a===1&&(o.current--,o.firstHere=!1),o.queue.push(c);o.current+=c.n-a,c.task(o.leave),a===1&&(o.firstHere=!1)},leave:function(a){if(a=a||1,o.current-=a,!o.queue.length){if(o.current<0)throw new Error("leave called too many times.");return}var c=o.queue[0];c.n+o.current>o.capacity||(o.queue.shift(),o.current+=c.n,r(c.task))},available:function(a){return a=a||1,o.current+a<=o.capacity}};return o}n.exports=i})()})(ji);var la=ji.exports;const Wr=Yn(la);class ce{constructor(e,t,r,i){this.min=e,this.max=t,this.isMinInclusive=r,this.isMaxInclusive=i}overlaps(e){const t=this,r=e;return t===void 0||r===void 0||t.isEmpty()||r.isEmpty()?!1:t.min<=r.max||r.min<=t.max?!(t.min===r.max&&!(t.isMinInclusive&&r.isMaxInclusive)||r.min===t.max&&!(r.isMinInclusive&&t.isMaxInclusive)):!1}isFullRange(){return this.min===p.EffectivePartitionKeyConstants.MinimumInclusiveEffectivePartitionKey&&this.max===p.EffectivePartitionKeyConstants.MaximumExclusiveEffectivePartitionKey&&this.isMinInclusive===!0&&this.isMaxInclusive===!1}isEmpty(){return!(this.isMinInclusive&&this.isMaxInclusive)&&this.min===this.max}static parsePartitionKeyRange(e){return new ce(e[p.PartitionKeyRange.MinInclusive],e[p.PartitionKeyRange.MaxExclusive],!0,!1)}static parseFromDict(e){return new ce(e.min,e.max,e.isMinInclusive,e.isMaxInclusive)}}class da{constructor(e,t){this.orderedPartitionKeyRanges=e,this.orderedRanges=e.map(r=>new ce(r[p.PartitionKeyRange.MinInclusive],r[p.PartitionKeyRange.MaxExclusive],!0,!1)),this.orderedPartitionInfo=t}getOrderedParitionKeyRanges(){return this.orderedPartitionKeyRanges}getOverlappingRanges(e){const t=Array.isArray(e)?e:[e],r={};for(const s of t){if(s.isEmpty())continue;if(s.isFullRange())return this.orderedPartitionKeyRanges;const o=this.orderedRanges.findIndex(c=>{if(s.min>c.min&&s.min<c.max||s.min===c.min||s.min===c.max)return!0});if(o<0)throw new Error("error in collection routing map, queried value is less than the start range.");let a;for(let c=this.orderedRanges.length-1;c>=0;c--){const l=this.orderedRanges[c];if(s.max>l.min&&s.max<l.max){a=c;break}if(s.max===l.min){a=c;break}if(s.max===l.max){a=c;break}}if(a>this.orderedRanges.length)throw new Error("error in collection routing map, queried value is greater than the end range.");for(let c=o;c<a+1;c++)s.overlaps(this.orderedRanges[c])&&(r[this.orderedPartitionKeyRanges[c][p.PartitionKeyRange.MinInclusive]]=this.orderedPartitionKeyRanges[c])}return Object.keys(r).map(s=>r[s]).sort((s,o)=>s[p.PartitionKeyRange.MinInclusive].localeCompare(o[p.PartitionKeyRange.MinInclusive]))}}function ha(n,e){const t=n[0][p.PartitionKeyRange.MinInclusive],r=e[0][p.PartitionKeyRange.MinInclusive];return t>r?1:t<r?-1:0}function fa(n){const e={},t={};let r=[];for(const o of n)e[o[0][p.PartitionKeyRange.Id]]=o,t[o[1]]=o[0],r.push(o);r=r.sort(ha);const i=r.map(o=>o[0]),s=r.map(o=>o[1]);if(pa(i))return new da(i,s)}function pa(n){let e=!1;if(n.length>0){const t=n[0],r=n[n.length-1];e=t[p.PartitionKeyRange.MinInclusive]===p.EffectivePartitionKeyConstants.MinimumInclusiveEffectivePartitionKey,e=e&&r[p.PartitionKeyRange.MaxExclusive]===p.EffectivePartitionKeyConstants.MaximumExclusiveEffectivePartitionKey;for(let i=1;i<n.length;i++){const s=n[i-1],o=n[i];if(e=e&&s[p.PartitionKeyRange.MaxExclusive]===o[p.PartitionKeyRange.MinInclusive],!e){if(s[p.PartitionKeyRange.MaxExclusive]>o[p.PartitionKeyRange.MinInclusive])throw Error("Ranges overlap");break}}}return e}class Bi{constructor(e){this.clientContext=e,this.collectionRoutingMapByCollectionId={}}async onCollectionRoutingMap(e,t,r=!1){const i=v(e);return(this.collectionRoutingMapByCollectionId[i]===void 0||r)&&(this.collectionRoutingMapByCollectionId[i]=this.requestCollectionRoutingMap(e,t)),this.collectionRoutingMapByCollectionId[i]}async getOverlappingRanges(e,t,r,i=!1){return(await this.onCollectionRoutingMap(e,r,i)).getOverlappingRanges(t)}async requestCollectionRoutingMap(e,t){const{resources:r}=await Ye(async i=>this.clientContext.queryPartitionKeyRanges(e).fetchAllInternal(i),t,Se.PartitionKeyRangeLookUp);return fa(r.map(i=>[i,!0]))}}const ga=p.PartitionKeyRange;class Ne{constructor(e){this.partitionKeyRangeCache=new Bi(e)}static _secondRangeIsAfterFirstRange(e,t){if(typeof e.max>"u")throw new Error("range1 must have max");if(typeof t.min>"u")throw new Error("range2 must have min");return e.max>t.min?!1:!(e.max===t.min&&e.isMaxInclusive&&t.isMinInclusive)}static _isSortedAndNonOverlapping(e){for(let t=1;t<e.length;t++){const r=e[t-1],i=e[t];if(!this._secondRangeIsAfterFirstRange(r,i))return!1}return!0}static _stringMax(e,t){return e>=t?e:t}static _stringCompare(e,t){return e===t?0:e>t?1:-1}static _subtractRange(e,t){const r=this._stringMax(t[ga.MaxExclusive],e.min),i=this._stringCompare(r,e.min)===0?e.isMinInclusive:!1;return new ce(r,e.max,i,e.isMaxInclusive)}async getOverlappingRanges(e,t,r){if(!Ne._isSortedAndNonOverlapping(t))throw new Error("the list of ranges is not a non-overlapping sorted ranges");let i=[];if(t.length===0)return i;const s=await this.partitionKeyRangeCache.onCollectionRoutingMap(e,r);let o=0,a=t[o];for(;;){if(a.isEmpty()){if(++o>=t.length)return i;a=t[o];continue}let c;i.length>0?c=Ne._subtractRange(a,i[i.length-1]):c=a;const l=s.getOverlappingRanges(c);if(l.length<=0)throw new Error(`error: returned overlapping ranges for queryRange ${c} is empty`);i=i.concat(l);const u=ce.parsePartitionKeyRange(i[i.length-1]);if(!u)throw new Error("expected lastKnowTargetRange to be truthy");if(Ne._stringCompare(a.max,u.max)>0)throw new Error(`error: returned overlapping ranges ${l}         does not contain the requested range ${c}`);if(++o>=t.length)return i;for(a=t[o];Ne._stringCompare(a.max,u.max)<=0;){if(++o>=t.length)return i;a=t[o]}}}}const ma=He("parallelQueryExecutionContextBase");var kn;(function(n){n.started="started",n.inProgress="inProgress",n.ended="ended"})(kn||(kn={}));class be{constructor(e,t,r,i,s){this.clientContext=e,this.collectionLink=t,this.query=r,this.options=i,this.partitionedQueryExecutionInfo=s,this.clientContext=e,this.collectionLink=t,this.query=r,this.options=i,this.partitionedQueryExecutionInfo=s,this.diagnosticNodeWrapper={consumed:!1,diagnosticNode:new je(e.diagnosticLevel,te.PARALLEL_QUERY_NODE,null)},this.diagnosticNodeWrapper.diagnosticNode.addData({stateful:!0}),this.err=void 0,this.state=be.STATES.started,this.routingProvider=new Ne(this.clientContext),this.sortOrders=this.partitionedQueryExecutionInfo.queryInfo.orderBy,this.requestContinuation=i?i.continuationToken||i.continuation:null,this.respHeaders=B(),this.orderByPQ=new ua((a,c)=>this.documentProducerComparator(c,a)),this.sem=Wr(1);const o=async()=>{try{const a=await this._onTargetPartitionRanges();this.waitingForInternalExecutionContexts=a.length;const c=i.maxDegreeOfParallelism===void 0||i.maxDegreeOfParallelism<1?a.length:Math.min(i.maxDegreeOfParallelism,a.length);ma.info("Query starting against "+a.length+" ranges with parallelism of "+c);const l=Wr(c);let u=[];const h=[];if(this.requestContinuation)throw new Error("Continuation tokens are not yet supported for cross partition queries");u=a,u.forEach(f=>{h.push(this._createTargetPartitionQueryExecutionContext(f))}),h.forEach(f=>{const w=async()=>{try{const{result:m,headers:g}=await f.current(this.getDiagnosticNode());if(this._mergeWithActiveResponseHeaders(g),m===void 0)return;try{this.orderByPQ.enq(f)}catch(R){this.err=R}}catch(m){this._mergeWithActiveResponseHeaders(m.headers),this.err=m}finally{l.leave(),this._decrementInitiationLock()}};l.take(w)})}catch(a){this.err=a,this.sem.leave();return}};this.sem.take(o)}_decrementInitiationLock(){this.waitingForInternalExecutionContexts=this.waitingForInternalExecutionContexts-1,this.waitingForInternalExecutionContexts===0&&(this.sem.leave(),this.orderByPQ.size()===0&&(this.state=be.STATES.inProgress))}_mergeWithActiveResponseHeaders(e){ye(this.respHeaders,e)}_getAndResetActiveResponseHeaders(){const e=this.respHeaders;return this.respHeaders=B(),e}getDiagnosticNode(){return this.diagnosticNodeWrapper.diagnosticNode}async _onTargetPartitionRanges(){const t=this.partitionedQueryExecutionInfo.queryRanges.map(r=>ce.parseFromDict(r));return this.routingProvider.getOverlappingRanges(this.collectionLink,t,this.getDiagnosticNode())}async _getReplacementPartitionKeyRanges(e){const t=e.targetPartitionKeyRange;this.routingProvider=new Ne(this.clientContext);const r=ce.parsePartitionKeyRange(t);return this.routingProvider.getOverlappingRanges(this.collectionLink,[r],this.getDiagnosticNode())}async _repairExecutionContext(e,t){const r=this.orderByPQ.deq();try{const i=await this._getReplacementPartitionKeyRanges(r),s=[];i.forEach(c=>{const l=this._createTargetPartitionQueryExecutionContext(c,r.continuationToken);s.push(l)});const o=async(c,l)=>{try{const{result:u}=await c.current(e);u===void 0||this.orderByPQ.enq(c),await l()}catch(u){this.err=u;return}},a=async c=>{if(c.length>0){const l=c.shift();await o(l,async()=>{await a(c)})}else return t()};await a(s)}catch(i){throw this.err=i,i}}static _needPartitionKeyRangeCacheRefresh(e){return e.code===F.Gone&&"substatus"in e&&e.substatus===Le.PartitionKeyRangeGone}async _repairExecutionContextIfNeeded(e,t,r){const i=this.orderByPQ.peek();try{await i.current(e),r()}catch(s){if(be._needPartitionKeyRangeCacheRefresh(s))return xt(o=>this._repairExecutionContext(o,t),e,te.QUERY_REPAIR_NODE);throw this.err=s,s}}async nextItem(e){if(this.err)throw this.err;return new Promise((t,r)=>{this.sem.take(()=>{if(this.diagnosticNodeWrapper.consumed?this.diagnosticNodeWrapper.diagnosticNode=e:(e.addChildNode(this.diagnosticNodeWrapper.diagnosticNode,K.debug,Se.QueryPlanLookUp),this.diagnosticNodeWrapper.diagnosticNode=void 0,this.diagnosticNodeWrapper.consumed=!0),this.err){this.sem.leave(),this.err.headers=this._getAndResetActiveResponseHeaders(),r(this.err);return}if(this.orderByPQ.size()===0)return this.state=be.STATES.ended,this.sem.leave(),t({result:void 0,headers:this._getAndResetActiveResponseHeaders()});const i=()=>(this.sem.leave(),t(this.nextItem(e))),s=async()=>{let o;try{o=this.orderByPQ.deq()}catch(l){this.err=l,this.sem.leave(),this.err.headers=this._getAndResetActiveResponseHeaders(),r(this.err);return}let a,c;try{const l=await o.nextItem(e);if(a=l.result,c=l.headers,this._mergeWithActiveResponseHeaders(c),a===void 0)return this.err=new Error("Extracted DocumentProducer from the priority queue                                             doesn't have any buffered item!"),this.sem.leave(),t({result:void 0,headers:this._getAndResetActiveResponseHeaders()})}catch(l){this.err=new Error(`Extracted DocumentProducer from the priority queue fails to get the                                     buffered item. Due to ${JSON.stringify(l)}`),this.err.headers=this._getAndResetActiveResponseHeaders(),this.sem.leave(),r(this.err);return}try{const{result:l,headers:u}=await o.current(e);if(this._mergeWithActiveResponseHeaders(u),l!==void 0)try{if(typeof o.fetchResults[0]>"u")throw new Error("Extracted DocumentProducer from PQ is invalid state with no result!");this.orderByPQ.enq(o)}catch(h){this.err=h}}catch(l){be._needPartitionKeyRangeCacheRefresh(l)?this.orderByPQ.enq(o):(this.err=l,r(this.err))}finally{this.sem.leave()}return t({result:a,headers:this._getAndResetActiveResponseHeaders()})};this._repairExecutionContextIfNeeded(e,i,s).catch(r)})})}hasMoreResults(){return!(this.state===be.STATES.ended||this.err!==void 0)}_createTargetPartitionQueryExecutionContext(e,t){let r=this.partitionedQueryExecutionInfo.queryInfo.rewrittenQuery,i;const s=this.query;typeof s=="string"?i={query:s}:i=s,r&&(i=JSON.parse(JSON.stringify(i)),r=r.replace("{documentdb-formattableorderbyquery-filter}","true"),i.query=r);const a=Object.assign({},this.options);return a.continuationToken=t,new zt(this.clientContext,this.collectionLink,i,e,a)}}be.STATES=kn;class ya extends be{documentProducerComparator(e,t){return e.generation-t.generation}}class wa extends be{constructor(e,t,r,i,s){super(e,t,r,i,s),this.orderByComparator=new ar(this.sortOrders)}documentProducerComparator(e,t){return this.orderByComparator.compare(e,t)}}class Qr{constructor(e,t,r){this.executionContext=e,this.offset=t,this.limit=r}async nextItem(e){const t=B();for(;this.offset>0;){const{headers:r}=await this.executionContext.nextItem(e);this.offset--,ye(t,r)}if(this.limit>0){const{result:r,headers:i}=await this.executionContext.nextItem(e);return this.limit--,ye(t,i),{result:r,headers:t}}return{result:void 0,headers:B()}}hasMoreResults(){return(this.offset>0||this.limit>0)&&this.executionContext.hasMoreResults()}}class xa{constructor(e){this.executionContext=e}async nextItem(e){const{result:t,headers:r}=await this.executionContext.nextItem(e);return{result:t!==void 0?t.payload:void 0,headers:r}}hasMoreResults(){return this.executionContext.hasMoreResults()}}async function Ra(n){const e=vi(n),t=await ft.subtle.digest("SHA-256",e);return ba(t)}function ba(n){return Array.prototype.map.call(new Uint8Array(n),e=>("00"+e.toString(16)).slice(-2)).join("")}var Ca=function(n,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(s){return function(o){return function(a,c){var l={key:a,value:o[a]},u={key:c,value:o[c]};return s(l,u)}}}(e.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=i.push(o)-1,u=Object.keys(o).sort(r&&r(o));for(c="",a=0;a<u.length;a++){var h=u[a],f=s(o[h]);f&&(c&&(c+=","),c+=JSON.stringify(h)+":"+f)}return i.splice(l,1),"{"+c+"}"}}(n)};const Ta=Yn(Ca);async function Vt(n){const e=Ta(n);return Ra(e)}class Ea{constructor(e){this.executionContext=e}async nextItem(e){const{headers:t,result:r}=await this.executionContext.nextItem(e);if(r){const i=await Vt(r);if(i===this.hashedLastResult)return{result:void 0,headers:t};this.hashedLastResult=i}return{result:r,headers:t}}hasMoreResults(){return this.executionContext.hasMoreResults()}}class va{constructor(e){this.executionContext=e,this.hashedResults=new Set}async nextItem(e){const{headers:t,result:r}=await this.executionContext.nextItem(e);if(r){const i=await Vt(r);if(this.hashedResults.has(i))return{result:void 0,headers:t};this.hashedResults.add(i)}return{result:r,headers:t}}hasMoreResults(){return this.executionContext.hasMoreResults()}}const Ki="__empty__",Hn=n=>Object.keys(n).length>0?n.item2?n.item2:n.item:null;class Aa{constructor(e,t){this.executionContext=e,this.queryInfo=t,this.groupings=new Map,this.aggregateResultArray=[],this.completed=!1}async nextItem(e){if(this.aggregateResultArray.length>0)return{result:this.aggregateResultArray.pop(),headers:B()};if(this.completed)return{result:void 0,headers:B()};const t=B();for(;this.executionContext.hasMoreResults();){const{result:r,headers:i}=await this.executionContext.nextItem(e);if(ye(t,i),r){const s=r.groupByItems?await Vt(r.groupByItems):Ki,o=this.groupings.get(s),a=r.payload;if(o)Object.keys(a).map(c=>{const l=a[c]?a[c]:new Map().set("item2",null),u=Hn(l);o.get(c).aggregate(u)});else{const c=new Map;this.groupings.set(s,c),Object.keys(a).map(l=>{const u=this.queryInfo.groupByAliasToAggregateType[l],h=zi(u);if(c.set(l,h),u){const f=Hn(a[l]);h.aggregate(f)}else h.aggregate(a[l])})}}}for(const r of this.groupings.values()){const i={};for(const[s,o]of r.entries())i[s]=o.getResult();this.aggregateResultArray.push(i)}return this.completed=!0,{result:this.aggregateResultArray.pop(),headers:t}}hasMoreResults(){return this.executionContext.hasMoreResults()||this.aggregateResultArray.length>0}}class _a{constructor(e,t){this.executionContext=e,this.queryInfo=t,this.aggregators=new Map,this.aggregateResultArray=[],this.completed=!1,this.aggregateType=this.queryInfo.aggregates[0]}async nextItem(e){if(this.aggregateResultArray.length>0)return{result:this.aggregateResultArray.pop(),headers:B()};if(this.completed)return{result:void 0,headers:B()};const t=B();for(;this.executionContext.hasMoreResults();){const{result:r,headers:i}=await this.executionContext.nextItem(e);if(ye(t,i),r){let s=Ki,o=r;if(r.groupByItems&&(o=r.payload,s=await Vt(r.groupByItems)),this.aggregators.get(s)||this.aggregators.set(s,zi(this.aggregateType)),this.aggregateType){const c=Hn(o[0]);c===null&&(this.completed=!0),this.aggregators.get(s).aggregate(c)}else this.aggregators.get(s).aggregate(o)}}if(this.completed)return{result:void 0,headers:t};for(const r of this.aggregators.values())this.aggregateResultArray.push(r.getResult());return this.completed=!0,{result:this.aggregateResultArray.pop(),headers:t}}hasMoreResults(){return this.executionContext.hasMoreResults()||this.aggregateResultArray.length>0}}class Gt{constructor(e,t,r,i,s){this.clientContext=e,this.collectionLink=t,this.query=r,this.options=i,this.partitionedQueryExecutionInfo=s,this.endpoint=null,this.pageSize=i.maxItemCount,this.pageSize===void 0&&(this.pageSize=Gt.DEFAULT_PAGE_SIZE);const o=s.queryInfo.orderBy;Array.isArray(o)&&o.length>0?this.endpoint=new xa(new wa(this.clientContext,this.collectionLink,this.query,this.options,this.partitionedQueryExecutionInfo)):this.endpoint=new ya(this.clientContext,this.collectionLink,this.query,this.options,this.partitionedQueryExecutionInfo),(Object.keys(s.queryInfo.groupByAliasToAggregateType).length>0||s.queryInfo.aggregates.length>0||s.queryInfo.groupByExpressions.length>0)&&(s.queryInfo.hasSelectValue?this.endpoint=new _a(this.endpoint,s.queryInfo):this.endpoint=new Aa(this.endpoint,s.queryInfo));const a=s.queryInfo.top;typeof a=="number"&&(this.endpoint=new Qr(this.endpoint,0,a));const c=s.queryInfo.limit,l=s.queryInfo.offset;typeof c=="number"&&typeof l=="number"&&(this.endpoint=new Qr(this.endpoint,l,c));const u=s.queryInfo.distinctType;u==="Ordered"&&(this.endpoint=new Ea(this.endpoint)),u==="Unordered"&&(this.endpoint=new va(this.endpoint))}async nextItem(e){return this.endpoint.nextItem(e)}hasMoreResults(){return this.endpoint.hasMoreResults()}async fetchMore(e){return typeof this.endpoint.fetchMore=="function"?this.endpoint.fetchMore(e):(this.fetchBuffer=[],this.fetchMoreRespHeaders=B(),this._fetchMoreImplementation(e))}async _fetchMoreImplementation(e){try{const{result:t,headers:r}=await this.endpoint.nextItem(e);if(ye(this.fetchMoreRespHeaders,r),t===void 0){if(this.fetchBuffer.length===0)return{result:void 0,headers:this.fetchMoreRespHeaders};{const i=this.fetchBuffer;return this.fetchBuffer=[],{result:i,headers:this.fetchMoreRespHeaders}}}else if(this.fetchBuffer.push(t),this.fetchBuffer.length>=this.pageSize){const i=this.fetchBuffer.slice(0,this.pageSize);return this.fetchBuffer=this.fetchBuffer.splice(this.pageSize),{result:i,headers:this.fetchMoreRespHeaders}}else return this._fetchMoreImplementation(e)}catch(t){if(ye(this.fetchMoreRespHeaders,t.headers),t.headers=this.fetchMoreRespHeaders,t)throw t}}}Gt.DEFAULT_PAGE_SIZE=10;class xe{constructor(e,t,r,i,s,o){this.clientContext=e,this.query=t,this.options=r,this.fetchFunctions=i,this.resourceLink=s,this.resourceType=o,this.query=t,this.fetchFunctions=i,this.options=r||{},this.resourceLink=s,this.fetchAllLastResHeaders=B(),this.reset(),this.isInitialized=!1}getAsyncIterator(){return $t(this,arguments,function*(){this.reset();let t=new je(this.clientContext.diagnosticLevel,te.CLIENT_REQUEST_NODE,null);for(this.queryPlanPromise=this.fetchQueryPlan(t);this.queryExecutionContext.hasMoreResults();){let r;try{r=yield ae(this.queryExecutionContext.fetchMore(t))}catch(s){if(this.needsQueryPlan(s)){yield ae(this.createPipelinedExecutionContext());try{r=yield ae(this.queryExecutionContext.fetchMore(t))}catch(o){this.handleSplitError(o)}}else throw s}const i=new ln(r.result,r.headers,this.queryExecutionContext.hasMoreResults(),t.toDiagnostic(this.clientContext.getClientConfig()));t=new je(this.clientContext.diagnosticLevel,te.CLIENT_REQUEST_NODE,null),r.result!==void 0&&(yield yield ae(i))}})}hasMoreResults(){return this.queryExecutionContext.hasMoreResults()}async fetchAll(){return C(async e=>this.fetchAllInternal(e),this.clientContext)}async fetchAllInternal(e){this.reset();let t;try{t=await this.toArrayImplementation(e)}catch(r){this.handleSplitError(r)}return t}async fetchNext(){return C(async e=>{this.queryPlanPromise=Ye(async r=>this.fetchQueryPlan(r),e,Se.QueryPlanLookUp),this.isInitialized||await this.init();let t;try{t=await this.queryExecutionContext.fetchMore(e)}catch(r){if(this.needsQueryPlan(r)){await this.createPipelinedExecutionContext();try{t=await this.queryExecutionContext.fetchMore(e)}catch(i){this.handleSplitError(i)}}else throw r}return new ln(t.result,t.headers,this.queryExecutionContext.hasMoreResults(),A())},this.clientContext)}reset(){this.queryPlanPromise=void 0,this.fetchAllLastResHeaders=B(),this.fetchAllTempResources=[],this.queryExecutionContext=new ie(this.options,this.fetchFunctions)}async toArrayImplementation(e){for(this.queryPlanPromise=Ye(async t=>this.fetchQueryPlan(t),e,Se.QueryPlanLookUp),this.isInitialized||await this.init();this.queryExecutionContext.hasMoreResults();){let t;try{t=await this.queryExecutionContext.nextItem(e)}catch(s){if(this.needsQueryPlan(s))await this.createPipelinedExecutionContext(),t=await this.queryExecutionContext.nextItem(e);else throw s}const{result:r,headers:i}=t;ye(this.fetchAllLastResHeaders,i),r!==void 0&&this.fetchAllTempResources.push(r)}return new ln(this.fetchAllTempResources,this.fetchAllLastResHeaders,this.queryExecutionContext.hasMoreResults(),A())}async createPipelinedExecutionContext(){const e=await this.queryPlanPromise;if(e instanceof Error)throw e;const t=e.result,r=t.queryInfo;if(r.aggregates.length>0&&r.hasSelectValue===!1)throw new Error("Aggregate queries must use the VALUE keyword");this.queryExecutionContext=new Gt(this.clientContext,this.resourceLink,this.query,this.options,t)}async fetchQueryPlan(e){return!this.queryPlanPromise&&this.resourceType===x.item?this.clientContext.getQueryPlan(T(this.resourceLink)+"/docs",x.item,this.resourceLink,this.query,this.options,e).catch(t=>t):this.queryPlanPromise}needsQueryPlan(e){var t;if(!((t=e.body)===null||t===void 0)&&t.additionalErrorInfo||e.message.includes("Cross partition query only supports"))return e.code===F.BadRequest&&this.resourceType===x.item;throw e}async init(){if(this.isInitialized!==!0)return this.initPromise===void 0&&(this.initPromise=this._init()),this.initPromise}async _init(){this.options.forceQueryPlan===!0&&this.resourceType===x.item&&await this.createPipelinedExecutionContext(),this.isInitialized=!0}handleSplitError(e){if(e.code===410){const t=new Error("Encountered partition split and could not recover. This request is retryable");throw t.code=503,t.originalError=e,t}else throw e}}class $r extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.conflict=i}}async function Ae(n,e){return(await e.readPartitionKeyDefinition(n)).resource}class Ia{get url(){return`/${this.container.url}/${p.Path.ConflictsPathSegment}/${this.id}`}constructor(e,t,r,i){this.container=e,this.id=t,this.clientContext=r,this.partitionKey=i,this.partitionKey=i}async read(e){return C(async t=>{const r=T(this.url,x.conflicts),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.user,resourceId:i,options:e,diagnosticNode:t});return new $r(s.result,s.headers,s.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{if(this.partitionKey===void 0){const o=await Ae(t,this.container);this.partitionKey=qt(o)}const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.conflicts,resourceId:i,options:e,partitionKey:this.partitionKey,diagnosticNode:t});return new $r(s.result,s.headers,s.code,this,A())},this.clientContext)}}class Da{constructor(e,t){this.container=e,this.clientContext=t}query(e,t){const r=T(this.container.url,x.conflicts),i=v(this.container.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.conflicts,resourceId:i,resultFn:a=>a.Conflicts,query:e,options:o,diagnosticNode:s}))}readAll(e){return this.query(void 0,e)}}class $e extends ee{constructor(e,t,r,i,s,o){super(e,t,r,o,i),this.item=s}}class Un{get url(){return lo(this.container.database.id,this.container.id,this.id)}constructor(e,t,r,i){this.container=e,this.id=t,this.clientContext=r,this.partitionKey=i===void 0?void 0:tr(i)}async read(e={}){return C(async t=>{if(this.partitionKey===void 0){const o=await Ae(t,this.container);this.partitionKey=qt(o)}const r=T(this.url),i=v(this.url);let s;try{s=await this.clientContext.read({path:r,resourceType:x.item,resourceId:i,options:e,partitionKey:this.partitionKey,diagnosticNode:t})}catch(o){if(o.code!==F.NotFound)throw o;s=o}return new $e(s.result,s.headers,s.code,s.substatus,this,A())},this.clientContext)}async replace(e,t={}){return C(async r=>{if(this.partitionKey===void 0){const c=await Ae(r,this.container);this.partitionKey=pt(e,c)}const i={};if(!En(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.item,resourceId:o,options:t,partitionKey:this.partitionKey,diagnosticNode:r});return new $e(a.result,a.headers,a.code,a.substatus,this,A())},this.clientContext)}async delete(e={}){return C(async t=>{if(this.partitionKey===void 0){const o=await Ae(t,this.container);this.partitionKey=qt(o)}const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.item,resourceId:i,options:e,partitionKey:this.partitionKey,diagnosticNode:t});return new $e(s.result,s.headers,s.code,s.substatus,this,A())},this.clientContext)}async patch(e,t={}){return C(async r=>{if(this.partitionKey===void 0){const a=await Ae(r,this.container);this.partitionKey=pt(e,a)}const i=T(this.url),s=v(this.url),o=await this.clientContext.patch({body:e,path:i,resourceType:x.item,resourceId:s,options:t,partitionKey:this.partitionKey,diagnosticNode:r});return new $e(o.result,o.headers,o.code,o.substatus,this,A())},this.clientContext)}}class Pa{constructor(e,t,r,i,s){this.result=e,this.count=t,this.statusCode=r,this.diagnostics=s,this.headers=Object.freeze(i)}get requestCharge(){const e=this.headers[p.HttpHeaders.RequestCharge];return e?parseInt(e,10):null}get activityId(){return this.headers[p.HttpHeaders.ActivityId]}get continuation(){return this.etag}get sessionToken(){return this.headers[p.HttpHeaders.SessionToken]}get etag(){return this.headers[p.HttpHeaders.ETag]}}class Yt{constructor(e,t,r,i,s){this.clientContext=e,this.resourceId=t,this.resourceLink=r,this.partitionKey=i,this.changeFeedOptions=s;const o=i!==void 0;this.isPartitionSpecified=o;let a=!0;s.continuation&&(this.nextIfNoneMatch=s.continuation,a=!1),s.startTime&&(this.ifModifiedSince=s.startTime.toUTCString(),a=!1),a&&!s.startFromBeginning&&(this.nextIfNoneMatch=Yt.IfNoneMatchAllHeaderValue)}get hasMoreResults(){return this.lastStatusCode!==F.NotModified}getAsyncIterator(){return $t(this,arguments,function*(){do{const t=yield ae(this.fetchNext());t.count>0&&(yield yield ae(t))}while(this.hasMoreResults)})}async fetchNext(){return C(async e=>{const t=await this.getFeedResponse(e);return this.lastStatusCode=t.statusCode,this.nextIfNoneMatch=t.headers[p.HttpHeaders.ETag],t},this.clientContext)}async getFeedResponse(e){if(!this.isPartitionSpecified)throw new Error("Container is partitioned, but no partition key or partition key range id was specified.");const t={initialHeaders:{},useIncrementalFeed:!0};typeof this.changeFeedOptions.maxItemCount=="number"&&(t.maxItemCount=this.changeFeedOptions.maxItemCount),this.changeFeedOptions.sessionToken&&(t.sessionToken=this.changeFeedOptions.sessionToken),this.nextIfNoneMatch&&(t.accessCondition={type:p.HttpHeaders.IfNoneMatch,condition:this.nextIfNoneMatch}),this.ifModifiedSince&&(t.initialHeaders[p.HttpHeaders.IfModifiedSince]=this.ifModifiedSince);const r=await this.clientContext.queryFeed({path:this.resourceLink,resourceType:x.item,resourceId:this.resourceId,resultFn:i=>i?i.Documents:[],query:void 0,options:t,partitionKey:this.partitionKey,diagnosticNode:e});return new Pa(r.result,r.result?r.result.length:0,r.code,r.headers,A())}}Yt.IfNoneMatchAllHeaderValue="*";class d extends Array{constructor(e,t){if(super(e),this.sign=t,e>d.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded")}static BigInt(e){var t=Math.floor,r=Number.isFinite;if(typeof e=="number"){if(e===0)return d.__zero();if(d.__isOneDigitInt(e))return 0>e?d.__oneDigit(-e,!0):d.__oneDigit(e,!1);if(!r(e)||t(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return d.__fromDouble(e)}if(typeof e=="string"){const i=d.__fromString(e);if(i===null)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return i}if(typeof e=="boolean")return e===!0?d.__oneDigit(1,!1):d.__zero();if(typeof e=="object"){if(e.constructor===d)return e;const i=d.__toPrimitive(e);return d.BigInt(i)}throw new TypeError("Cannot convert "+e+" to a BigInt")}toDebugString(){const e=["BigInt["];for(const t of this)e.push((t&&(t>>>0).toString(16))+", ");return e.push("]"),e.join("")}toString(e=10){if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return this.length===0?"0":e&e-1?d.__toStringGeneric(this,e,!1):d.__toStringBasePowerOfTwo(this,e)}static toNumber(e){const t=e.length;if(t===0)return 0;if(t===1){const R=e.__unsignedDigit(0);return e.sign?-R:R}const r=e.__digit(t-1),i=d.__clz30(r),s=30*t-i;if(1024<s)return e.sign?-1/0:1/0;let o=s-1,a=r,c=t-1;const l=i+3;let u=l===32?0:a<<l;u>>>=12;const h=l-12;let f=12<=l?0:a<<20+l,w=20+l;for(0<h&&0<c&&(c--,a=e.__digit(c),u|=a>>>30-h,f=a<<h+2,w=h+2);0<w&&0<c;)c--,a=e.__digit(c),f|=30<=w?a<<w-30:a>>>30-w,w-=30;const m=d.__decideRounding(e,w,c,a);if((m===1||m===0&&(1&f)==1)&&(f=f+1>>>0,f===0&&(u++,u>>>20!=0&&(u=0,o++,1023<o))))return e.sign?-1/0:1/0;const g=e.sign?-2147483648:0;return o=o+1023<<20,d.__kBitConversionInts[1]=g|o|u,d.__kBitConversionInts[0]=f,d.__kBitConversionDouble[0]}static unaryMinus(e){if(e.length===0)return e;const t=e.__copy();return t.sign=!e.sign,t}static bitwiseNot(e){return e.sign?d.__absoluteSubOne(e).__trim():d.__absoluteAddOne(e,!0)}static exponentiate(e,t){if(t.sign)throw new RangeError("Exponent must be positive");if(t.length===0)return d.__oneDigit(1,!1);if(e.length===0)return e;if(e.length===1&&e.__digit(0)===1)return e.sign&&!(1&t.__digit(0))?d.unaryMinus(e):e;if(1<t.length)throw new RangeError("BigInt too big");let r=t.__unsignedDigit(0);if(r===1)return e;if(r>=d.__kMaxLengthBits)throw new RangeError("BigInt too big");if(e.length===1&&e.__digit(0)===2){const o=1+(0|r/30),a=e.sign&&(1&r)!=0,c=new d(o,a);c.__initializeDigits();const l=1<<r%30;return c.__setDigit(o-1,l),c}let i=null,s=e;for(1&r&&(i=e),r>>=1;r!==0;r>>=1)s=d.multiply(s,s),1&r&&(i===null?i=s:i=d.multiply(i,s));return i}static multiply(e,t){if(e.length===0)return e;if(t.length===0)return t;let r=e.length+t.length;30<=e.__clzmsd()+t.__clzmsd()&&r--;const i=new d(r,e.sign!==t.sign);i.__initializeDigits();for(let s=0;s<e.length;s++)d.__multiplyAccumulate(t,e.__digit(s),i,s);return i.__trim()}static divide(e,t){if(t.length===0)throw new RangeError("Division by zero");if(0>d.__absoluteCompare(e,t))return d.__zero();const r=e.sign!==t.sign,i=t.__unsignedDigit(0);let s;if(t.length===1&&32767>=i){if(i===1)return r===e.sign?e:d.unaryMinus(e);s=d.__absoluteDivSmall(e,i,null)}else s=d.__absoluteDivLarge(e,t,!0,!1);return s.sign=r,s.__trim()}static remainder(e,t){if(t.length===0)throw new RangeError("Division by zero");if(0>d.__absoluteCompare(e,t))return e;const r=t.__unsignedDigit(0);if(t.length===1&&32767>=r){if(r===1)return d.__zero();const s=d.__absoluteModSmall(e,r);return s===0?d.__zero():d.__oneDigit(s,e.sign)}const i=d.__absoluteDivLarge(e,t,!1,!0);return i.sign=e.sign,i.__trim()}static add(e,t){const r=e.sign;return r===t.sign?d.__absoluteAdd(e,t,r):0<=d.__absoluteCompare(e,t)?d.__absoluteSub(e,t,r):d.__absoluteSub(t,e,!r)}static subtract(e,t){const r=e.sign;return r===t.sign?0<=d.__absoluteCompare(e,t)?d.__absoluteSub(e,t,r):d.__absoluteSub(t,e,!r):d.__absoluteAdd(e,t,r)}static leftShift(e,t){return t.length===0||e.length===0?e:t.sign?d.__rightShiftByAbsolute(e,t):d.__leftShiftByAbsolute(e,t)}static signedRightShift(e,t){return t.length===0||e.length===0?e:t.sign?d.__leftShiftByAbsolute(e,t):d.__rightShiftByAbsolute(e,t)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(e,t){return 0>d.__compareToBigInt(e,t)}static lessThanOrEqual(e,t){return 0>=d.__compareToBigInt(e,t)}static greaterThan(e,t){return 0<d.__compareToBigInt(e,t)}static greaterThanOrEqual(e,t){return 0<=d.__compareToBigInt(e,t)}static equal(e,t){if(e.sign!==t.sign||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e.__digit(r)!==t.__digit(r))return!1;return!0}static notEqual(e,t){return!d.equal(e,t)}static bitwiseAnd(e,t){var r=Math.max;if(!e.sign&&!t.sign)return d.__absoluteAnd(e,t).__trim();if(e.sign&&t.sign){const i=r(e.length,t.length)+1;let s=d.__absoluteSubOne(e,i);const o=d.__absoluteSubOne(t);return s=d.__absoluteOr(s,o,s),d.__absoluteAddOne(s,!0,s).__trim()}return e.sign&&([e,t]=[t,e]),d.__absoluteAndNot(e,d.__absoluteSubOne(t)).__trim()}static bitwiseXor(e,t){var r=Math.max;if(!e.sign&&!t.sign)return d.__absoluteXor(e,t).__trim();if(e.sign&&t.sign){const o=r(e.length,t.length),a=d.__absoluteSubOne(e,o),c=d.__absoluteSubOne(t);return d.__absoluteXor(a,c,a).__trim()}const i=r(e.length,t.length)+1;e.sign&&([e,t]=[t,e]);let s=d.__absoluteSubOne(t,i);return s=d.__absoluteXor(s,e,s),d.__absoluteAddOne(s,!0,s).__trim()}static bitwiseOr(e,t){var r=Math.max;const i=r(e.length,t.length);if(!e.sign&&!t.sign)return d.__absoluteOr(e,t).__trim();if(e.sign&&t.sign){let o=d.__absoluteSubOne(e,i);const a=d.__absoluteSubOne(t);return o=d.__absoluteAnd(o,a,o),d.__absoluteAddOne(o,!0,o).__trim()}e.sign&&([e,t]=[t,e]);let s=d.__absoluteSubOne(t,i);return s=d.__absoluteAndNot(s,e,s),d.__absoluteAddOne(s,!0,s).__trim()}static asIntN(e,t){var r=Math.floor;if(t.length===0)return t;if(e=r(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return d.__zero();if(e>=d.__kMaxLengthBits)return t;const i=0|(e+29)/30;if(t.length<i)return t;const s=t.__unsignedDigit(i-1),o=1<<(e-1)%30;if(t.length===i&&s<o)return t;if((s&o)!==o)return d.__truncateToNBits(e,t);if(!t.sign)return d.__truncateAndSubFromPowerOfTwo(e,t,!0);if(!(s&o-1)){for(let a=i-2;0<=a;a--)if(t.__digit(a)!==0)return d.__truncateAndSubFromPowerOfTwo(e,t,!1);return t.length===i&&s===o?t:d.__truncateToNBits(e,t)}return d.__truncateAndSubFromPowerOfTwo(e,t,!1)}static asUintN(e,t){var r=Math.floor;if(t.length===0)return t;if(e=r(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return d.__zero();if(t.sign){if(e>d.__kMaxLengthBits)throw new RangeError("BigInt too big");return d.__truncateAndSubFromPowerOfTwo(e,t,!1)}if(e>=d.__kMaxLengthBits)return t;const i=0|(e+29)/30;if(t.length<i)return t;const s=e%30;return t.length==i&&(s===0||!(t.__digit(i-1)>>>s))?t:d.__truncateToNBits(e,t)}static ADD(e,t){if(e=d.__toPrimitive(e),t=d.__toPrimitive(t),typeof e=="string")return typeof t!="string"&&(t=t.toString()),e+t;if(typeof t=="string")return e.toString()+t;if(e=d.__toNumeric(e),t=d.__toNumeric(t),d.__isBigInt(e)&&d.__isBigInt(t))return d.add(e,t);if(typeof e=="number"&&typeof t=="number")return e+t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(e,t){return d.__compare(e,t,0)}static LE(e,t){return d.__compare(e,t,1)}static GT(e,t){return d.__compare(e,t,2)}static GE(e,t){return d.__compare(e,t,3)}static EQ(e,t){for(;;){if(d.__isBigInt(e))return d.__isBigInt(t)?d.equal(e,t):d.EQ(t,e);if(typeof e=="number"){if(d.__isBigInt(t))return d.__equalToNumber(t,e);if(typeof t!="object")return e==t;t=d.__toPrimitive(t)}else if(typeof e=="string"){if(d.__isBigInt(t))return e=d.__fromString(e),e!==null&&d.equal(e,t);if(typeof t!="object")return e==t;t=d.__toPrimitive(t)}else if(typeof e=="boolean"){if(d.__isBigInt(t))return d.__equalToNumber(t,+e);if(typeof t!="object")return e==t;t=d.__toPrimitive(t)}else if(typeof e=="symbol"){if(d.__isBigInt(t))return!1;if(typeof t!="object")return e==t;t=d.__toPrimitive(t)}else if(typeof e=="object"){if(typeof t=="object"&&t.constructor!==d)return e==t;e=d.__toPrimitive(e)}else return e==t}}static NE(e,t){return!d.EQ(e,t)}static __zero(){return new d(0,!1)}static __oneDigit(e,t){const r=new d(1,t);return r.__setDigit(0,e),r}__copy(){const e=new d(this.length,this.sign);for(let t=0;t<this.length;t++)e[t]=this[t];return e}__trim(){let e=this.length,t=this[e-1];for(;t===0;)e--,t=this[e-1],this.pop();return e===0&&(this.sign=!1),this}__initializeDigits(){for(let e=0;e<this.length;e++)this[e]=0}static __decideRounding(e,t,r,i){if(0<t)return-1;let s;if(0>t)s=-t-1;else{if(r===0)return-1;r--,i=e.__digit(r),s=29}let o=1<<s;if(!(i&o))return-1;if(o-=1,(i&o)!=0)return 1;for(;0<r;)if(r--,e.__digit(r)!==0)return 1;return 0}static __fromDouble(e){d.__kBitConversionDouble[0]=e;const t=2047&d.__kBitConversionInts[1]>>>20,r=t-1023,i=(0|r/30)+1,s=new d(i,0>e);let o=1048575&d.__kBitConversionInts[1]|1048576,a=d.__kBitConversionInts[0];const c=20,l=r%30;let u,h=0;if(l<20){const f=c-l;h=f+32,u=o>>>f,o=o<<32-f|a>>>f,a<<=32-f}else if(l===20)h=32,u=o,o=a,a=0;else{const f=l-c;h=32-f,u=o<<f|a>>>32-f,o=a<<f,a=0}s.__setDigit(i-1,u);for(let f=i-2;0<=f;f--)0<h?(h-=30,u=o>>>2,o=o<<30|a>>>2,a<<=30):u=0,s.__setDigit(f,u);return s.__trim()}static __isWhitespace(e){return 13>=e&&9<=e||(159>=e?e==32:131071>=e?e==160||e==5760:196607>=e?(e&=131071,10>=e||e==40||e==41||e==47||e==95||e==4096):e==65279)}static __fromString(e,t=0){let r=0;const i=e.length;let s=0;if(s===i)return d.__zero();let o=e.charCodeAt(s);for(;d.__isWhitespace(o);){if(++s===i)return d.__zero();o=e.charCodeAt(s)}if(o===43){if(++s===i)return null;o=e.charCodeAt(s),r=1}else if(o===45){if(++s===i)return null;o=e.charCodeAt(s),r=-1}if(t===0){if(t=10,o===48){if(++s===i)return d.__zero();if(o=e.charCodeAt(s),o===88||o===120){if(t=16,++s===i)return null;o=e.charCodeAt(s)}else if(o===79||o===111){if(t=8,++s===i)return null;o=e.charCodeAt(s)}else if(o===66||o===98){if(t=2,++s===i)return null;o=e.charCodeAt(s)}}}else if(t===16&&o===48){if(++s===i)return d.__zero();if(o=e.charCodeAt(s),o===88||o===120){if(++s===i)return null;o=e.charCodeAt(s)}}if(r!=0&&t!==10)return null;for(;o===48;){if(++s===i)return d.__zero();o=e.charCodeAt(s)}const a=i-s;let c=d.__kMaxBitsPerChar[t],l=d.__kBitsPerCharTableMultiplier-1;if(a>1073741824/c)return null;const u=c*a+l>>>d.__kBitsPerCharTableShift,h=new d(0|(u+29)/30,!1),f=10>t?t:10,w=10<t?t-10:0;if(t&t-1){h.__initializeDigits();let m=!1,g=0;do{let R=0,b=1;for(;;){let M;if(o-48>>>0<f)M=o-48;else if((32|o)-97>>>0<w)M=(32|o)-87;else{m=!0;break}const $=b*t;if(1073741823<$)break;if(b=$,R=R*t+M,g++,++s===i){m=!0;break}o=e.charCodeAt(s)}l=30*d.__kBitsPerCharTableMultiplier-1;const I=0|(c*g+l>>>d.__kBitsPerCharTableShift)/30;h.__inplaceMultiplyAdd(b,R,I)}while(!m)}else{c>>=d.__kBitsPerCharTableShift;const m=[],g=[];let R=!1;do{let b=0,I=0;for(;;){let M;if(o-48>>>0<f)M=o-48;else if((32|o)-97>>>0<w)M=(32|o)-87;else{R=!0;break}if(I+=c,b=b<<c|M,++s===i){R=!0;break}if(o=e.charCodeAt(s),30<I+c)break}m.push(b),g.push(I)}while(!R);d.__fillFromParts(h,m,g)}if(s!==i){if(!d.__isWhitespace(o))return null;for(s++;s<i;s++)if(o=e.charCodeAt(s),!d.__isWhitespace(o))return null}return h.sign=r==-1,h.__trim()}static __fillFromParts(e,t,r){let i=0,s=0,o=0;for(let a=t.length-1;0<=a;a--){const c=t[a],l=r[a];s|=c<<o,o+=l,o===30?(e.__setDigit(i++,s),o=0,s=0):30<o&&(e.__setDigit(i++,1073741823&s),o-=30,s=c>>>l-o)}if(s!==0){if(i>=e.length)throw new Error("implementation bug");e.__setDigit(i++,s)}for(;i<e.length;i++)e.__setDigit(i,0)}static __toStringBasePowerOfTwo(e,t){const r=e.length;let i=t-1;i=(85&i>>>1)+(85&i),i=(51&i>>>2)+(51&i),i=(15&i>>>4)+(15&i);const s=i,o=t-1,a=e.__digit(r-1),c=d.__clz30(a);let l=0|(30*r-c+s-1)/s;if(e.sign&&l++,268435456<l)throw new Error("string too long");const u=Array(l);let h=l-1,f=0,w=0;for(let g=0;g<r-1;g++){const R=e.__digit(g),b=(f|R<<w)&o;u[h--]=d.__kConversionChars[b];const I=s-w;for(f=R>>>I,w=30-I;w>=s;)u[h--]=d.__kConversionChars[f&o],f>>>=s,w-=s}const m=(f|a<<w)&o;for(u[h--]=d.__kConversionChars[m],f=a>>>s-w;f!==0;)u[h--]=d.__kConversionChars[f&o],f>>>=s;if(e.sign&&(u[h--]="-"),h!=-1)throw new Error("implementation bug");return u.join("")}static __toStringGeneric(e,t,r){const i=e.length;if(i===0)return"";if(i===1){let g=e.__unsignedDigit(0).toString(t);return r===!1&&e.sign&&(g="-"+g),g}const s=30*i-d.__clz30(e.__digit(i-1)),o=d.__kMaxBitsPerChar[t],a=o-1;let c=s*d.__kBitsPerCharTableMultiplier;c+=a-1,c=0|c/a;const l=c+1>>1,u=d.exponentiate(d.__oneDigit(t,!1),d.__oneDigit(l,!1));let h,f;const w=u.__unsignedDigit(0);if(u.length===1&&32767>=w){h=new d(e.length,!1),h.__initializeDigits();let g=0;for(let R=2*e.length-1;0<=R;R--){const b=g<<15|e.__halfDigit(R);h.__setHalfDigit(R,0|b/w),g=0|b%w}f=g.toString(t)}else{const g=d.__absoluteDivLarge(e,u,!0,!0);h=g.quotient;const R=g.remainder.__trim();f=d.__toStringGeneric(R,t,!0)}h.__trim();let m=d.__toStringGeneric(h,t,!0);for(;f.length<l;)f="0"+f;return r===!1&&e.sign&&(m="-"+m),m+f}static __unequalSign(e){return e?-1:1}static __absoluteGreater(e){return e?-1:1}static __absoluteLess(e){return e?1:-1}static __compareToBigInt(e,t){const r=e.sign;if(r!==t.sign)return d.__unequalSign(r);const i=d.__absoluteCompare(e,t);return 0<i?d.__absoluteGreater(r):0>i?d.__absoluteLess(r):0}static __compareToNumber(e,t){if(d.__isOneDigitInt(t)){const r=e.sign,i=0>t;if(r!==i)return d.__unequalSign(r);if(e.length===0){if(i)throw new Error("implementation bug");return t===0?0:-1}if(1<e.length)return d.__absoluteGreater(r);const s=Math.abs(t),o=e.__unsignedDigit(0);return o>s?d.__absoluteGreater(r):o<s?d.__absoluteLess(r):0}return d.__compareToDouble(e,t)}static __compareToDouble(e,t){if(t!==t)return t;if(t===1/0)return-1;if(t===-1/0)return 1;const r=e.sign;if(r!==0>t)return d.__unequalSign(r);if(t===0)throw new Error("implementation bug: should be handled elsewhere");if(e.length===0)return-1;d.__kBitConversionDouble[0]=t;const i=2047&d.__kBitConversionInts[1]>>>20;if(i==2047)throw new Error("implementation bug: handled elsewhere");const s=i-1023;if(0>s)return d.__absoluteGreater(r);const o=e.length;let a=e.__digit(o-1);const c=d.__clz30(a),l=30*o-c,u=s+1;if(l<u)return d.__absoluteLess(r);if(l>u)return d.__absoluteGreater(r);let h=1048576|1048575&d.__kBitConversionInts[1],f=d.__kBitConversionInts[0];const w=20,m=29-c;if(m!==(0|(l-1)%30))throw new Error("implementation bug");let g,R=0;if(20>m){const b=w-m;R=b+32,g=h>>>b,h=h<<32-b|f>>>b,f<<=32-b}else if(m===20)R=32,g=h,h=f,f=0;else{const b=m-w;R=32-b,g=h<<b|f>>>32-b,h=f<<b,f=0}if(a>>>=0,g>>>=0,a>g)return d.__absoluteGreater(r);if(a<g)return d.__absoluteLess(r);for(let b=o-2;0<=b;b--){0<R?(R-=30,g=h>>>2,h=h<<30|f>>>2,f<<=30):g=0;const I=e.__unsignedDigit(b);if(I>g)return d.__absoluteGreater(r);if(I<g)return d.__absoluteLess(r)}if(h!==0||f!==0){if(R===0)throw new Error("implementation bug");return d.__absoluteLess(r)}return 0}static __equalToNumber(e,t){var r=Math.abs;return d.__isOneDigitInt(t)?t===0?e.length===0:e.length===1&&e.sign===0>t&&e.__unsignedDigit(0)===r(t):d.__compareToDouble(e,t)===0}static __comparisonResultToBool(e,t){return t===0?0>e:t===1?0>=e:t===2?0<e:t===3?0<=e:void 0}static __compare(e,t,r){if(e=d.__toPrimitive(e),t=d.__toPrimitive(t),typeof e=="string"&&typeof t=="string")switch(r){case 0:return e<t;case 1:return e<=t;case 2:return e>t;case 3:return e>=t}if(d.__isBigInt(e)&&typeof t=="string")return t=d.__fromString(t),t!==null&&d.__comparisonResultToBool(d.__compareToBigInt(e,t),r);if(typeof e=="string"&&d.__isBigInt(t))return e=d.__fromString(e),e!==null&&d.__comparisonResultToBool(d.__compareToBigInt(e,t),r);if(e=d.__toNumeric(e),t=d.__toNumeric(t),d.__isBigInt(e)){if(d.__isBigInt(t))return d.__comparisonResultToBool(d.__compareToBigInt(e,t),r);if(typeof t!="number")throw new Error("implementation bug");return d.__comparisonResultToBool(d.__compareToNumber(e,t),r)}if(typeof e!="number")throw new Error("implementation bug");if(d.__isBigInt(t))return d.__comparisonResultToBool(d.__compareToNumber(t,e),2^r);if(typeof t!="number")throw new Error("implementation bug");return r===0?e<t:r===1?e<=t:r===2?e>t:r===3?e>=t:void 0}__clzmsd(){return d.__clz30(this.__digit(this.length-1))}static __absoluteAdd(e,t,r){if(e.length<t.length)return d.__absoluteAdd(t,e,r);if(e.length===0)return e;if(t.length===0)return e.sign===r?e:d.unaryMinus(e);let i=e.length;(e.__clzmsd()===0||t.length===e.length&&t.__clzmsd()===0)&&i++;const s=new d(i,r);let o=0,a=0;for(;a<t.length;a++){const c=e.__digit(a)+t.__digit(a)+o;o=c>>>30,s.__setDigit(a,1073741823&c)}for(;a<e.length;a++){const c=e.__digit(a)+o;o=c>>>30,s.__setDigit(a,1073741823&c)}return a<s.length&&s.__setDigit(a,o),s.__trim()}static __absoluteSub(e,t,r){if(e.length===0)return e;if(t.length===0)return e.sign===r?e:d.unaryMinus(e);const i=new d(e.length,r);let s=0,o=0;for(;o<t.length;o++){const a=e.__digit(o)-t.__digit(o)-s;s=1&a>>>30,i.__setDigit(o,1073741823&a)}for(;o<e.length;o++){const a=e.__digit(o)-s;s=1&a>>>30,i.__setDigit(o,1073741823&a)}return i.__trim()}static __absoluteAddOne(e,t,r=null){const i=e.length;r===null?r=new d(i,t):r.sign=t;let s=1;for(let o=0;o<i;o++){const a=e.__digit(o)+s;s=a>>>30,r.__setDigit(o,1073741823&a)}return s!=0&&r.__setDigitGrow(i,1),r}static __absoluteSubOne(e,t){const r=e.length;t=t||r;const i=new d(t,!1);let s=1;for(let o=0;o<r;o++){const a=e.__digit(o)-s;s=1&a>>>30,i.__setDigit(o,1073741823&a)}if(s!=0)throw new Error("implementation bug");for(let o=r;o<t;o++)i.__setDigit(o,0);return i}static __absoluteAnd(e,t,r=null){let i=e.length,s=t.length,o=s;if(i<s){o=i;const l=e,u=i;e=t,i=s,t=l,s=u}let a=o;r===null?r=new d(a,!1):a=r.length;let c=0;for(;c<o;c++)r.__setDigit(c,e.__digit(c)&t.__digit(c));for(;c<a;c++)r.__setDigit(c,0);return r}static __absoluteAndNot(e,t,r=null){const i=e.length,s=t.length;let o=s;i<s&&(o=i);let a=i;r===null?r=new d(a,!1):a=r.length;let c=0;for(;c<o;c++)r.__setDigit(c,e.__digit(c)&~t.__digit(c));for(;c<i;c++)r.__setDigit(c,e.__digit(c));for(;c<a;c++)r.__setDigit(c,0);return r}static __absoluteOr(e,t,r=null){let i=e.length,s=t.length,o=s;if(i<s){o=i;const l=e,u=i;e=t,i=s,t=l,s=u}let a=i;r===null?r=new d(a,!1):a=r.length;let c=0;for(;c<o;c++)r.__setDigit(c,e.__digit(c)|t.__digit(c));for(;c<i;c++)r.__setDigit(c,e.__digit(c));for(;c<a;c++)r.__setDigit(c,0);return r}static __absoluteXor(e,t,r=null){let i=e.length,s=t.length,o=s;if(i<s){o=i;const l=e,u=i;e=t,i=s,t=l,s=u}let a=i;r===null?r=new d(a,!1):a=r.length;let c=0;for(;c<o;c++)r.__setDigit(c,e.__digit(c)^t.__digit(c));for(;c<i;c++)r.__setDigit(c,e.__digit(c));for(;c<a;c++)r.__setDigit(c,0);return r}static __absoluteCompare(e,t){const r=e.length-t.length;if(r!=0)return r;let i=e.length-1;for(;0<=i&&e.__digit(i)===t.__digit(i);)i--;return 0>i?0:e.__unsignedDigit(i)>t.__unsignedDigit(i)?1:-1}static __multiplyAccumulate(e,t,r,i){if(t===0)return;const s=32767&t,o=t>>>15;let a=0,c=0;for(let l,u=0;u<e.length;u++,i++){l=r.__digit(i);const h=e.__digit(u),f=32767&h,w=h>>>15,m=d.__imul(f,s),g=d.__imul(f,o),R=d.__imul(w,s),b=d.__imul(w,o);l+=c+m+a,a=l>>>30,l&=1073741823,l+=((32767&g)<<15)+((32767&R)<<15),a+=l>>>30,c=b+(g>>>15)+(R>>>15),r.__setDigit(i,1073741823&l)}for(;a!=0||c!==0;i++){let l=r.__digit(i);l+=a+c,c=0,a=l>>>30,r.__setDigit(i,1073741823&l)}}static __internalMultiplyAdd(e,t,r,i,s){let o=r,a=0;for(let c=0;c<i;c++){const l=e.__digit(c),u=d.__imul(32767&l,t),h=d.__imul(l>>>15,t),f=u+((32767&h)<<15)+a+o;o=f>>>30,a=h>>>15,s.__setDigit(c,1073741823&f)}if(s.length>i)for(s.__setDigit(i++,o+a);i<s.length;)s.__setDigit(i++,0);else if(o+a!==0)throw new Error("implementation bug")}__inplaceMultiplyAdd(e,t,r){r>this.length&&(r=this.length);const i=32767&e,s=e>>>15;let o=0,a=t;for(let c=0;c<r;c++){const l=this.__digit(c),u=32767&l,h=l>>>15,f=d.__imul(u,i),w=d.__imul(u,s),m=d.__imul(h,i),g=d.__imul(h,s);let R=a+f+o;o=R>>>30,R&=1073741823,R+=((32767&w)<<15)+((32767&m)<<15),o+=R>>>30,a=g+(w>>>15)+(m>>>15),this.__setDigit(c,1073741823&R)}if(o!=0||a!==0)throw new Error("implementation bug")}static __absoluteDivSmall(e,t,r=null){r===null&&(r=new d(e.length,!1));let i=0;for(let s,o=2*e.length-1;0<=o;o-=2){s=(i<<15|e.__halfDigit(o))>>>0;const a=0|s/t;i=0|s%t,s=(i<<15|e.__halfDigit(o-1))>>>0;const c=0|s/t;i=0|s%t,r.__setDigit(o>>>1,a<<15|c)}return r}static __absoluteModSmall(e,t){let r=0;for(let i=2*e.length-1;0<=i;i--)r=0|((r<<15|e.__halfDigit(i))>>>0)%t;return r}static __absoluteDivLarge(e,t,r,i){const s=t.__halfDigitLength(),o=t.length,a=e.__halfDigitLength()-s;let c=null;r&&(c=new d(a+2>>>1,!1),c.__initializeDigits());const l=new d(s+2>>>1,!1);l.__initializeDigits();const u=d.__clz15(t.__halfDigit(s-1));0<u&&(t=d.__specialLeftShift(t,u,0));const h=d.__specialLeftShift(e,u,1),f=t.__halfDigit(s-1);let w=0;for(let m,g=a;0<=g;g--){m=32767;const R=h.__halfDigit(g+s);if(R!==f){const I=(R<<15|h.__halfDigit(g+s-1))>>>0;m=0|I/f;let M=0|I%f;const $=t.__halfDigit(s-2),Ct=h.__halfDigit(g+s-2);for(;d.__imul(m,$)>>>0>(M<<16|Ct)>>>0&&(m--,M+=f,!(32767<M)););}d.__internalMultiplyAdd(t,m,0,o,l);let b=h.__inplaceSub(l,g,s+1);b!==0&&(b=h.__inplaceAdd(t,g,s),h.__setHalfDigit(g+s,32767&h.__halfDigit(g+s)+b),m--),r&&(1&g?w=m<<15:c.__setDigit(g>>>1,w|m))}if(i)return h.__inplaceRightShift(u),r?{quotient:c,remainder:h}:h;if(r)return c;throw new Error("unreachable")}static __clz15(e){return d.__clz30(e)-15}__inplaceAdd(e,t,r){let i=0;for(let s=0;s<r;s++){const o=this.__halfDigit(t+s)+e.__halfDigit(s)+i;i=o>>>15,this.__setHalfDigit(t+s,32767&o)}return i}__inplaceSub(e,t,r){let i=0;if(1&t){t>>=1;let s=this.__digit(t),o=32767&s,a=0;for(;a<r-1>>>1;a++){const u=e.__digit(a),h=(s>>>15)-(32767&u)-i;i=1&h>>>15,this.__setDigit(t+a,(32767&h)<<15|32767&o),s=this.__digit(t+a+1),o=(32767&s)-(u>>>15)-i,i=1&o>>>15}const c=e.__digit(a),l=(s>>>15)-(32767&c)-i;if(i=1&l>>>15,this.__setDigit(t+a,(32767&l)<<15|32767&o),t+a+1>=this.length)throw new RangeError("out of bounds");!(1&r)&&(s=this.__digit(t+a+1),o=(32767&s)-(c>>>15)-i,i=1&o>>>15,this.__setDigit(t+e.length,1073709056&s|32767&o))}else{t>>=1;let s=0;for(;s<e.length-1;s++){const u=this.__digit(t+s),h=e.__digit(s),f=(32767&u)-(32767&h)-i;i=1&f>>>15;const w=(u>>>15)-(h>>>15)-i;i=1&w>>>15,this.__setDigit(t+s,(32767&w)<<15|32767&f)}const o=this.__digit(t+s),a=e.__digit(s),c=(32767&o)-(32767&a)-i;i=1&c>>>15;let l=0;!(1&r)&&(l=(o>>>15)-(a>>>15)-i,i=1&l>>>15),this.__setDigit(t+s,(32767&l)<<15|32767&c)}return i}__inplaceRightShift(e){if(e===0)return;let t=this.__digit(0)>>>e;const r=this.length-1;for(let i=0;i<r;i++){const s=this.__digit(i+1);this.__setDigit(i,1073741823&s<<30-e|t),t=s>>>e}this.__setDigit(r,t)}static __specialLeftShift(e,t,r){const i=e.length,s=new d(i+r,!1);if(t===0){for(let a=0;a<i;a++)s.__setDigit(a,e.__digit(a));return 0<r&&s.__setDigit(i,0),s}let o=0;for(let a=0;a<i;a++){const c=e.__digit(a);s.__setDigit(a,1073741823&c<<t|o),o=c>>>30-t}return 0<r&&s.__setDigit(i,o),s}static __leftShiftByAbsolute(e,t){const r=d.__toShiftAmount(t);if(0>r)throw new RangeError("BigInt too big");const i=0|r/30,s=r%30,o=e.length,a=s!==0&&e.__digit(o-1)>>>30-s!=0,c=o+i+(a?1:0),l=new d(c,e.sign);if(s===0){let u=0;for(;u<i;u++)l.__setDigit(u,0);for(;u<c;u++)l.__setDigit(u,e.__digit(u-i))}else{let u=0;for(let h=0;h<i;h++)l.__setDigit(h,0);for(let h=0;h<o;h++){const f=e.__digit(h);l.__setDigit(h+i,1073741823&f<<s|u),u=f>>>30-s}if(a)l.__setDigit(o+i,u);else if(u!==0)throw new Error("implementation bug")}return l.__trim()}static __rightShiftByAbsolute(e,t){const r=e.length,i=e.sign,s=d.__toShiftAmount(t);if(0>s)return d.__rightShiftByMaximum(i);const o=0|s/30,a=s%30;let c=r-o;if(0>=c)return d.__rightShiftByMaximum(i);let l=!1;if(i){if(e.__digit(o)&(1<<a)-1)l=!0;else for(let h=0;h<o;h++)if(e.__digit(h)!==0){l=!0;break}}l&&a===0&&!~e.__digit(r-1)&&c++;let u=new d(c,i);if(a===0){u.__setDigit(c-1,0);for(let h=o;h<r;h++)u.__setDigit(h-o,e.__digit(h))}else{let h=e.__digit(o)>>>a;const f=r-o-1;for(let w=0;w<f;w++){const m=e.__digit(w+o+1);u.__setDigit(w,1073741823&m<<30-a|h),h=m>>>a}u.__setDigit(f,h)}return l&&(u=d.__absoluteAddOne(u,!0,u)),u.__trim()}static __rightShiftByMaximum(e){return e?d.__oneDigit(1,!0):d.__zero()}static __toShiftAmount(e){if(1<e.length)return-1;const t=e.__unsignedDigit(0);return t>d.__kMaxLengthBits?-1:t}static __toPrimitive(e,t="default"){if(typeof e!="object"||e.constructor===d)return e;if(typeof Symbol<"u"&&typeof Symbol.toPrimitive=="symbol"){const s=e[Symbol.toPrimitive];if(s){const o=s(t);if(typeof o!="object")return o;throw new TypeError("Cannot convert object to primitive value")}}const r=e.valueOf;if(r){const s=r.call(e);if(typeof s!="object")return s}const i=e.toString;if(i){const s=i.call(e);if(typeof s!="object")return s}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(e){return d.__isBigInt(e)?e:+e}static __isBigInt(e){return typeof e=="object"&&e!==null&&e.constructor===d}static __truncateToNBits(e,t){const r=0|(e+29)/30,i=new d(r,t.sign),s=r-1;for(let a=0;a<s;a++)i.__setDigit(a,t.__digit(a));let o=t.__digit(s);if(e%30!=0){const a=32-e%30;o=o<<a>>>a}return i.__setDigit(s,o),i.__trim()}static __truncateAndSubFromPowerOfTwo(e,t,r){var i=Math.min;const s=0|(e+29)/30,o=new d(s,r);let a=0;const c=s-1;let l=0;for(const w=i(c,t.length);a<w;a++){const m=0-t.__digit(a)-l;l=1&m>>>30,o.__setDigit(a,1073741823&m)}for(;a<c;a++)o.__setDigit(a,0|1073741823&-l);let u=c<t.length?t.__digit(c):0;const h=e%30;let f;if(h==0)f=0-u-l,f&=1073741823;else{const w=32-h;u=u<<w>>>w;const m=1<<32-w;f=m-u-l,f&=m-1}return o.__setDigit(c,f),o.__trim()}__digit(e){return this[e]}__unsignedDigit(e){return this[e]>>>0}__setDigit(e,t){this[e]=0|t}__setDigitGrow(e,t){this[e]=0|t}__halfDigitLength(){const e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}__halfDigit(e){return 32767&this[e>>>1]>>>15*(1&e)}__setHalfDigit(e,t){const r=e>>>1,i=this.__digit(r),s=1&e?32767&i|t<<15:1073709056&i|32767&t;this.__setDigit(r,s)}static __digitPow(e,t){let r=1;for(;0<t;)1&t&&(r*=e),t>>>=1,e*=e;return r}static __isOneDigitInt(e){return(1073741823&e)===e}}d.__kMaxLength=33554432,d.__kMaxLengthBits=d.__kMaxLength<<5,d.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],d.__kBitsPerCharTableShift=5,d.__kBitsPerCharTableMultiplier=1<<d.__kBitsPerCharTableShift,d.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],d.__kBitConversionBuffer=new ArrayBuffer(8),d.__kBitConversionDouble=new Float64Array(d.__kBitConversionBuffer),d.__kBitConversionInts=new Int32Array(d.__kBitConversionBuffer),d.__clz30=Math.clz32?function(n){return Math.clz32(n)-2}:function(n){return n===0?30:0|29-(0|Math.log(n>>>0)/Math.LN2)},d.__imul=Math.imul||function(n,e){return 0|n*e};const U={Undefined:"00",Null:"01",False:"02",True:"03",MinNumber:"04",Number:"05",MaxNumber:"06",MinString:"07",String:"08",MaxString:"09",Int64:"0a",Int32:"0b",Int16:"0c",Int8:"0d",Uint64:"0e",Uint32:"0f",Uint16:"10",Uint8:"11",Binary:"12",Guid:"13",Float:"14",Infinity:"FF"};function Wi(n){let e=Sa(n),t=Buffer.from(U.Number,"hex");const r=d.asUintN(64,d.signedRightShift(e,d.BigInt(56)));t=Buffer.concat([t,Buffer.from(r.toString(16),"hex")]),e=d.asUintN(64,d.leftShift(d.BigInt(e),d.BigInt(8)));let i=d.BigInt(0),s,o;do o=i.toString(16).padStart(2,"0"),o!=="00"&&(t=Buffer.concat([t,Buffer.from(o,"hex")])),s=d.asUintN(64,d.signedRightShift(e,d.BigInt(56))),i=d.asUintN(64,d.bitwiseOr(s,d.BigInt(1))),e=d.asUintN(64,d.leftShift(e,d.BigInt(7)));while(d.notEqual(e,d.BigInt(0)));return o=d.asUintN(64,d.bitwiseAnd(i,d.BigInt(254))).toString(16).padStart(2,"0"),o!=="00"&&(t=Buffer.concat([t,Buffer.from(o,"hex")])),t}function Sa(n){const e=$i(n),t=d.BigInt(9223372036854776e3);return e<t?d.bitwiseXor(e,t):d.add(d.bitwiseNot(e),d.BigInt(1))}function Qi(n){const e=Buffer.alloc(8),t=$i(n);for(let r=0;r<8;r++)e[r]=d.toNumber(d.bitwiseAnd(d.signedRightShift(t,d.multiply(d.BigInt(r),d.BigInt(8))),d.BigInt(255)));return e}function $i(n){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n),d.BigInt(`0x${Ma(e.buffer)}`)}function Ma(n){return Array.prototype.map.call(new Uint8Array(n),e=>("00"+e.toString(16)).slice(-2)).join("")}function O(n,e){return(n&65535)*e+(((n>>>16)*e&65535)<<16)}function G(n,e){return n<<e|n>>>32-e}function ot(n){return n^=n>>>16,n=O(n,2246822507),n^=n>>>13,n=O(n,3266489909),n^=n>>>16,n}function Me(n,e){n=[n[0]>>>16,n[0]&65535,n[1]>>>16,n[1]&65535],e=[e[0]>>>16,e[0]&65535,e[1]>>>16,e[1]&65535];const t=[0,0,0,0];return t[3]+=n[3]+e[3],t[2]+=t[3]>>>16,t[3]&=65535,t[2]+=n[2]+e[2],t[1]+=t[2]>>>16,t[2]&=65535,t[1]+=n[1]+e[1],t[0]+=t[1]>>>16,t[1]&=65535,t[0]+=n[0]+e[0],t[0]&=65535,[t[0]<<16|t[1],t[2]<<16|t[3]]}function le(n,e){n=[n[0]>>>16,n[0]&65535,n[1]>>>16,n[1]&65535],e=[e[0]>>>16,e[0]&65535,e[1]>>>16,e[1]&65535];const t=[0,0,0,0];return t[3]+=n[3]*e[3],t[2]+=t[3]>>>16,t[3]&=65535,t[2]+=n[2]*e[3],t[1]+=t[2]>>>16,t[2]&=65535,t[2]+=n[3]*e[2],t[1]+=t[2]>>>16,t[2]&=65535,t[1]+=n[1]*e[3],t[0]+=t[1]>>>16,t[1]&=65535,t[1]+=n[2]*e[2],t[0]+=t[1]>>>16,t[1]&=65535,t[1]+=n[3]*e[1],t[0]+=t[1]>>>16,t[1]&=65535,t[0]+=n[0]*e[3]+n[1]*e[2]+n[2]*e[1]+n[3]*e[0],t[0]&=65535,[t[0]<<16|t[1],t[2]<<16|t[3]]}function We(n,e){return e%=64,e===32?[n[1],n[0]]:e<32?[n[0]<<e|n[1]>>>32-e,n[1]<<e|n[0]>>>32-e]:(e-=32,[n[1]<<e|n[0]>>>32-e,n[0]<<e|n[1]>>>32-e])}function ne(n,e){return e%=64,e===0?n:e<32?[n[0]<<e|n[1]>>>32-e,n[1]<<e]:[n[1]<<e-32,0]}function H(n,e){return[n[0]^e[0],n[1]^e[1]]}function Vr(n){return n=H(n,[0,n[0]>>>1]),n=le(n,[4283543511,3981806797]),n=H(n,[0,n[0]>>>1]),n=le(n,[3301882366,444984403]),n=H(n,[0,n[0]>>>1]),n}function Oa(n,e){e=e||0;const t=n.length%4,r=n.length-t;let i=e,s=0;const o=3432918353,a=461845907;let c=0;for(let l=0;l<r;l=l+4)s=n[l]|n[l+1]<<8|n[l+2]<<16|n[l+3]<<24,s=O(s,o),s=G(s,15),s=O(s,a),i^=s,i=G(i,13),i=O(i,5)+3864292196,c=l+4;switch(s=0,t){case 3:s^=n[c+2]<<16;case 2:s^=n[c+1]<<8;case 1:s^=n[c],s=O(s,o),s=G(s,15),s=O(s,a),i^=s}return i^=n.length,i=ot(i),i>>>0}function La(n,e){e=e||0;const t=n.length%16,r=n.length-t;let i=e,s=e,o=e,a=e,c=0,l=0,u=0,h=0;const f=597399067,w=2869860233,m=951274213,g=2716044179;let R=0;for(let b=0;b<r;b=b+16)c=n[b]|n[b+1]<<8|n[b+2]<<16|n[b+3]<<24,l=n[b+4]|n[b+5]<<8|n[b+6]<<16|n[b+7]<<24,u=n[b+8]|n[b+9]<<8|n[b+10]<<16|n[b+11]<<24,h=n[b+12]|n[b+13]<<8|n[b+14]<<16|n[b+15]<<24,c=O(c,f),c=G(c,15),c=O(c,w),i^=c,i=G(i,19),i+=s,i=O(i,5)+1444728091,l=O(l,w),l=G(l,16),l=O(l,m),s^=l,s=G(s,17),s+=o,s=O(s,5)+197830471,u=O(u,m),u=G(u,17),u=O(u,g),o^=u,o=G(o,15),o+=a,o=O(o,5)+2530024501,h=O(h,g),h=G(h,18),h=O(h,f),a^=h,a=G(a,13),a+=i,a=O(a,5)+850148119,R=b+16;switch(c=0,l=0,u=0,h=0,t){case 15:h^=n[R+14]<<16;case 14:h^=n[R+13]<<8;case 13:h^=n[R+12],h=O(h,g),h=G(h,18),h=O(h,f),a^=h;case 12:u^=n[R+11]<<24;case 11:u^=n[R+10]<<16;case 10:u^=n[R+9]<<8;case 9:u^=n[R+8],u=O(u,m),u=G(u,17),u=O(u,g),o^=u;case 8:l^=n[R+7]<<24;case 7:l^=n[R+6]<<16;case 6:l^=n[R+5]<<8;case 5:l^=n[R+4],l=O(l,w),l=G(l,16),l=O(l,m),s^=l;case 4:c^=n[R+3]<<24;case 3:c^=n[R+2]<<16;case 2:c^=n[R+1]<<8;case 1:c^=n[R],c=O(c,f),c=G(c,15),c=O(c,w),i^=c}return i^=n.length,s^=n.length,o^=n.length,a^=n.length,i+=s,i+=o,i+=a,s+=i,o+=i,a+=i,i=ot(i),s=ot(s),o=ot(o),a=ot(a),i+=s,i+=o,i+=a,s+=i,o+=i,a+=i,("00000000"+(i>>>0).toString(16)).slice(-8)+("00000000"+(s>>>0).toString(16)).slice(-8)+("00000000"+(o>>>0).toString(16)).slice(-8)+("00000000"+(a>>>0).toString(16)).slice(-8)}function ka(n,e){e=e||0;const t=n.length%16,r=n.length-t;let i=[0,e],s=[0,e],o=[0,0],a=[0,0];const c=[2277735313,289559509],l=[1291169091,658871167];let u=0;for(let g=0;g<r;g=g+16)o=[n[g+4]|n[g+5]<<8|n[g+6]<<16|n[g+7]<<24,n[g]|n[g+1]<<8|n[g+2]<<16|n[g+3]<<24],a=[n[g+12]|n[g+13]<<8|n[g+14]<<16|n[g+15]<<24,n[g+8]|n[g+9]<<8|n[g+10]<<16|n[g+11]<<24],o=le(o,c),o=We(o,31),o=le(o,l),i=H(i,o),i=We(i,27),i=Me(i,s),i=Me(le(i,[0,5]),[0,1390208809]),a=le(a,l),a=We(a,33),a=le(a,c),s=H(s,a),s=We(s,31),s=Me(s,i),s=Me(le(s,[0,5]),[0,944331445]),u=g+16;switch(o=[0,0],a=[0,0],t){case 15:a=H(a,ne([0,n[u+14]],48));case 14:a=H(a,ne([0,n[u+13]],40));case 13:a=H(a,ne([0,n[u+12]],32));case 12:a=H(a,ne([0,n[u+11]],24));case 11:a=H(a,ne([0,n[u+10]],16));case 10:a=H(a,ne([0,n[u+9]],8));case 9:a=H(a,[0,n[u+8]]),a=le(a,l),a=We(a,33),a=le(a,c),s=H(s,a);case 8:o=H(o,ne([0,n[u+7]],56));case 7:o=H(o,ne([0,n[u+6]],48));case 6:o=H(o,ne([0,n[u+5]],40));case 5:o=H(o,ne([0,n[u+4]],32));case 4:o=H(o,ne([0,n[u+3]],24));case 3:o=H(o,ne([0,n[u+2]],16));case 2:o=H(o,ne([0,n[u+1]],8));case 1:o=H(o,[0,n[u]]),o=le(o,c),o=We(o,31),o=le(o,l),i=H(i,o)}i=H(i,[0,n.length]),s=H(s,[0,n.length]),i=Me(i,s),s=Me(s,i),i=Vr(i),s=Vr(s),i=Me(i,s),s=Me(s,i);const h=Buffer.from(("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8),"hex"),f=Gr(h).toString("hex"),w=Buffer.from(("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8),"hex"),m=Gr(w).toString("hex");return f+m}function Gr(n){const e=Buffer.allocUnsafe(n.length);for(let t=0,r=n.length-1;t<=r;++t,--r)e[t]=n[r],e[r]=n[t];return e}const Vi={version:"3.0.0",x86:{hash32:Oa,hash128:La},x64:{hash128:ka},inputValidation:!0};function Gi(n){const e=Buffer.concat(n.map(Ha)),t=Vi.x64.hash128(e),r=Ua(Buffer.from(t,"hex"));return r[0]&=63,r.toString("hex").toUpperCase()}function Ha(n){let e;switch(typeof n){case"string":return e=Buffer.concat([Buffer.from(U.String,"hex"),Buffer.from(n),Buffer.from(U.Infinity,"hex")]),e;case"number":{const t=Qi(n);return e=Buffer.concat([Buffer.from(U.Number,"hex"),t]),e}case"boolean":{const t=n?U.True:U.False;return Buffer.from(t,"hex")}case"object":return n===null?Buffer.from(U.Null,"hex"):Buffer.from(U.Undefined,"hex");case"undefined":return Buffer.from(U.Undefined,"hex");default:throw new Error(`Unexpected type: ${typeof n}`)}}function Ua(n){const e=Buffer.allocUnsafe(n.length);for(let t=0,r=n.length-1;t<=r;++t,--r)e[t]=n[r],e[r]=n[t];return e}function Fa(n){return n.map(e=>Gi([e])).join("")}function Na(n){let e=Buffer.from(U.String,"hex");const t=100,r=[...Buffer.from(n)],i=n.length<=t;for(let s=0;s<(i?r.length:t+1);s++){let o=r[s];o<255&&o++,e=Buffer.concat([e,Buffer.from(o.toString(16),"hex")])}return i&&(e=Buffer.concat([e,Buffer.from(U.Undefined,"hex")])),e}const Yi=100;function qa(n){const e=n[0],t=za(e),r=Vi.x86.hash32(t),i=Wi(r),s=ja(e);return Buffer.concat([i,s]).toString("hex").toUpperCase()}function za(n){let e;switch(typeof n){case"string":{const t=n.substr(0,Yi);return e=Buffer.concat([Buffer.from(U.String,"hex"),Buffer.from(t),Buffer.from(U.Undefined,"hex")]),e}case"number":{const t=Qi(n);return e=Buffer.concat([Buffer.from(U.Number,"hex"),t]),e}case"boolean":{const t=n?U.True:U.False;return Buffer.from(t,"hex")}case"object":return n===null?Buffer.from(U.Null,"hex"):Buffer.from(U.Undefined,"hex");case"undefined":return Buffer.from(U.Undefined,"hex");default:throw new Error(`Unexpected type: ${typeof n}`)}}function ja(n){switch(typeof n){case"string":{const e=n.substr(0,Yi);return Na(e)}case"number":return Wi(n);case"boolean":{const e=n?U.True:U.False;return Buffer.from(e,"hex")}case"object":return n===null?Buffer.from(U.Null,"hex"):Buffer.from(U.Undefined,"hex");case"undefined":return Buffer.from(U.Undefined,"hex");default:throw new Error(`Unexpected type: ${typeof n}`)}}function Ba(n,e){const t=(e==null?void 0:e.kind)||ut.Hash,r=e&&e.version&&e.version===Mn.V2;switch(t){case ut.Hash:return r?Gi(n):qa(n);case ut.MultiHash:return Fa(n)}}class at{constructor(e,t,r,i,s){this.minInclusive=e,this.maxExclusive=t,this.continuationToken=r,this.epkMinHeader=i,this.epkMaxHeader=s}}class Fn{constructor(e,t,r,i,s,o){this.result=e,this.count=t,this.statusCode=r,this.diagnostics=s,this.subStatusCode=o,this.headers=i}get requestCharge(){const e=this.headers[p.HttpHeaders.RequestCharge];return e?parseInt(e,10):null}get activityId(){return this.headers[p.HttpHeaders.ActivityId]}get continuationToken(){return this.headers[p.HttpHeaders.ContinuationToken]}get sessionToken(){return this.headers[p.HttpHeaders.SessionToken]}}class Ka{constructor(){this.elements=[]}modifyFirstElement(e){this.isEmpty()||(this.elements[0]=e)}enqueue(e){this.elements.push(e)}dequeue(){return this.elements.shift()}peek(){return this.isEmpty()?void 0:this.elements[0]}isEmpty(){return this.elements.length===0}moveFirstElementToTheEnd(){this.isEmpty()||this.elements.push(this.dequeue())}returnSnapshot(){const e=[];return this.elements.map(t=>{const r=t.epkMinHeader?t.epkMinHeader:t.minInclusive,i=t.epkMaxHeader?t.epkMaxHeader:t.maxExclusive,s=new at(r,i,t.continuationToken);e.push(s)}),e}}class Wa{constructor(e,t){this.rid=e,this.Continuation=t}}class cr{constructor(e){this.cfResource=e}getCfResource(){return this.cfResource}}class ur{constructor(e){this.cfResource=e}getCfResource(){return this.cfResource}}class lr{constructor(e,t){this.startTime=e,this.cfResource=t}getCfResource(){return this.cfResource}getStartTime(){return this.startTime}}class dr{constructor(e,t){if(new.target===dr)throw new j("Cannot instantiate abstract class FeedRange");this.minInclusive=e,this.maxExclusive=t}}class Xi extends dr{constructor(e,t){super(e,t)}}function Qa(n){if(!$a(n))throw new j("Invalid Changefeed Iterator Options.");if(n!=null&&n.maxItemCount&&typeof(n==null?void 0:n.maxItemCount)!="number")throw new j("maxItemCount must be number");if((n==null?void 0:n.maxItemCount)!==void 0&&(n==null?void 0:n.maxItemCount)<1)throw new j("maxItemCount must be a positive number")}function $a(n){return typeof n!="object"?!1:Object.keys(n).length===0&&JSON.stringify(n)==="{}"?!0:n&&!(nr(n)||Array.isArray(n))}async function _t(n,e){return e.minInclusive>=n.min&&e.maxExclusive<=n.max?[void 0,void 0]:e.minInclusive<=n.min&&e.maxExclusive>=n.max?[n.min,n.max]:e.minInclusive<=n.min&&e.maxExclusive<=n.max&&e.maxExclusive>=n.min?[n.min,e.maxExclusive]:[e.minInclusive,n.max]}function Va(n){return n instanceof Xi&&typeof n.minInclusive=="string"&&typeof n.maxExclusive=="string"&&n.minInclusive>=p.EffectivePartitionKeyConstants.MinimumInclusiveEffectivePartitionKey&&n.maxExclusive<=p.EffectivePartitionKeyConstants.MaximumExclusiveEffectivePartitionKey&&n.maxExclusive>n.minInclusive}function Yr(n,e,t){const r={};return r.maxItemCount=n==null?void 0:n.maxItemCount,r.sessionToken=n==null?void 0:n.sessionToken,r.continuationToken=e,r.startTime=t,r}function Ga(n){if(!(n instanceof cr)){if(n instanceof ur)return new Date;if(n instanceof lr)return n.getStartTime()}}function Ya(n){return n==null||n.trim()===""}class Xr{constructor(e,t,r,i,s,o,a,c){this.clientContext=e,this.container=t,this.partitionKeyRangeCache=r,this.resourceId=i,this.resourceLink=s,this.url=o,this.changeFeedOptions=a,this.epkRange=c,this.generateContinuationToken=()=>JSON.stringify(new Wa(this.rId,this.queue.returnSnapshot())),this.queue=new Ka,this.continuationToken=a.continuationToken?JSON.parse(a.continuationToken):void 0,this.startTime=a.startTime?a.startTime.toUTCString():void 0,this.isInstantiated=!1}async setIteratorRid(e){const{resource:t}=await this.container.readInternal(e);this.rId=t._rid}continuationTokenRidMatchContainerRid(){return this.continuationToken.rid===this.rId}async fillChangeFeedQueue(e){this.continuationToken?await this.fetchContinuationTokenFeedRanges(e):await this.fetchOverLappingFeedRanges(e),this.isInstantiated=!0}async fetchOverLappingFeedRanges(e){try{const t=await this.partitionKeyRangeCache.getOverlappingRanges(this.url,this.epkRange,e);for(const r of t){const[i,s]=await _t(this.epkRange,r),o=new at(r.minInclusive,r.maxExclusive,"",i,s);this.queue.enqueue(o)}}catch(t){throw new j(t.message)}}async fetchContinuationTokenFeedRanges(e){const t=this.continuationToken;if(this.continuationTokenRidMatchContainerRid())for(const r of t.Continuation){const i=new ce(r.minInclusive,r.maxExclusive,!0,!1);try{const s=await this.partitionKeyRangeCache.getOverlappingRanges(this.url,i,e);for(const o of s){const[a,c]=await _t(i,o),l=new at(o.minInclusive,o.maxExclusive,r.continuationToken,a,c);this.queue.enqueue(l)}}catch(s){throw new j(s.message)}}else throw new j("The continuation token is not for the current container definition")}get hasMoreResults(){return!0}getAsyncIterator(){return $t(this,arguments,function*(){do{const t=yield ae(this.readNext());yield yield ae(t)}while(this.hasMoreResults)})}async readNext(){return C(async e=>{this.isInstantiated||(await this.setIteratorRid(e),await this.fillChangeFeedQueue(e));let t,r;do{const[i,s]=await this.fetchNext(e);if(r=s,r!==void 0&&(t===void 0&&(t=i),this.queue.moveFirstElementToTheEnd(),r.statusCode===F.Ok))return r.headers[p.HttpHeaders.ContinuationToken]=this.generateContinuationToken(),r}while(!this.checkedAllFeedRanges(t));return r.headers[p.HttpHeaders.ContinuationToken]=this.generateContinuationToken(),r},this.clientContext)}async fetchNext(e){const t=this.queue.peek();if(t){const r=await this.getFeedResponse(t,e);if(await this.shouldRetryOnFailure(t,r,e))return this.queue.dequeue(),this.fetchNext(e);{const s=r.headers[p.HttpHeaders.ETag],o=this.queue.peek();return o.continuationToken=s,[[o.minInclusive,o.maxExclusive],r]}}else return[[void 0,void 0],void 0]}checkedAllFeedRanges(e){if(e===void 0)return!1;const t=this.queue.peek();return e[0]===(t==null?void 0:t.minInclusive)&&e[1]===(t==null?void 0:t.maxExclusive)}async shouldRetryOnFailure(e,t,r){if(t.statusCode===F.Ok||t.statusCode===F.NotModified)return!1;if(t.statusCode===F.Gone&&(t.subStatusCode===Le.PartitionKeyRangeGone||t.subStatusCode===Le.CompletingSplit)){const s=new ce(e.minInclusive,e.maxExclusive,!0,!1),o=await this.partitionKeyRangeCache.getOverlappingRanges(this.url,s,r,!0);if(o.length<1)throw new j("Partition split/merge detected but no overlapping ranges found.");return o.length>=1&&await this.handleSplit(!1,o,s,e.continuationToken),!0}return!1}async handleSplit(e,t,r,i){let s=0;if(e){const[o,a]=await _t(r,t[0]),c=new at(t[0].minInclusive,t[0].maxExclusive,i,o,a);this.queue.modifyFirstElement(c),s=1}for(let o=s;o<t.length;o++){const[a,c]=await _t(r,t[o]),l=new at(t[o].minInclusive,t[o].maxExclusive,i,a,c);this.queue.enqueue(l)}}async getPartitionRangeId(e,t){const r=e.epkMinHeader?e.epkMinHeader:e.minInclusive,i=e.epkMaxHeader?e.epkMaxHeader:e.maxExclusive,s=new ce(r,i,!0,!1),o=await this.partitionKeyRangeCache.getOverlappingRanges(this.url,s,t,!1);if(o.length<1)throw new j("No overlapping ranges found.");const a=o[0];return o.length>1&&await this.handleSplit(!0,o,s,e.continuationToken),a.id}async getFeedResponse(e,t){const r={initialHeaders:{},useIncrementalFeed:!0};typeof this.changeFeedOptions.maxItemCount=="number"&&(r.maxItemCount=this.changeFeedOptions.maxItemCount),this.changeFeedOptions.sessionToken&&(r.sessionToken=this.changeFeedOptions.sessionToken),e.continuationToken&&(r.accessCondition={type:p.HttpHeaders.IfNoneMatch,condition:e.continuationToken}),this.startTime&&(r.initialHeaders[p.HttpHeaders.IfModifiedSince]=this.startTime);const i=await this.getPartitionRangeId(e,t);try{const s=await this.clientContext.queryFeed({path:this.resourceLink,resourceType:x.item,resourceId:this.resourceId,resultFn:o=>o?o.Documents:[],query:void 0,options:r,diagnosticNode:t,partitionKey:void 0,partitionKeyRangeId:i,startEpk:e.epkMinHeader,endEpk:e.epkMaxHeader});return new Fn(s.result,s.result?s.result.length:0,s.code,s.headers,A())}catch(s){return new Fn([],0,s.code,s.headers,A(),s.substatus)}}}class Xa{constructor(e,t,r){this.rid=e,this.partitionKey=t,this.Continuation=r}}class Zr{constructor(e,t,r,i,s,o){this.clientContext=e,this.container=t,this.resourceId=r,this.resourceLink=i,this.partitionKey=s,this.changeFeedOptions=o,this.continuationToken=o.continuationToken?JSON.parse(o.continuationToken):void 0,this.isInstantiated=!1,o.startTime&&(this.startTime=o.startTime.toUTCString())}async instantiateIterator(e){if(await this.setIteratorRid(e),this.continuationToken){if(!this.continuationTokenRidMatchContainerRid())throw new j("The continuation is not for the current container definition.")}else this.continuationToken=new Xa(this.rId,this.partitionKey,"");this.isInstantiated=!0}continuationTokenRidMatchContainerRid(){return this.continuationToken.rid===this.rId}async setIteratorRid(e){const{resource:t}=await this.container.readInternal(e);this.rId=t._rid}get hasMoreResults(){return!0}getAsyncIterator(){return $t(this,arguments,function*(){do{const t=yield ae(this.readNext());yield yield ae(t)}while(this.hasMoreResults)})}async readNext(){return C(async e=>(this.isInstantiated||await this.instantiateIterator(e),await this.fetchNext(e)),this.clientContext)}async fetchNext(e){const t=await this.getFeedResponse(e);return this.continuationToken.Continuation=t.headers[p.HttpHeaders.ETag],t.headers[p.HttpHeaders.ContinuationToken]=JSON.stringify(this.continuationToken),t}async getFeedResponse(e){const t={initialHeaders:{},useIncrementalFeed:!0};typeof this.changeFeedOptions.maxItemCount=="number"&&(t.maxItemCount=this.changeFeedOptions.maxItemCount),this.changeFeedOptions.sessionToken&&(t.sessionToken=this.changeFeedOptions.sessionToken);const r=this.continuationToken.Continuation;r&&(t.accessCondition={type:p.HttpHeaders.IfNoneMatch,condition:r}),this.startTime&&(t.initialHeaders[p.HttpHeaders.IfModifiedSince]=this.startTime);const i=await this.clientContext.queryFeed({path:this.resourceLink,resourceType:x.item,resourceId:this.resourceId,resultFn:s=>s?s.Documents:[],diagnosticNode:e,query:void 0,options:t,partitionKey:this.partitionKey});return new Fn(i.result,i.result?i.result.length:0,i.code,i.headers,A())}}var Xe;(function(n){n[n.FeedRange=0]="FeedRange",n[n.PartitionKey=1]="PartitionKey"})(Xe||(Xe={}));class Zi{constructor(e){this.continuationToken=e}getCfResource(){return this.continuationToken}getCfResourceJson(){return JSON.parse(this.continuationToken)}getResourceType(){const e=this.getCfResourceJson();if(Object.prototype.hasOwnProperty.call(e,"partitionKey")&&Object.prototype.hasOwnProperty.call(e,"Continuation")&&typeof e.Continuation=="string")return Xe.PartitionKey;if(Object.prototype.hasOwnProperty.call(e,"Continuation")&&Array.isArray(e.Continuation)&&e.Continuation.length>0)return Xe.FeedRange;throw new j("Invalid continuation token.")}}class Za{static Beginning(e){return new cr(e)}static Now(e){return new ur(e)}static Time(e,t){if(!e)throw new j("startTime must be present");if(e instanceof Date)return new lr(e,t);throw new j("startTime must be a Date object.")}static Continuation(e){if(!e)throw new j("Argument continuation must be passed.");if(Ya(e))throw new j("Argument continuationToken must be a non-empty string.");return new Zi(e)}}function Ja(n,e,t,r){const i=t.url,s=T(i,x.item),o=v(i);let a=n.changeFeedStartFrom;if(a===void 0&&(a=Za.Now()),a instanceof Zi){const c=a.getCfResourceJson(),l=a.getResourceType(),u=Yr(n,a.getCfResource());if(l===Xe.PartitionKey&&Hr(c.partitionKey))return new Zr(e,t,o,s,c.partitionKey,u);if(l===Xe.FeedRange)return new Xr(e,t,r,o,s,i,u,void 0);throw new j("Invalid continuation token.")}else if(a instanceof ur||a instanceof lr||a instanceof cr){const c=Ga(a),l=Yr(n,void 0,c),u=a.getCfResource();if(Hr(u))return new Zr(e,t,o,s,u,l);{let h;if(u===void 0)h=new ce(p.EffectivePartitionKeyConstants.MinimumInclusiveEffectivePartitionKey,p.EffectivePartitionKeyConstants.MaximumExclusiveEffectivePartitionKey,!0,!1);else if(Va(u))h=new ce(u.minInclusive,u.maxExclusive,!0,!1);else throw new j("Invalid feed range.");return new Xr(e,t,r,o,s,i,l,h)}}else throw new j("Invalid change feed start location.")}const Jr=wt;function dn(n){return n&&!(nr(n)||Array.isArray(n))}class ec{constructor(e,t){this.container=e,this.clientContext=t,this.partitionKeyRangeCache=new Bi(this.clientContext)}query(e,t={}){const r=T(this.container.url,x.item),i=v(this.container.url),s=async(o,a)=>await this.clientContext.queryFeed({path:r,resourceType:x.item,resourceId:i,resultFn:l=>l?l.Documents:[],query:e,options:a,partitionKey:t.partitionKey,diagnosticNode:o});return new xe(this.clientContext,e,t,s,this.container.url,x.item)}readChangeFeed(e,t){return dn(e)?this.changeFeed(e):this.changeFeed(e,t)}changeFeed(e,t){let r;!t&&dn(e)?(r=void 0,t=e):e!==void 0&&!dn(e)&&(r=e),t||(t={});const i=T(this.container.url,x.item),s=v(this.container.url);return new Yt(this.clientContext,s,i,r,t)}getChangeFeedIterator(e){const t=e!==void 0?e:{};return Qa(t),Ja(t,this.clientContext,this.container,this.partitionKeyRangeCache)}readAll(e){return this.query("SELECT * from c",e)}async create(e,t={}){return C(async r=>{(e.id===void 0||e.id==="")&&!t.disableAutomaticIdGeneration&&(e.id=Jr());const i=await Ae(r,this.container),s=pt(e,i),o={};if(!En(e,o))throw o;const a=T(this.container.url,x.item),c=v(this.container.url),l=await this.clientContext.create({body:e,path:a,resourceType:x.item,resourceId:c,diagnosticNode:r,options:t,partitionKey:s}),u=new Un(this.container,l.result.id,this.clientContext,s);return new $e(l.result,l.headers,l.code,l.substatus,u,A())},this.clientContext)}async upsert(e,t={}){return C(async r=>{(e.id===void 0||e.id==="")&&!t.disableAutomaticIdGeneration&&(e.id=Jr());const i=await Ae(r,this.container),s=pt(e,i),o={};if(!En(e,o))throw o;const a=T(this.container.url,x.item),c=v(this.container.url),l=await this.clientContext.upsert({body:e,path:a,resourceType:x.item,resourceId:c,options:t,partitionKey:s,diagnosticNode:r}),u=new Un(this.container,l.result.id,this.clientContext,s);return new $e(l.result,l.headers,l.code,l.substatus,u,A())},this.clientContext)}async bulk(e,t,r){return C(async i=>{const{resources:s}=await this.container.readPartitionKeyRanges().fetchAll(),o=await Ae(i,this.container),a=s.map(h=>({min:h.minInclusive,max:h.maxExclusive,rangeId:h.id,indexes:[],operations:[]}));this.groupOperationsBasedOnPartitionKey(e,o,r,a);const c=T(this.container.url,x.item),l=[];await Promise.all(a.filter(h=>h.operations.length).flatMap(h=>Ko(h)).map(async h=>{if(h.operations.length>100)throw new Error("Cannot run bulk request with more than 100 operations per partition");try{(await xt(async w=>this.clientContext.bulk({body:h.operations,partitionKeyRangeId:h.rangeId,path:c,resourceId:this.container.url,bulkOptions:t,options:r,diagnosticNode:w}),i,te.BATCH_REQUEST)).result.forEach((w,m)=>{l[h.indexes[m]]=w})}catch(f){throw f.code===410?new Error("Partition key error. Either the partitions have split or an operation has an unsupported partitionKey type"+f.message):new Error(`Bulk request errored with: ${f.message}`)}}));const u=l;return u.diagnostics=i.toDiagnostic(this.clientContext.getClientConfig()),u},this.clientContext)}groupOperationsBasedOnPartitionKey(e,t,r,i){e.forEach((s,o)=>{const{operation:a,partitionKey:c}=jo(s,t,r),l=Ba(On(c,"undefined value for PartitionKey is not expected during grouping of bulk operations."),t),u=On(i.find(h=>zo(h.min,h.max,l)),"No suitable Batch found.");u.operations.push(a),u.indexes.push(o)})}async batch(e,t,r){return C(async i=>{e.map(o=>Wo(o,r));const s=T(this.container.url,x.item);if(e.length>100)throw new Error("Cannot run batch request with more than 100 operations per partition");try{return await this.clientContext.batch({body:e,partitionKey:t,path:s,resourceId:this.container.url,options:r,diagnosticNode:i})}catch(o){throw new Error(`Batch request error: ${o.message}`)}},this.clientContext)}}class St extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.storedProcedure=i}get sproc(){return this.storedProcedure}}class Ji{get url(){return fo(this.container.database.id,this.container.id,this.id)}constructor(e,t,r){this.container=e,this.id=t,this.clientContext=r}async read(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.sproc,resourceId:i,options:e,diagnosticNode:t});return new St(s.result,s.headers,s.code,this,A())},this.clientContext)}async replace(e,t){return C(async r=>{e.body&&(e.body=e.body.toString());const i={};if(!V(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.sproc,resourceId:o,options:t,diagnosticNode:r});return new St(a.result,a.headers,a.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.sproc,resourceId:i,options:e,diagnosticNode:t});return new St(s.result,s.headers,s.code,this,A())},this.clientContext)}async execute(e,t,r){return C(async i=>{if(e===void 0){const o=await Ae(i,this.container);e=qt(o)}const s=await this.clientContext.execute({sprocLink:this.url,params:t,options:r,partitionKey:e,diagnosticNode:i});return new ee(s.result,s.headers,s.code,A())},this.clientContext)}}class tc{constructor(e,t){this.container=e,this.clientContext=t}query(e,t){const r=T(this.container.url,x.sproc),i=v(this.container.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.sproc,resourceId:i,resultFn:a=>a.StoredProcedures,query:e,options:o,diagnosticNode:s}))}readAll(e){return this.query(void 0,e)}async create(e,t){return C(async r=>{e.body&&(e.body=e.body.toString());const i={};if(!V(e,i))throw i;const s=T(this.container.url,x.sproc),o=v(this.container.url),a=await this.clientContext.create({body:e,path:s,resourceType:x.sproc,resourceId:o,options:t,diagnosticNode:r}),c=new Ji(this.container,a.result.id,this.clientContext);return new St(a.result,a.headers,a.code,c,A())},this.clientContext)}}class Mt extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.trigger=i}}class es{get url(){return po(this.container.database.id,this.container.id,this.id)}constructor(e,t,r){this.container=e,this.id=t,this.clientContext=r}async read(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.trigger,resourceId:i,options:e,diagnosticNode:t});return new Mt(s.result,s.headers,s.code,this,A())},this.clientContext)}async replace(e,t){return C(async r=>{e.body&&(e.body=e.body.toString());const i={};if(!V(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.trigger,resourceId:o,options:t,diagnosticNode:r});return new Mt(a.result,a.headers,a.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.trigger,resourceId:i,options:e,diagnosticNode:t});return new Mt(s.result,s.headers,s.code,this,A())},this.clientContext)}}class nc{constructor(e,t){this.container=e,this.clientContext=t}query(e,t){const r=T(this.container.url,x.trigger),i=v(this.container.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.trigger,resourceId:i,resultFn:a=>a.Triggers,query:e,options:o,diagnosticNode:s}))}readAll(e){return this.query(void 0,e)}async create(e,t){return C(async r=>{e.body&&(e.body=e.body.toString());const i={};if(!V(e,i))throw i;const s=T(this.container.url,x.trigger),o=v(this.container.url),a=await this.clientContext.create({body:e,path:s,resourceType:x.trigger,resourceId:o,options:t,diagnosticNode:r}),c=new es(this.container,a.result.id,this.clientContext);return new Mt(a.result,a.headers,a.code,c,A())},this.clientContext)}}class Ot extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.userDefinedFunction=i}get udf(){return this.userDefinedFunction}}class ts{get url(){return go(this.container.database.id,this.container.id,this.id)}constructor(e,t,r){this.container=e,this.id=t,this.clientContext=r}async read(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.udf,resourceId:i,options:e,diagnosticNode:t});return new Ot(s.result,s.headers,s.code,this,A())},this.clientContext)}async replace(e,t){return C(async r=>{e.body&&(e.body=e.body.toString());const i={};if(!V(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.udf,resourceId:o,options:t,diagnosticNode:r});return new Ot(a.result,a.headers,a.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.udf,resourceId:i,options:e,diagnosticNode:t});return new Ot(s.result,s.headers,s.code,this,A())},this.clientContext)}}class rc{constructor(e,t){this.container=e,this.clientContext=t}query(e,t){const r=T(this.container.url,x.udf),i=v(this.container.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.udf,resourceId:i,resultFn:a=>a.UserDefinedFunctions,query:e,options:o,diagnosticNode:s}))}readAll(e){return this.query(void 0,e)}async create(e,t){return C(async r=>{e.body&&(e.body=e.body.toString());const i={};if(!V(e,i))throw i;const s=T(this.container.url,x.udf),o=v(this.container.url),a=await this.clientContext.create({body:e,path:s,resourceType:x.udf,resourceId:o,options:t,diagnosticNode:r}),c=new ts(this.container,a.result.id,this.clientContext);return new Ot(a.result,a.headers,a.code,c,A())},this.clientContext)}}class ic{constructor(e,t){this.container=e,this.clientContext=t}storedProcedure(e){return new Ji(this.container,e,this.clientContext)}trigger(e){return new es(this.container,e,this.clientContext)}userDefinedFunction(e){return new ts(this.container,e,this.clientContext)}get storedProcedures(){return this.$sprocs||(this.$sprocs=new tc(this.container,this.clientContext)),this.$sprocs}get triggers(){return this.$triggers||(this.$triggers=new nc(this.container,this.clientContext)),this.$triggers}get userDefinedFunctions(){return this.$udfs||(this.$udfs=new rc(this.container,this.clientContext)),this.$udfs}}class ct extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.container=i}}class jt extends ee{constructor(e,t,r,i,s){super(e,t,r,i),this.offer=s}}class hr{get url(){return`/${p.Path.OffersPathSegment}/${this.id}`}constructor(e,t,r){this.client=e,this.id=t,this.clientContext=r}async read(e){return C(async t=>{const r=await this.clientContext.read({path:this.url,resourceType:x.offer,resourceId:this.id,options:e,diagnosticNode:t});return new jt(r.result,r.headers,r.code,A(),this)},this.clientContext)}async replace(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=await this.clientContext.replace({body:e,path:this.url,resourceType:x.offer,resourceId:this.id,options:t,diagnosticNode:r});return new jt(s.result,s.headers,s.code,A(),this)},this.clientContext)}}class sc{constructor(e,t){this.client=e,this.clientContext=t}query(e,t){return new xe(this.clientContext,e,t,(r,i)=>this.clientContext.queryFeed({path:"/offers",resourceType:x.offer,resourceId:"",resultFn:s=>s.Offers,query:e,options:i,diagnosticNode:r}))}readAll(e){return this.query(void 0,e)}}class ns{get items(){return this.$items||(this.$items=new ec(this,this.clientContext)),this.$items}get scripts(){return this.$scripts||(this.$scripts=new ic(this,this.clientContext)),this.$scripts}get conflicts(){return this.$conflicts||(this.$conflicts=new Da(this,this.clientContext)),this.$conflicts}get url(){return yt(this.database.id,this.id)}constructor(e,t,r){this.database=e,this.id=t,this.clientContext=r}item(e,t){return new Un(this,e,this.clientContext,t)}conflict(e,t){return new Ia(this,e,this.clientContext,t)}async read(e){return C(async t=>this.readInternal(t,e),this.clientContext)}async readInternal(e,t){const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.container,resourceId:i,options:t,diagnosticNode:e});return this.clientContext.partitionKeyDefinitionCache[this.url]=s.result.partitionKey,new ct(s.result,s.headers,s.code,this,A())}async replace(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.container,resourceId:o,options:t,diagnosticNode:r});return new ct(a.result,a.headers,a.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.container,resourceId:i,options:e,diagnosticNode:t});return new ct(s.result,s.headers,s.code,this,A())},this.clientContext)}async getPartitionKeyDefinition(){return C(async e=>this.readPartitionKeyDefinition(e),this.clientContext)}async readPartitionKeyDefinition(e){if(this.url in this.clientContext.partitionKeyDefinitionCache)return e.addData({readFromCache:!0}),new ee(this.clientContext.partitionKeyDefinitionCache[this.url],{},0,A());const{headers:t,statusCode:r,diagnostics:i}=await Ye(async s=>this.readInternal(s),e,Se.ContainerLookUp);return new ee(this.clientContext.partitionKeyDefinitionCache[this.url],t,r,i)}async readOffer(e={}){return C(async t=>{const{resource:r}=await this.read(),i="/offers",s=r._self,o=await this.clientContext.queryFeed({path:i,resourceId:"",resourceType:x.offer,query:`SELECT * from root where root.resource = "${s}"`,resultFn:c=>c.Offers,options:e,diagnosticNode:t}),a=o.result[0]?new hr(this.database.client,o.result[0].id,this.clientContext):void 0;return new jt(o.result[0],o.headers,o.code,A(),a)},this.clientContext)}async getQueryPlan(e){return C(async t=>{const r=T(this.url);return this.clientContext.getQueryPlan(r+"/docs",x.item,v(this.url),e,{},t)},this.clientContext)}readPartitionKeyRanges(e){return e=e||{},this.clientContext.queryPartitionKeyRanges(this.url,void 0,e)}async getFeedRanges(){return C(async e=>{const{resources:t}=await this.readPartitionKeyRanges().fetchAllInternal(e),r=[];for(const i of t){const s=new Xi(i.minInclusive,i.maxExclusive);Object.freeze(s),r.push(s)}return r},this.clientContext)}async deleteAllItemsForPartitionKey(e,t){return C(async r=>{let i=T(this.url);const s=v(this.url);i=i+"/operations/partitionkeydelete";const o=await this.clientContext.delete({path:i,resourceType:x.container,resourceId:s,options:t,partitionKey:e,method:z.post,diagnosticNode:r});return new ct(o.result,o.headers,o.code,this,A())},this.clientContext)}}function rs(n){if(n.throughput){if(n.maxThroughput)throw console.log("should be erroring"),new Error("Cannot specify `throughput` with `maxThroughput`");if(n.autoUpgradePolicy)throw new Error("Cannot specify autoUpgradePolicy with throughput. Use `maxThroughput` instead")}}class oc{constructor(e,t){this.database=e,this.clientContext=t}query(e,t){const r=T(this.database.url,x.container),i=v(this.database.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.container,resourceId:i,resultFn:a=>a.DocumentCollections,query:e,options:o,diagnosticNode:s}))}async create(e,t={}){return C(async r=>this.createInternal(r,e,t),this.clientContext)}async createInternal(e,t,r={}){const i={};if(!V(t,i))throw i;const s=T(this.database.url,x.container),o=v(this.database.url);if(rs(t),t.maxThroughput){const l={maxThroughput:t.maxThroughput};t.autoUpgradePolicy&&(l.autoUpgradePolicy=t.autoUpgradePolicy);const u=JSON.stringify(l);r.initialHeaders=Object.assign({},r.initialHeaders,{[p.HttpHeaders.AutoscaleSettings]:u}),delete t.maxThroughput,delete t.autoUpgradePolicy}if(t.throughput&&(r.initialHeaders=Object.assign({},r.initialHeaders,{[p.HttpHeaders.OfferThroughput]:t.throughput}),delete t.throughput),typeof t.partitionKey=="string"){if(!t.partitionKey.startsWith("/"))throw new Error("Partition key must start with '/'");t.partitionKey={paths:[t.partitionKey]}}(!t.partitionKey||!t.partitionKey.paths)&&(t.partitionKey={paths:[Tn]});const a=await this.clientContext.create({body:t,path:s,resourceType:x.container,resourceId:o,diagnosticNode:e,options:r}),c=new ns(this.database,a.result.id,this.clientContext);return new ct(a.result,a.headers,a.code,c,A())}async createIfNotExists(e,t){if(!e||e.id===null||e.id===void 0)throw new Error("body parameter must be an object with an id property");return C(async r=>{try{return await this.database.container(e.id).readInternal(r,t)}catch(i){if(i.code===F.NotFound){const s=await this.createInternal(r,e,t);return ye(s.headers,i.headers),s}else throw i}},this.clientContext)}readAll(e){return this.query(void 0,e)}}class lt extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.permission=i}}class Nn{get url(){return ho(this.user.database.id,this.user.id,this.id)}constructor(e,t,r){this.user=e,this.id=t,this.clientContext=r}async read(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.permission,resourceId:i,options:e,diagnosticNode:t});return new lt(s.result,s.headers,s.code,this,A())},this.clientContext)}async replace(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.permission,resourceId:o,options:t,diagnosticNode:r});return new lt(a.result,a.headers,a.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.permission,resourceId:i,options:e,diagnosticNode:t});return new lt(s.result,s.headers,s.code,this,A())},this.clientContext)}}class ac{constructor(e,t){this.user=e,this.clientContext=t}query(e,t){const r=T(this.user.url,x.permission),i=v(this.user.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.permission,resourceId:i,resultFn:a=>a.Permissions,query:e,options:o,diagnosticNode:s}))}readAll(e){return this.query(void 0,e)}async create(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.user.url,x.permission),o=v(this.user.url),a=await this.clientContext.create({body:e,path:s,resourceType:x.permission,resourceId:o,diagnosticNode:r,options:t}),c=new Nn(this.user,a.result.id,this.clientContext);return new lt(a.result,a.headers,a.code,c,A())},this.clientContext)}async upsert(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.user.url,x.permission),o=v(this.user.url),a=await this.clientContext.upsert({body:e,path:s,resourceType:x.permission,resourceId:o,options:t,diagnosticNode:r}),c=new Nn(this.user,a.result.id,this.clientContext);return new lt(a.result,a.headers,a.code,c,A())},this.clientContext)}}class dt extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.user=i}}class qn{get url(){return Ei(this.database.id,this.id)}constructor(e,t,r){this.database=e,this.id=t,this.clientContext=r,this.permissions=new ac(this,this.clientContext)}permission(e){return new Nn(this,e,this.clientContext)}async read(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.user,resourceId:i,options:e,diagnosticNode:t});return new dt(s.result,s.headers,s.code,this,A())},this.clientContext)}async replace(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.url),o=v(this.url),a=await this.clientContext.replace({body:e,path:s,resourceType:x.user,resourceId:o,options:t,diagnosticNode:r});return new dt(a.result,a.headers,a.code,this,A())},this.clientContext)}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.user,resourceId:i,options:e,diagnosticNode:t});return new dt(s.result,s.headers,s.code,this,A())},this.clientContext)}}class cc{constructor(e,t){this.database=e,this.clientContext=t}query(e,t){const r=T(this.database.url,x.user),i=v(this.database.url);return new xe(this.clientContext,e,t,(s,o)=>this.clientContext.queryFeed({path:r,resourceType:x.user,resourceId:i,resultFn:a=>a.Users,query:e,options:o,diagnosticNode:s}))}readAll(e){return this.query(void 0,e)}async create(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.database.url,x.user),o=v(this.database.url),a=await this.clientContext.create({body:e,path:s,resourceType:x.user,resourceId:o,options:t,diagnosticNode:r}),c=new qn(this.database,a.result.id,this.clientContext);return new dt(a.result,a.headers,a.code,c,A())},this.clientContext)}async upsert(e,t){return C(async r=>{const i={};if(!V(e,i))throw i;const s=T(this.database.url,x.user),o=v(this.database.url),a=await this.clientContext.upsert({body:e,path:s,resourceType:x.user,resourceId:o,options:t,diagnosticNode:r}),c=new qn(this.database,a.result.id,this.clientContext);return new dt(a.result,a.headers,a.code,c,A())},this.clientContext)}}class zn extends ee{constructor(e,t,r,i,s){super(e,t,r,s),this.database=i}}class is{get url(){return Xn(this.id)}constructor(e,t,r){this.client=e,this.id=t,this.clientContext=r,this.containers=new oc(this,this.clientContext),this.users=new cc(this,this.clientContext)}container(e){return new ns(this,e,this.clientContext)}user(e){return new qn(this,e,this.clientContext)}async read(e){return C(async t=>this.readInternal(t,e),this.clientContext)}async readInternal(e,t){const r=T(this.url),i=v(this.url),s=await this.clientContext.read({path:r,resourceType:x.database,resourceId:i,options:t,diagnosticNode:e});return new zn(s.result,s.headers,s.code,this,A())}async delete(e){return C(async t=>{const r=T(this.url),i=v(this.url),s=await this.clientContext.delete({path:r,resourceType:x.database,resourceId:i,options:e,diagnosticNode:t});return new zn(s.result,s.headers,s.code,this,A())},this.clientContext)}async readOffer(e={}){return C(async t=>{const{resource:r}=await Ye(async c=>this.readInternal(c),t,Se.DatabaseLookUp),i="/offers",s=r._self,o=await this.clientContext.queryFeed({path:i,resourceId:"",resourceType:x.offer,query:`SELECT * from root where root.resource = "${s}"`,resultFn:c=>c.Offers,options:e,diagnosticNode:t}),a=o.result[0]?new hr(this.client,o.result[0].id,this.clientContext):void 0;return new jt(o.result[0],o.headers,o.code,A(),a)},this.clientContext)}}class uc{constructor(e,t){this.client=e,this.clientContext=t}query(e,t){const r=(i,s)=>this.clientContext.queryFeed({path:"/dbs",resourceType:x.database,resourceId:"",resultFn:o=>o.Databases,query:e,options:s,diagnosticNode:i});return new xe(this.clientContext,e,t,r)}async create(e,t={}){return C(async r=>this.createInternal(r,e,t),this.clientContext)}async createInternal(e,t,r={}){const i={};if(!V(t,i))throw i;if(rs(t),t.maxThroughput){const c={maxThroughput:t.maxThroughput};t.autoUpgradePolicy&&(c.autoUpgradePolicy=t.autoUpgradePolicy);const l=JSON.stringify(c);r.initialHeaders=Object.assign({},r.initialHeaders,{[p.HttpHeaders.AutoscaleSettings]:l}),delete t.maxThroughput,delete t.autoUpgradePolicy}t.throughput&&(r.initialHeaders=Object.assign({},r.initialHeaders,{[p.HttpHeaders.OfferThroughput]:t.throughput}),delete t.throughput);const o=await this.clientContext.create({body:t,path:"/dbs",resourceType:x.database,resourceId:void 0,diagnosticNode:e,options:r}),a=new is(this.client,t.id,this.clientContext);return new zn(o.result,o.headers,o.code,a,A())}async createIfNotExists(e,t){if(!e||e.id===null||e.id===void 0)throw new Error("body parameter must be an object with an id property");return C(async r=>{try{return await this.client.database(e.id).readInternal(r,t)}catch(i){if(i.code===F.NotFound){const s=await this.createInternal(r,e,t);return ye(s.headers,i.headers),s}else throw i}},this.clientContext)}readAll(e){return this.query(void 0,e)}}const ei=new Set(["Deserialize","Serialize","Retry","Sign"]);class Bt{constructor(e){var t;this._policies=[],this._policies=(t=e==null?void 0:e.slice(0))!==null&&t!==void 0?t:[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!ei.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!ei.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter(r=>e.name&&r.policy.name===e.name||e.phase&&r.options.phase===e.phase?(t.push(r.policy),!1):!0),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((s,o)=>a=>o.sendRequest(a,s),s=>e.sendRequest(s))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new Bt(this._policies)}static create(){return new Bt}orderPolicies(){const e=[],t=new Map;function r(m){return{name:m,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}const i=r("Serialize"),s=r("None"),o=r("Deserialize"),a=r("Retry"),c=r("Sign"),l=[i,s,o,a,c];function u(m){return m==="Retry"?a:m==="Serialize"?i:m==="Deserialize"?o:m==="Sign"?c:s}for(const m of this._policies){const g=m.policy,R=m.options,b=g.name;if(t.has(b))throw new Error("Duplicate policy names not allowed in pipeline");const I={policy:g,dependsOn:new Set,dependants:new Set};R.afterPhase&&(I.afterPhase=u(R.afterPhase),I.afterPhase.hasAfterPolicies=!0),t.set(b,I),u(R.phase).policies.add(I)}for(const m of this._policies){const{policy:g,options:R}=m,b=g.name,I=t.get(b);if(!I)throw new Error(`Missing node for policy ${b}`);if(R.afterPolicies)for(const M of R.afterPolicies){const $=t.get(M);$&&(I.dependsOn.add($),$.dependants.add(I))}if(R.beforePolicies)for(const M of R.beforePolicies){const $=t.get(M);$&&($.dependsOn.add(I),I.dependants.add($))}}function h(m){m.hasRun=!0;for(const g of m.policies)if(!(g.afterPhase&&(!g.afterPhase.hasRun||g.afterPhase.policies.size))&&g.dependsOn.size===0){e.push(g.policy);for(const R of g.dependants)R.dependsOn.delete(g);t.delete(g.policy.name),m.policies.delete(g)}}function f(){for(const m of l){if(h(m),m.policies.size>0&&m!==s){s.hasRun||h(s);return}m.hasAfterPolicies&&h(s)}}let w=0;for(;t.size>0;){w++;const m=e.length;if(f(),e.length<=m&&w>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}function lc(){return Bt.create()}const dc=He("core-rest-pipeline");class ss extends Error{constructor(e){super(e),this.name="AbortError"}}function hc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}function fc(){let n="";for(let e=0;e<32;e++){const t=Math.floor(Math.random()*16);e===12?n+="4":e===16?n+=t&3|8:n+=t.toString(16),(e===7||e===11||e===15||e===19)&&(n+="-")}return n}var hn;const pc=typeof((hn=globalThis==null?void 0:globalThis.crypto)===null||hn===void 0?void 0:hn.randomUUID)=="function"?globalThis.crypto.randomUUID.bind(globalThis.crypto):fc;function gc(){return pc()}const fn="REDACTED",mc=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],yc=["api-version"];class wc{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=mc.concat(e),t=yc.concat(t),this.allowedHeaderNames=new Set(e.map(r=>r.toLowerCase())),this.allowedQueryParameters=new Set(t.map(r=>r.toLowerCase()))}sanitize(e){const t=new Set;return JSON.stringify(e,(r,i)=>{if(i instanceof Error)return Object.assign(Object.assign({},i),{name:i.name,message:i.message});if(r==="headers")return this.sanitizeHeaders(i);if(r==="url")return this.sanitizeUrl(i);if(r==="query")return this.sanitizeQuery(i);if(r==="body")return;if(r==="response")return;if(r==="operationSpec")return;if(Array.isArray(i)||hc(i)){if(t.has(i))return"[Circular]";t.add(i)}return i},2)}sanitizeHeaders(e){const t={};for(const r of Object.keys(e))this.allowedHeaderNames.has(r.toLowerCase())?t[r]=e[r]:t[r]=fn;return t}sanitizeQuery(e){if(typeof e!="object"||e===null)return e;const t={};for(const r of Object.keys(e))this.allowedQueryParameters.has(r.toLowerCase())?t[r]=e[r]:t[r]=fn;return t}sanitizeUrl(e){if(typeof e!="string"||e===null)return e;const t=new URL(e);if(!t.search)return e;for(const[r]of t.searchParams)this.allowedQueryParameters.has(r.toLowerCase())||t.searchParams.set(r,fn);return t.toString()}}const xc="The operation was aborted.";function Rc(n,e,t){return new Promise((r,i)=>{let s,o;const a=()=>i(new ss(t!=null&&t.abortErrorMsg?t==null?void 0:t.abortErrorMsg:xc)),c=()=>{t!=null&&t.abortSignal&&o&&t.abortSignal.removeEventListener("abort",o)};if(o=()=>(s&&clearTimeout(s),c(),a()),t!=null&&t.abortSignal&&t.abortSignal.aborted)return a();s=setTimeout(()=>{c(),r(e)},n),t!=null&&t.abortSignal&&t.abortSignal.addEventListener("abort",o)})}function It(n){return n.toLowerCase()}function*bc(n){for(const e of n.values())yield[e.name,e.value]}class Cc{constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(It(e),{name:e,value:String(t).trim()})}get(e){var t;return(t=this._headersMap.get(It(e)))===null||t===void 0?void 0:t.value}has(e){return this._headersMap.has(It(e))}delete(e){this._headersMap.delete(It(e))}toJSON(e={}){const t={};if(e.preserveCase)for(const r of this._headersMap.values())t[r.name]=r.value;else for(const[r,i]of this._headersMap)t[r]=i.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return bc(this._headersMap)}}function fr(n){return new Cc(n)}const Tc={},Ec=new wc;class Ze extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,this.request=t.request,this.response=t.response,Object.setPrototypeOf(this,Ze.prototype)}[Tc](){return`RestError: ${this.message} 
 ${Ec.sanitize(this)}`}}Ze.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";Ze.PARSE_ERROR="PARSE_ERROR";function vc(n){return!!(n&&typeof n.pipe=="function")}function os(n){return!!(n&&typeof n.getReader=="function"&&typeof n.tee=="function")}function Ac(n){return(typeof Blob=="function"||typeof Blob=="object")&&n instanceof Blob}class _c{async sendRequest(e){if(new URL(e.url).protocol!=="https:"&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await Ic(e)}catch(i){throw Sc(i,e)}}}async function Ic(n){const{abortController:e,abortControllerCleanup:t}=Pc(n);try{const r=Mc(n.headers),{streaming:i,body:s}=Lc(n),o=Object.assign(Object.assign({body:s,method:n.method,headers:r,signal:e.signal},"credentials"in Request.prototype?{credentials:n.withCredentials?"include":"same-origin"}:{}),"cache"in Request.prototype?{cache:"no-store"}:{});i&&(o.duplex="half");const a=await fetch(n.url,o);return Ac(n.body)&&n.onUploadProgress&&n.onUploadProgress({loadedBytes:n.body.size}),Dc(a,n,t)}catch(r){throw t==null||t(),r}}async function Dc(n,e,t){var r,i;const s=Oc(n),o={request:e,headers:s,status:n.status},a=os(n.body)?as(n.body,{onProgress:e.onDownloadProgress,onEnd:t}):n.body;if(!((r=e.streamResponseStatusCodes)===null||r===void 0)&&r.has(Number.POSITIVE_INFINITY)||!((i=e.streamResponseStatusCodes)===null||i===void 0)&&i.has(o.status))if(e.enableBrowserStreams)o.browserStreamBody=a??void 0;else{const c=new Response(a);o.blobBody=c.blob(),t==null||t()}else{const c=new Response(a);o.bodyAsText=await c.text(),t==null||t()}return o}function Pc(n){const e=new AbortController;let t,r;if(n.abortSignal){if(n.abortSignal.aborted)throw new ss("The operation was aborted.");r=i=>{i.type==="abort"&&e.abort()},n.abortSignal.addEventListener("abort",r),t=()=>{var i;r&&((i=n.abortSignal)===null||i===void 0||i.removeEventListener("abort",r))}}return n.timeout>0&&setTimeout(()=>{e.abort()},n.timeout),{abortController:e,abortControllerCleanup:t}}function Sc(n,e){var t;return n&&(n==null?void 0:n.name)==="AbortError"?n:new Ze(`Error sending request: ${n.message}`,{code:(t=n==null?void 0:n.code)!==null&&t!==void 0?t:Ze.REQUEST_SEND_ERROR,request:e})}function Mc(n){const e=new Headers;for(const[t,r]of n)e.append(t,r);return e}function Oc(n){const e=fr();for(const[t,r]of n.headers)e.set(t,r);return e}function Lc(n){const e=typeof n.body=="function"?n.body():n.body;if(vc(e))throw new Error("Node streams are not supported in browser environment.");return os(e)?{streaming:!0,body:as(e,{onProgress:n.onUploadProgress})}:{streaming:!1,body:e}}function as(n,e={}){let t=0;const{onProgress:r,onEnd:i}=e;if(Hc(n))return n.pipeThrough(new TransformStream({transform(s,o){if(s===null){o.terminate();return}o.enqueue(s),t+=s.length,r&&r({loadedBytes:t})},flush(){i==null||i()}}));{const s=n.getReader();return new ReadableStream({async pull(o){var a;const{done:c,value:l}=await s.read();if(c||!l){i==null||i(),o.close(),s.releaseLock();return}t+=(a=l==null?void 0:l.length)!==null&&a!==void 0?a:0,o.enqueue(l),r&&r({loadedBytes:t})},cancel(o){return i==null||i(),s.cancel(o)}})}}function kc(){return new _c}function Hc(n){return n.pipeThrough!==void 0&&self.TransformStream!==void 0}function Uc(){return kc()}class Fc{constructor(e){var t,r,i,s,o,a,c;this.url=e.url,this.body=e.body,this.headers=(t=e.headers)!==null&&t!==void 0?t:fr(),this.method=(r=e.method)!==null&&r!==void 0?r:"GET",this.timeout=(i=e.timeout)!==null&&i!==void 0?i:0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=(s=e.disableKeepAlive)!==null&&s!==void 0?s:!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=(o=e.withCredentials)!==null&&o!==void 0?o:!1,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||gc(),this.allowInsecureConnection=(a=e.allowInsecureConnection)!==null&&a!==void 0?a:!1,this.enableBrowserStreams=(c=e.enableBrowserStreams)!==null&&c!==void 0?c:!1}}function Nc(n){return new Fc(n)}const qc={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:1e3*60*2};async function zc(n,e,t){async function r(){if(Date.now()<t)try{return await n()}catch{return null}else{const s=await n();if(s===null)throw new Error("Failed to refresh access token.");return s}}let i=await r();for(;i===null;)await Rc(e),i=await r();return i}function jc(n,e){let t=null,r=null,i;const s=Object.assign(Object.assign({},qc),e),o={get isRefreshing(){return t!==null},get shouldRefresh(){var c;return!o.isRefreshing&&((c=r==null?void 0:r.expiresOnTimestamp)!==null&&c!==void 0?c:0)-s.refreshWindowInMs<Date.now()},get mustRefresh(){return r===null||r.expiresOnTimestamp-s.forcedRefreshWindowInMs<Date.now()}};function a(c,l){var u;return o.isRefreshing||(t=zc(()=>n.getToken(c,l),s.retryIntervalInMs,(u=r==null?void 0:r.expiresOnTimestamp)!==null&&u!==void 0?u:Date.now()).then(f=>(t=null,r=f,i=l.tenantId,r)).catch(f=>{throw t=null,r=null,i=void 0,f})),t}return async(c,l)=>i!==l.tenantId||!!l.claims||o.mustRefresh?a(c,l):(o.shouldRefresh&&a(c,l),r)}const Bc="bearerTokenAuthenticationPolicy";async function Kc(n){const{scopes:e,getAccessToken:t,request:r}=n,i={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions},s=await t(e,i);s&&n.request.headers.set("Authorization",`Bearer ${s.token}`)}function Wc(n){const e=n.headers.get("WWW-Authenticate");if(n.status===401&&e)return e}function Qc(n){var e;const{credential:t,scopes:r,challengeCallbacks:i}=n,s=n.logger||dc,o=Object.assign({authorizeRequest:(e=i==null?void 0:i.authorizeRequest)!==null&&e!==void 0?e:Kc,authorizeRequestOnChallenge:i==null?void 0:i.authorizeRequestOnChallenge},i),a=t?jc(t):()=>Promise.resolve(null);return{name:Bc,async sendRequest(c,l){if(!c.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");await o.authorizeRequest({scopes:Array.isArray(r)?r:[r],request:c,getAccessToken:a,logger:s});let u,h;try{u=await l(c)}catch(f){h=f,u=f.response}if(o.authorizeRequestOnChallenge&&(u==null?void 0:u.status)===401&&Wc(u)&&await o.authorizeRequestOnChallenge({scopes:Array.isArray(r)?r:[r],request:c,response:u,getAccessToken:a,logger:s}))return l(c);if(h)throw h;return u}}}var re;(function(n){n.request="request",n.operation="operation"})(re||(re={}));async function ge(n,e,t,r){if(!e.plugins)return t(e,n,void 0);let i=0;const s=o=>++i>=o.plugins.length?t(e,n,void 0):o.plugins[i].on!==r?s(e):o.plugins[i].plugin(o,n,s);return e.plugins[i].on!==r?s(e):e.plugins[i].plugin(e,n,s)}const pr=typeof self<"u"?self:typeof window<"u"?window:void 0;if(!pr)throw new Error("Unable to find global scope. Are you sure this is running in the browser?");if(!pr.AbortController)throw new Error('Could not find "AbortController" in the global scope. You need to polyfill it first');var $c=pr.AbortController;const Vc=10004,Gc=10009,Yc=10013,Xc=10014,Zc=10022,Jc=10035,eu=10036,tu=10048,nu=10054,ru=10058,iu=10060,su=10061,ou=10063,au=10064,cu=10065,uu="ECONNRESET",lu="EPIPE",du=[Vc,Gc,Yc,Xc,Zc,Jc,eu,tu,nu,ru,iu,su,ou,au,cu,uu,gt,lu];function hu(n,e){return(n===E.Read||n===E.Query)&&du.indexOf(e)!==-1}class fu{constructor(e){this.operationType=e,this.maxTries=10,this.currentRetryAttemptCount=0,this.retryAfterInMs=1e3}async shouldRetry(e,t){return e&&this.currentRetryAttemptCount<this.maxTries&&hu(this.operationType,e.code)?(t.addData({successfulRetryPolicy:"default"}),this.currentRetryAttemptCount++,!0):!1}}class Je{constructor(e,t){this.globalEndpointManager=e,this.operationType=t,this.maxTries=Je.maxTries,this.currentRetryAttemptCount=0,this.retryAfterInMs=Je.retryAfterInMs}async shouldRetry(e,t,r,i){return!e||!r||!i||!this.globalEndpointManager.enableEndpointDiscovery||this.currentRetryAttemptCount>=this.maxTries?!1:(this.currentRetryAttemptCount++,ht(this.operationType)?await this.globalEndpointManager.markCurrentLocationUnavailableForRead(t,i):await this.globalEndpointManager.markCurrentLocationUnavailableForWrite(t,i),r.retryCount=this.currentRetryAttemptCount,r.clearSessionTokenNotAvailable=!1,r.retryRequestOnPreferredLocations=!1,t.addData({successfulRetryPolicy:"endpointDiscovery"}),!0)}}Je.maxTries=120;Je.retryAfterInMs=1e3;class pu{constructor(e=9,t=0,r=30){this.maxTries=e,this.fixedRetryIntervalInMs=t,this.currentRetryAttemptCount=0,this.cummulativeWaitTimeinMs=0,this.retryAfterInMs=0,this.timeoutInMs=r*1e3,this.currentRetryAttemptCount=0,this.cummulativeWaitTimeinMs=0}async shouldRetry(e,t){return e&&this.currentRetryAttemptCount<this.maxTries&&(this.currentRetryAttemptCount++,this.retryAfterInMs=0,this.fixedRetryIntervalInMs?this.retryAfterInMs=this.fixedRetryIntervalInMs:e.retryAfterInMs&&(this.retryAfterInMs=e.retryAfterInMs),this.cummulativeWaitTimeinMs<this.timeoutInMs)?(this.cummulativeWaitTimeinMs+=this.retryAfterInMs,t.addData({successfulRetryPolicy:"resourceThrottle"}),!0):!1}}class gu{constructor(e,t,r,i){this.globalEndpointManager=e,this.resourceType=t,this.operationType=r,this.connectionPolicy=i,this.currentRetryAttemptCount=0,this.retryAfterInMs=0}async shouldRetry(e,t,r){if(!e||!r||!this.connectionPolicy.enableEndpointDiscovery)return!1;if(this.globalEndpointManager.canUseMultipleWriteLocations(this.resourceType,this.operationType)){const i=ht(this.operationType)?await this.globalEndpointManager.getReadEndpoints():await this.globalEndpointManager.getWriteEndpoints();return this.currentRetryAttemptCount>i.length?!1:(this.currentRetryAttemptCount++,r.retryCount++,r.retryRequestOnPreferredLocations=this.currentRetryAttemptCount>1,r.clearSessionTokenNotAvailable=this.currentRetryAttemptCount===i.length,t.addData({successfulRetryPolicy:"session"}),!0)}else return this.currentRetryAttemptCount>1?!1:(this.currentRetryAttemptCount++,r.retryCount++,r.retryRequestOnPreferredLocations=!1,r.clearSessionTokenNotAvailable=!0,t.addData({successfulRetryPolicy:"session"}),!0)}}class mu{constructor(e,t,r,i,s,o){this.globalEndpointManager=e,this.headers=t,this.methodType=r,this.resourceType=i,this.operationType=s,this.enableEndPointDiscovery=o,this.maxRetryAttemptCount=120,this.maxServiceUnavailableRetryCount=1,this.retryAfterInMs=0,this.failoverRetryCount=0}isValidRequestForTimeoutError(){const e=p.HttpHeaders.IsQuery in this.headers,t=p.HttpHeaders.IsQueryPlan in this.headers;return!!(this.methodType===z.get||e||t)}async shouldRetry(e,t,r,i){if(!e||!r||!i||e.code===gt&&!this.isValidRequestForTimeoutError()||!this.enableEndPointDiscovery||e.code===F.ServiceUnavailable&&this.failoverRetryCount>=this.maxServiceUnavailableRetryCount||this.failoverRetryCount>=this.maxRetryAttemptCount)return!1;const s=this.globalEndpointManager.canUseMultipleWriteLocations(this.resourceType,this.operationType),o=ht(this.operationType);return!s&&!o?!1:(this.failoverRetryCount++,r.retryLocationServerIndex=await this.findEndpointIndex(this.failoverRetryCount),t.addData({successfulRetryPolicy:"timeout-failover"}),!0)}async findEndpointIndex(e){const t=this.globalEndpointManager.preferredLocationsCount,r=ht(this.operationType);let i=0;if(t!==0)i=e%t;else if(r){const s=await this.globalEndpointManager.getReadEndpoints();s&&s.length>0&&(i=e%s.length)}else{const s=await this.globalEndpointManager.getWriteEndpoints();s&&s.length>0&&(i=e%s.length)}return i}}async function cs({diagnosticNode:n,retryContext:e={retryCount:0},retryPolicies:t,requestContext:r,executeRequest:i}){return xt(async s=>{s.addData({requestAttempNumber:e.retryCount}),t||(t={endpointDiscoveryRetryPolicy:new Je(r.globalEndpointManager,r.operationType),resourceThrottleRetryPolicy:new pu(r.connectionPolicy.retryOptions.maxRetryAttemptCount,r.connectionPolicy.retryOptions.fixedRetryIntervalInMilliseconds,r.connectionPolicy.retryOptions.maxWaitTimeInSeconds),sessionReadRetryPolicy:new gu(r.globalEndpointManager,r.resourceType,r.operationType,r.connectionPolicy),defaultRetryPolicy:new fu(r.operationType),timeoutFailoverRetryPolicy:new mu(r.globalEndpointManager,r.headers,r.method,r.resourceType,r.operationType,r.connectionPolicy.enableEndpointDiscovery)}),e&&e.clearSessionTokenNotAvailable&&(r.client.clearSessionToken(r.path),delete r.headers["x-ms-session-token"]),e&&e.retryLocationServerIndex?r.endpoint=await r.globalEndpointManager.resolveServiceEndpoint(s,r.resourceType,r.operationType,e.retryLocationServerIndex):r.endpoint=await r.globalEndpointManager.resolveServiceEndpoint(s,r.resourceType,r.operationType);const o=me();try{const a=await i(s,r);return a.headers[p.ThrottleRetryCount]=t.resourceThrottleRetryPolicy.currentRetryAttemptCount,a.headers[p.ThrottleRetryWaitTimeInMs]=t.resourceThrottleRetryPolicy.cummulativeWaitTimeinMs,a}catch(a){let c=null;const l=a.headers||{};a.code===F.ENOTFOUND||a.code==="REQUEST_SEND_ERROR"||a.code===F.Forbidden&&(a.substatus===Le.DatabaseAccountNotFound||a.substatus===Le.WriteForbidden)?c=t.endpointDiscoveryRetryPolicy:a.code===F.TooManyRequests?c=t.resourceThrottleRetryPolicy:a.code===F.NotFound&&a.substatus===Le.ReadSessionNotAvailable?c=t.sessionReadRetryPolicy:a.code===F.ServiceUnavailable||a.code===gt?c=t.timeoutFailoverRetryPolicy:c=t.defaultRetryPolicy;const u=await c.shouldRetry(a,s,e,r.endpoint);if(u){r.retryCount++;const h=u[1];return h!==void 0&&(r.endpoint=h),s.recordFailedNetworkCall(o,r,e.retryCount,a.code,a.subsstatusCode,l),await so(c.retryAfterInMs),cs({diagnosticNode:n,executeRequest:i,requestContext:r,retryContext:e,retryPolicies:t})}else throw l[p.ThrottleRetryCount]=t.resourceThrottleRetryPolicy.currentRetryAttemptCount,l[p.ThrottleRetryWaitTimeInMs]=t.resourceThrottleRetryPolicy.cummulativeWaitTimeinMs,a.headers=Object.assign(Object.assign({},a.headers),l),a}},n,te.HTTP_REQUEST)}let yu,wu,pn;function xu(){return pn||(pn=Uc()),pn}const Ru=He("RequestHandler");async function bu(n,e){return ge(n,e,Cu,re.request)}async function Cu(n,e){const t=new $c,r=t.signal,i=n.options&&n.options.abortSignal;i&&(i.aborted?t.abort():i.addEventListener("abort",()=>{t.abort()}));const s=setTimeout(()=>{t.abort()},n.connectionPolicy.requestTimeout);let o;n.body&&(n.body=rr(n.body));const a=xu(),c=Ci(n.endpoint,n.path),l=fr(n.headers),u=Nc({url:c,headers:l,method:n.method,abortSignal:r,body:n.body});if(n.requestAgent)u.agent=n.requestAgent;else{const g=new URL(c);u.agent=g.protocol==="http"?yu:wu}const h=me();try{n.pipeline?o=await n.pipeline.sendRequest(a,u):o=await a.sendRequest(u)}catch(g){throw g.name==="AbortError"?i&&i.aborted===!0?(clearTimeout(s),g):new Jo(`Timeout Error! Request took more than ${n.connectionPolicy.requestTimeout} ms`):g}clearTimeout(s);const f=o.status===204||o.status===304||o.bodyAsText===""?null:JSON.parse(o.bodyAsText),w=o.headers.toJSON(),m=w[p.HttpHeaders.SubStatus]?parseInt(w[p.HttpHeaders.SubStatus],10):void 0;if(e.recordSuccessfulNetworkCall(h,n,o,m,c),o.status>=400){const g=new j(f.message);throw Ru.warning(o.status+" "+n.endpoint+" "+n.path+" "+f.message),g.code=o.status,g.body=f,g.headers=w,p.HttpHeaders.ActivityId in w&&(g.activityId=w[p.HttpHeaders.ActivityId]),p.HttpHeaders.SubStatus in w&&(g.substatus=m),p.HttpHeaders.RetryAfterInMs in w&&(g.retryAfterInMs=parseInt(w[p.HttpHeaders.RetryAfterInMs],10),Object.defineProperty(g,"retryAfterInMilliseconds",{get:()=>g.retryAfterInMs})),g}return{headers:w,result:f,code:o.status,substatus:m}}async function Tu(n,e){if(n.body&&(n.body=rr(n.body),!n.body))throw new Error("parameter data must be a javascript object, string, or Buffer");return xt(async t=>cs({diagnosticNode:t,requestContext:n,executeRequest:bu}),e,te.REQUEST_ATTEMPTS)}const ue={request:Tu};class se{constructor(e,t,r,i){if(this.version=e,this.globalLsn=t,this.localLsnByregion=r,this.sessionToken=i,!this.sessionToken){const s=[];for(const[a,c]of this.localLsnByregion.entries())s.push(`${a}${se.REGION_PROGRESS_SEPARATOR}${c}`);const o=s.join(se.SEGMENT_SEPARATOR);o===""?this.sessionToken=`${this.version}${se.SEGMENT_SEPARATOR}${this.globalLsn}`:this.sessionToken=`${this.version}${se.SEGMENT_SEPARATOR}${this.globalLsn}${se.SEGMENT_SEPARATOR}${o}`}}static create(e){const[t,r,...i]=e.split(se.SEGMENT_SEPARATOR),s=parseInt(t,10),o=parseFloat(r);if(typeof s!="number"||typeof o!="number")return null;const a=new Map;for(const c of i){const[l,u]=c.split(se.REGION_PROGRESS_SEPARATOR);if(!l||!u)return null;const h=parseInt(l,10);let f;try{f=u}catch{return null}if(typeof h!="number")return null;a.set(h,f)}return new se(s,o,a,e)}equals(e){return e?this.version===e.version&&this.globalLsn===e.globalLsn&&this.areRegionProgressEqual(e.localLsnByregion):!1}merge(e){if(e==null)throw new Error("other (Vector Session Token) must not be null");if(this.version===e.version&&this.localLsnByregion.size!==e.localLsnByregion.size)throw new Error(`Compared session tokens ${this.sessionToken} and ${e.sessionToken} have unexpected regions`);const[t,r]=this.version<e.version?[e,this]:[this,e],i=new Map;for(const[s,o]of t.localLsnByregion.entries()){const a=r.localLsnByregion.get(s);if(a)i.set(s,Eu(o,a));else{if(this.version===e.version)throw new Error(`Compared session tokens have unexpected regions. Session 1: ${this.sessionToken} - Session 2: ${this.sessionToken}`);i.set(s,o)}}return new se(Math.max(this.version,e.version),Math.max(this.globalLsn,e.globalLsn),i)}toString(){return this.sessionToken}areRegionProgressEqual(e){if(this.localLsnByregion.size!==e.size)return!1;for(const[t,r]of this.localLsnByregion.entries()){const i=e.get(t);if(r!==i)return!1}return!0}}se.SEGMENT_SEPARATOR="#";se.REGION_PROGRESS_SEPARATOR="=";function Eu(n,e){return n.length===e.length?n>e?n:e:n.length>e.length?n:e}class oe{constructor(e=new Map,t=new Map){this.collectionNameToCollectionResourceId=e,this.collectionResourceIdToSessionTokens=t}get(e){if(!e)throw new Error("request cannot be null");const t=cn(Ve(e.resourceAddress)),r=this.getPartitionKeyRangeIdToTokenMap(t);return oe.getCombinedSessionTokenString(r)}remove(e){let t;const r=Ve(e.resourceAddress),i=cn(r);i&&(t=this.collectionNameToCollectionResourceId.get(i),this.collectionNameToCollectionResourceId.delete(i)),t!==void 0&&this.collectionResourceIdToSessionTokens.delete(t)}set(e,t){if(!t||oe.isReadingFromMaster(e.resourceType,e.operationType))return;const r=t[p.HttpHeaders.SessionToken];if(!r)return;const i=this.getContainerName(e,t),s=e.isNameBased&&t[p.HttpHeaders.OwnerId]||e.resourceId;if(s&&i&&this.validateOwnerID(s)){this.collectionResourceIdToSessionTokens.has(s)||this.collectionResourceIdToSessionTokens.set(s,new Map),this.collectionNameToCollectionResourceId.has(i)||this.collectionNameToCollectionResourceId.set(i,s);const o=this.collectionResourceIdToSessionTokens.get(s);oe.compareAndSetToken(r,o)}}validateOwnerID(e){return Ut(e.replace(/-/g,"/")).length===8}getPartitionKeyRangeIdToTokenMap(e){let t=null;return e&&this.collectionNameToCollectionResourceId.has(e)&&(t=this.collectionResourceIdToSessionTokens.get(this.collectionNameToCollectionResourceId.get(e))),t}static getCombinedSessionTokenString(e){if(!e||e.size===0)return oe.EMPTY_SESSION_TOKEN;let t="";for(const[r,i]of e.entries())t+=r+oe.SESSION_TOKEN_PARTITION_SPLITTER+i.toString()+oe.SESSION_TOKEN_SEPARATOR;return t.slice(0,-1)}static compareAndSetToken(e,t){if(!e)return;const r=e.split(oe.SESSION_TOKEN_SEPARATOR);for(const i of r){const s=i.split(oe.SESSION_TOKEN_PARTITION_SPLITTER);if(s.length!==2)return;const o=s[0],a=se.create(s[1]),c=t.get(o)?t.get(o).merge(a):a;t.set(o,c)}}static isReadingFromMaster(e,t){return e===p.Path.OffersPathSegment||e===p.Path.DatabasesPathSegment||e===p.Path.UsersPathSegment||e===p.Path.PermissionsPathSegment||e===p.Path.TopologyPathSegment||e===p.Path.DatabaseAccountPathSegment||e===p.Path.PartitionKeyRangesPathSegment||e===p.Path.CollectionsPathSegment&&t===E.Query}getContainerName(e,t){let r=t[p.HttpHeaders.OwnerFullName];return r||(r=Ve(e.resourceAddress)),cn(r)}}oe.EMPTY_SESSION_TOKEN="";oe.SESSION_TOKEN_SEPARATOR=",";oe.SESSION_TOKEN_PARTITION_SPLITTER=":";function vu(n){return new URL(n)}function Au(n){return new URL(n).href.replace(/\/$/,"")}class _u{constructor(){this.logger=He("CosmosDBDiagnostics")}async write(e){this.logger.verbose(e)}}class Iu{async write(e){}}class Du{format(e){return JSON.stringify(e)}}const Pu=wt,gn=He("ClientContext"),ti="application/query+json",q=p.HttpHeaders;class Su{constructor(e,t,r,i){if(this.cosmosClientOptions=e,this.globalEndpointManager=t,this.clientConfig=r,this.diagnosticLevel=i,this.connectionPolicy=e.connectionPolicy,this.sessionContainer=new oe,this.partitionKeyDefinitionCache={},this.pipeline=null,e.aadCredentials){this.pipeline=lc();const o=`${Au(e.endpoint)}/.default`;this.pipeline.addPolicy(Qc({credential:e.aadCredentials,scopes:o,challengeCallbacks:{async authorizeRequest({request:a,getAccessToken:c}){const h=`type=aad&ver=1.0&sig=${(await c([o],{})).token}`;a.headers.set("Authorization",h)}}}))}this.initializeDiagnosticSettings(i)}async read({path:e,resourceType:t,resourceId:r,options:i={},partitionKey:s,diagnosticNode:o}){try{const a=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.get,path:e,operationType:E.Read,resourceId:r,options:i,resourceType:t,partitionKey:s});o.addData({operationType:E.Read,resourceType:t}),a.headers=await this.buildHeaders(a),this.applySessionToken(a),a.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(o,a.resourceType,a.operationType);const c=await ge(o,a,ue.request,re.operation);return this.captureSessionToken(void 0,e,E.Read,c.headers),c}catch(a){throw this.captureSessionToken(a,e,E.Upsert,a.headers),a}}async queryFeed({path:e,resourceType:t,resourceId:r,resultFn:i,query:s,options:o,diagnosticNode:a,partitionKeyRangeId:c,partitionKey:l,startEpk:u,endEpk:h}){const f=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.get,path:e,operationType:E.Query,partitionKeyRangeId:c,resourceId:r,resourceType:t,options:o,body:s,partitionKey:l});a.addData({operationType:E.Query,resourceType:t});const w=Pu();s!==void 0&&(f.method=z.post),f.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(a,f.resourceType,f.operationType),f.headers=await this.buildHeaders(f),u!==void 0&&h!==void 0&&(f.headers[q.StartEpk]=u,f.headers[q.EndEpk]=h,f.headers[q.ReadFeedKeyType]="EffectivePartitionKeyRange"),s!==void 0&&(f.headers[q.IsQuery]="true",f.headers[q.ContentType]=ti,typeof s=="string"&&(f.body={query:s})),this.applySessionToken(f),gn.info("query "+w+" started"+(f.partitionKeyRangeId?" pkrid: "+f.partitionKeyRangeId:"")),gn.verbose(f);const m=Date.now(),g=await ue.request(f,a);return gn.info("query "+w+" finished - "+(Date.now()-m)+"ms"),this.captureSessionToken(void 0,e,E.Query,g.headers),this.processQueryFeedResponse(g,!!s,i)}async getQueryPlan(e,t,r,i,s={},o){const a=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.post,path:e,operationType:E.Read,resourceId:r,resourceType:t,options:s,body:i});o.addData({operationType:E.Read,resourceType:t}),a.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(o,a.resourceType,a.operationType),a.headers=await this.buildHeaders(a),a.headers[q.IsQueryPlan]="True",a.headers[q.QueryVersion]="1.4",a.headers[q.SupportedQueryFeatures]="NonValueAggregate, Aggregate, Distinct, MultipleOrderBy, OffsetAndLimit, OrderBy, Top, CompositeAggregate, GroupBy, MultipleAggregates",a.headers[q.ContentType]=ti,typeof i=="string"&&(a.body={query:i}),this.applySessionToken(a);const c=await ue.request(a,o);return this.captureSessionToken(void 0,e,E.Query,c.headers),c}queryPartitionKeyRanges(e,t,r){const i=T(e,x.pkranges),s=v(e),o=async(a,c)=>await this.queryFeed({path:i,resourceType:x.pkranges,resourceId:s,resultFn:u=>u.PartitionKeyRanges,query:t,options:c,diagnosticNode:a});return new xe(this,t,r,o)}async delete({path:e,resourceType:t,resourceId:r,options:i={},partitionKey:s,method:o=z.delete,diagnosticNode:a}){try{const c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:o,operationType:E.Delete,path:e,resourceType:t,options:i,resourceId:r,partitionKey:s});a.addData({operationType:E.Delete,resourceType:t}),c.headers=await this.buildHeaders(c),this.applySessionToken(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(a,c.resourceType,c.operationType);const l=await ge(a,c,ue.request,re.operation);return Ir(e).type!=="colls"?this.captureSessionToken(void 0,e,E.Delete,l.headers):this.clearSessionToken(e),l}catch(c){throw this.captureSessionToken(c,e,E.Upsert,c.headers),c}}async patch({body:e,path:t,resourceType:r,resourceId:i,options:s={},partitionKey:o,diagnosticNode:a}){try{const c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.patch,operationType:E.Patch,path:t,resourceType:r,body:e,resourceId:i,options:s,partitionKey:o});a.addData({operationType:E.Patch,resourceType:r}),c.headers=await this.buildHeaders(c),this.applySessionToken(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(a,c.resourceType,c.operationType);const l=await ge(a,c,ue.request,re.operation);return this.captureSessionToken(void 0,t,E.Patch,l.headers),l}catch(c){throw this.captureSessionToken(c,t,E.Upsert,c.headers),c}}async create({body:e,path:t,resourceType:r,resourceId:i,diagnosticNode:s,options:o={},partitionKey:a}){try{const c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.post,operationType:E.Create,path:t,resourceType:r,resourceId:i,body:e,options:o,partitionKey:a});s.addData({operationType:E.Create,resourceType:r}),c.headers=await this.buildHeaders(c),this.applySessionToken(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(s,c.resourceType,c.operationType);const l=await ge(s,c,ue.request,re.operation);return this.captureSessionToken(void 0,t,E.Create,l.headers),l}catch(c){throw this.captureSessionToken(c,t,E.Upsert,c.headers),c}}processQueryFeedResponse(e,t,r){return t?{result:r(e.result),headers:e.headers,code:e.code}:{result:r(e.result).map(s=>s),headers:e.headers,code:e.code}}applySessionToken(e){const t=this.getSessionParams(e.path);if(e.headers&&e.headers[q.SessionToken])return;const r=e.headers[q.ConsistencyLevel];if(r&&r===Nt.Session&&t.resourceAddress){const i=this.sessionContainer.get(t);i&&(e.headers[q.SessionToken]=i)}}async replace({body:e,path:t,resourceType:r,resourceId:i,options:s={},partitionKey:o,diagnosticNode:a}){try{const c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.put,operationType:E.Replace,path:t,resourceType:r,body:e,resourceId:i,options:s,partitionKey:o});a.addData({operationType:E.Replace,resourceType:r}),c.headers=await this.buildHeaders(c),this.applySessionToken(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(a,c.resourceType,c.operationType);const l=await ge(a,c,ue.request,re.operation);return this.captureSessionToken(void 0,t,E.Replace,l.headers),l}catch(c){throw this.captureSessionToken(c,t,E.Upsert,c.headers),c}}async upsert({body:e,path:t,resourceType:r,resourceId:i,options:s={},partitionKey:o,diagnosticNode:a}){try{const c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.post,operationType:E.Upsert,path:t,resourceType:r,body:e,resourceId:i,options:s,partitionKey:o});a.addData({operationType:E.Upsert,resourceType:r}),c.headers=await this.buildHeaders(c),c.headers[q.IsUpsert]=!0,this.applySessionToken(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(a,c.resourceType,c.operationType);const l=await ge(a,c,ue.request,re.operation);return this.captureSessionToken(void 0,t,E.Upsert,l.headers),l}catch(c){throw this.captureSessionToken(c,t,E.Upsert,c.headers),c}}async execute({sprocLink:e,params:t,options:r={},partitionKey:i,diagnosticNode:s}){t!=null&&!Array.isArray(t)&&(t=[t]);const o=T(e),a=v(e),c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.post,operationType:E.Execute,path:o,resourceType:x.sproc,options:r,resourceId:a,body:t,partitionKey:i});return s.addData({operationType:E.Execute,resourceType:x.sproc}),c.headers=await this.buildHeaders(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(s,c.resourceType,c.operationType),await ge(s,c,ue.request,re.operation)}async getDatabaseAccount(e,t={}){const r=t.urlConnection||this.cosmosClientOptions.endpoint,i=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{endpoint:r,method:z.get,operationType:E.Read,path:"",resourceType:x.none,options:t});e.addData({operationType:E.Read,resourceType:x.none}),i.headers=await this.buildHeaders(i);const{result:s,headers:o,code:a,substatus:c,diagnostics:l}=await ge(e,i,ue.request,re.operation);return{result:new Do(s,o),headers:o,diagnostics:l,code:a,substatus:c}}getWriteEndpoint(e){return this.globalEndpointManager.getWriteEndpoint(e)}getReadEndpoint(e){return this.globalEndpointManager.getReadEndpoint(e)}getWriteEndpoints(){return this.globalEndpointManager.getWriteEndpoints()}getReadEndpoints(){return this.globalEndpointManager.getReadEndpoints()}async batch({body:e,path:t,partitionKey:r,resourceId:i,options:s={},diagnosticNode:o}){try{const a=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.post,operationType:E.Batch,path:t,body:e,resourceType:x.item,resourceId:i,options:s,partitionKey:r});o.addData({operationType:E.Batch,resourceType:x.item}),a.headers=await this.buildHeaders(a),a.headers[q.IsBatchRequest]=!0,a.headers[q.IsBatchAtomic]=!0,this.applySessionToken(a),a.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(o,a.resourceType,a.operationType);const c=await ge(o,a,ue.request,re.operation);return this.captureSessionToken(void 0,t,E.Batch,c.headers),c.diagnostics=o.toDiagnostic(this.getClientConfig()),c}catch(a){throw this.captureSessionToken(a,t,E.Upsert,a.headers),a}}async bulk({body:e,path:t,partitionKeyRangeId:r,resourceId:i,bulkOptions:s={},options:o={},diagnosticNode:a}){try{const c=Object.assign(Object.assign({},this.getContextDerivedPropsForRequestCreation()),{method:z.post,operationType:E.Batch,path:t,body:e,resourceType:x.item,resourceId:i,options:o});a.addData({operationType:E.Batch,resourceType:x.item}),c.headers=await this.buildHeaders(c),c.headers[q.IsBatchRequest]=!0,c.headers[q.PartitionKeyRangeID]=r,c.headers[q.IsBatchAtomic]=!1,c.headers[q.BatchContinueOnError]=s.continueOnError||!1,this.applySessionToken(c),c.endpoint=await this.globalEndpointManager.resolveServiceEndpoint(a,c.resourceType,c.operationType);const l=await ge(a,c,ue.request,re.operation);return this.captureSessionToken(void 0,t,E.Batch,l.headers),l}catch(c){throw this.captureSessionToken(c,t,E.Upsert,c.headers),c}}captureSessionToken(e,t,r,i){const s=this.getSessionParams(t);s.operationType=r,(!e||!this.isMasterResource(s.resourceType)&&(e.code===F.PreconditionFailed||e.code===F.Conflict||e.code===F.NotFound&&e.substatus!==Le.ReadSessionNotAvailable))&&this.sessionContainer.set(s,i)}clearSessionToken(e){const t=this.getSessionParams(e);this.sessionContainer.remove(t)}recordDiagnostics(e){const t=this.diagnosticFormatter.format(e);this.diagnosticWriter.write(t)}initializeDiagnosticSettings(e){switch(this.diagnosticFormatter=new Du,e){case K.info:this.diagnosticWriter=new Iu;break;default:this.diagnosticWriter=new _u}}getSessionParams(e){let r=null;const i=Ir(e);r=i.objectBody.self;const s=i.type;return{resourceId:null,resourceAddress:r,resourceType:s,isNameBased:!0}}isMasterResource(e){return e===p.Path.OffersPathSegment||e===p.Path.DatabasesPathSegment||e===p.Path.UsersPathSegment||e===p.Path.PermissionsPathSegment||e===p.Path.TopologyPathSegment||e===p.Path.DatabaseAccountPathSegment||e===p.Path.PartitionKeyRangesPathSegment||e===p.Path.CollectionsPathSegment}buildHeaders(e){return qo({clientOptions:this.cosmosClientOptions,defaultHeaders:Object.assign(Object.assign({},this.cosmosClientOptions.defaultHeaders),e.options.initialHeaders),verb:e.method,path:e.path,resourceId:e.resourceId,resourceType:e.resourceType,options:e.options,partitionKeyRangeId:e.partitionKeyRangeId,useMultipleWriteLocations:this.connectionPolicy.useMultipleWriteLocations,partitionKey:e.partitionKey!==void 0?tr(e.partitionKey):void 0})}getContextDerivedPropsForRequestCreation(){return{globalEndpointManager:this.globalEndpointManager,requestAgent:this.cosmosClientOptions.agent,connectionPolicy:this.connectionPolicy,client:this,plugins:this.cosmosClientOptions.plugins,pipeline:this.pipeline}}getClientConfig(){return this.clientConfig}}function Mu(){return typeof navigator=="object"&&"userAgent"in navigator?navigator.userAgent:typeof process=="object"&&process.version!==void 0?`Node.js/${process.version.substr(1)} (${process.platform}; ${process.arch})`:"<environment undetectable>"}function Ou(n){const e=`${Mu()} ${p.SDKName}/${p.SDKVersion}`;return n?e+" "+n:e}function Lu(n){return typeof n=="string"&&n.trim().length>0}var ni={};const ku=K.info,Dt=typeof process<"u"&&ni&&ni[p.CosmosDbDiagnosticLevelEnvVarName]||void 0,gr=Object.values(K).map(n=>n.toString());let us;Lu(Dt)&&(ls(Dt)?Hu(Dt):console.error(`${p.CosmosDbDiagnosticLevelEnvVarName} set to unknown diagnostic level '${Dt}'; Setting Cosmos Db diagnostic level to info. Acceptable values: ${gr.join(", ")}.`));function Hu(n){if(n&&!ls(n))throw new Error(`Unknown diagnostic level '${n}'. Acceptable values: ${gr.join(",")}`);us=n}function Uu(){return us}function ls(n){return gr.includes(n)}function Fu(n,e){const t=e??n;return t??ku}class mr{constructor(e,t){this.readDatabaseAccount=t,this.writeableLocations=[],this.readableLocations=[],this.unavailableReadableLocations=[],this.unavailableWriteableLocations=[],this.options=e,this.defaultEndpoint=e.endpoint,this.enableEndpointDiscovery=e.connectionPolicy.enableEndpointDiscovery,this.isRefreshing=!1,this.preferredLocations=this.options.connectionPolicy.preferredLocations,this.preferredLocationsCount=this.preferredLocations?this.preferredLocations.length:0}async getReadEndpoint(e){return this.resolveServiceEndpoint(e,x.item,E.Read)}async getWriteEndpoint(e){return this.resolveServiceEndpoint(e,x.item,E.Replace)}async getReadEndpoints(){return this.readableLocations.map(e=>e.databaseAccountEndpoint)}async getWriteEndpoints(){return this.writeableLocations.map(e=>e.databaseAccountEndpoint)}async markCurrentLocationUnavailableForRead(e,t){await this.refreshEndpointList(e);const r=this.readableLocations.find(i=>i.databaseAccountEndpoint===t);r&&(r.unavailable=!0,r.lastUnavailabilityTimestampInMs=Date.now(),this.unavailableReadableLocations.push(r))}async markCurrentLocationUnavailableForWrite(e,t){await this.refreshEndpointList(e);const r=this.writeableLocations.find(i=>i.databaseAccountEndpoint===t);r&&(r.unavailable=!0,r.lastUnavailabilityTimestampInMs=Date.now(),this.unavailableWriteableLocations.push(r))}canUseMultipleWriteLocations(e,t){let r=this.options.connectionPolicy.useMultipleWriteLocations;return e&&(r=r&&(e===x.item||e===x.sproc&&t===E.Execute)),r}async resolveServiceEndpoint(e,t,r,i=0){if(!this.options.connectionPolicy.enableEndpointDiscovery)return e.addData({readFromCache:!0},"default_endpoint"),e.recordEndpointResolution(this.defaultEndpoint),this.defaultEndpoint;if(t===x.none)return e.addData({readFromCache:!0},"none_resource"),e.recordEndpointResolution(this.defaultEndpoint),this.defaultEndpoint;if(this.readableLocations.length===0||this.writeableLocations.length===0){const a=await Ye(async c=>this.readDatabaseAccount(c,{urlConnection:this.defaultEndpoint}),e,Se.DatabaseAccountLookUp);this.writeableLocations=a.resource.writableLocations,this.readableLocations=a.resource.readableLocations}const s=ht(r)?this.readableLocations:this.writeableLocations;let o;if(this.preferredLocations&&this.preferredLocations.length>0&&i<this.preferredLocations.length)for(let a=i;a<this.preferredLocations.length;a++){const c=this.preferredLocations[a];if(o=s.find(l=>l.unavailable!==!0&&ri(l.name)===ri(c)),o)break}return o||(o=(i>=0&&i<s.length?s.slice(i):s).find(l=>l.unavailable!==!0)),o=o||{name:"",databaseAccountEndpoint:this.defaultEndpoint},e.recordEndpointResolution(o.databaseAccountEndpoint),o.databaseAccountEndpoint}async refreshEndpointList(e){if(!this.isRefreshing&&this.enableEndpointDiscovery){this.isRefreshing=!0;const t=await this.getDatabaseAccountFromAnyEndpoint(e);t&&(this.refreshStaleUnavailableLocations(),this.refreshEndpoints(t)),this.isRefreshing=!1}}refreshEndpoints(e){for(const t of e.writableLocations)this.writeableLocations.find(i=>i.name===t.name)||this.writeableLocations.push(t);for(const t of e.readableLocations)this.readableLocations.find(i=>i.name===t.name)||this.readableLocations.push(t)}refreshStaleUnavailableLocations(){const e=Date.now();this.updateLocation(e,this.unavailableReadableLocations,this.readableLocations),this.unavailableReadableLocations=this.cleanUnavailableLocationList(e,this.unavailableReadableLocations),this.updateLocation(e,this.unavailableWriteableLocations,this.writeableLocations),this.unavailableWriteableLocations=this.cleanUnavailableLocationList(e,this.unavailableWriteableLocations)}updateLocation(e,t,r){for(const i of t){const s=r.find(o=>o.name===i.name);s&&e-s.lastUnavailabilityTimestampInMs>p.LocationUnavailableExpirationTimeInMs&&(s.unavailable=!1)}}cleanUnavailableLocationList(e,t){return t.filter(r=>!(r&&e-r.lastUnavailabilityTimestampInMs>=p.LocationUnavailableExpirationTimeInMs))}async getDatabaseAccountFromAnyEndpoint(e){try{const t={urlConnection:this.defaultEndpoint},{resource:r}=await this.readDatabaseAccount(e,t);return r}catch{}if(this.preferredLocations)for(const t of this.preferredLocations)try{const i={urlConnection:mr.getLocationalEndpoint(this.defaultEndpoint,t)},{resource:s}=await this.readDatabaseAccount(e,i);if(s)return s}catch{}}static getLocationalEndpoint(e,t){const r=new URL(e);if(r.hostname){const i=r.hostname.toString().toLowerCase().split(".");if(i){const s=i[0],o=s+"-"+t.replace(" ","");return e.toLowerCase().replace(s,o)}}return null}}function ri(n){return n.split(" ").join("").toLowerCase()}class Nu{constructor(e){var t,r;if(typeof e=="string"&&(e=uo(e)),!vu(e.endpoint))throw new Error("Invalid endpoint specified");const s=this.initializeClientConfigDiagnostic(e);e.connectionPolicy=Object.assign({},Or,e.connectionPolicy),e.defaultHeaders=e.defaultHeaders||{},e.defaultHeaders[p.HttpHeaders.CacheControl]="no-cache",e.defaultHeaders[p.HttpHeaders.Version]=p.CurrentVersion,e.consistencyLevel!==void 0&&(e.defaultHeaders[p.HttpHeaders.ConsistencyLevel]=e.consistencyLevel),e.defaultHeaders[p.HttpHeaders.UserAgent]=Ou(e.userAgentSuffix);const o=new mr(e,async(a,c)=>this.getDatabaseAccountInternal(a,c));this.clientContext=new Su(e,o,s,Fu(e.diagnosticLevel,Uu())),!((t=e.connectionPolicy)===null||t===void 0)&&t.enableEndpointDiscovery&&(!((r=e.connectionPolicy)===null||r===void 0)&&r.enableBackgroundEndpointRefreshing)&&this.backgroundRefreshEndpointList(o,e.connectionPolicy.endpointRefreshRateInMs||Or.endpointRefreshRateInMs),this.databases=new uc(this,this.clientContext),this.offers=new sc(this,this.clientContext)}initializeClientConfigDiagnostic(e){return{endpoint:e.endpoint,resourceTokensConfigured:e.resourceTokens!==void 0,tokenProviderConfigured:e.tokenProvider!==void 0,aadCredentialsConfigured:e.aadCredentials!==void 0,connectionPolicyConfigured:e.connectionPolicy!==void 0,consistencyLevel:e.consistencyLevel,defaultHeaders:e.defaultHeaders,agentConfigured:e.agent!==void 0,userAgentSuffix:e.userAgentSuffix,diagnosticLevel:e.diagnosticLevel,pluginsConfigured:e.plugins!==void 0,sDKVersion:p.SDKVersion}}async getDatabaseAccount(e){return C(async t=>this.getDatabaseAccountInternal(t,e),this.clientContext)}async getDatabaseAccountInternal(e,t){const r=await this.clientContext.getDatabaseAccount(e,t);return new ee(r.result,r.headers,r.code,A(),r.substatus)}async getWriteEndpoint(){return C(async e=>this.clientContext.getWriteEndpoint(e),this.clientContext)}async getReadEndpoint(){return C(async e=>this.clientContext.getReadEndpoint(e),this.clientContext)}getWriteEndpoints(){return this.clientContext.getWriteEndpoints()}getReadEndpoints(){return this.clientContext.getReadEndpoints()}database(e){return new is(this,e,this.clientContext)}offer(e){return new hr(this,e,this.clientContext)}dispose(){clearTimeout(this.endpointRefresher)}async backgroundRefreshEndpointList(e,t){this.endpointRefresher=setInterval(()=>{try{return C(async r=>e.refreshEndpointList(r),this.clientContext,te.BACKGROUND_REFRESH_THREAD)}catch(r){console.warn("Failed to refresh endpoints",r)}},t),this.endpointRefresher.unref&&typeof this.endpointRefresher.unref=="function"&&this.endpointRefresher.unref()}}var ds={},et={};Object.defineProperty(et,"__esModule",{value:!0});et.cssValue=et.parseLengthAndUnit=void 0;var qu={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function hs(n){if(typeof n=="number")return{value:n,unit:"px"};var e,t=(n.match(/^[0-9.]*/)||"").toString();t.includes(".")?e=parseFloat(t):e=parseInt(t,10);var r=(n.match(/[^0-9]*$/)||"").toString();return qu[r]?{value:e,unit:r}:(console.warn("React Spinners: ".concat(n," is not a valid css value. Defaulting to ").concat(e,"px.")),{value:e,unit:"px"})}et.parseLengthAndUnit=hs;function zu(n){var e=hs(n);return"".concat(e.value).concat(e.unit)}et.cssValue=zu;var Xt={};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.createAnimation=void 0;var ju=function(n,e,t){var r="react-spinners-".concat(n,"-").concat(t);if(typeof window>"u"||!window.document)return r;var i=document.createElement("style");document.head.appendChild(i);var s=i.sheet,o=`
    @keyframes `.concat(r,` {
      `).concat(e,`
    }
  `);return s&&s.insertRule(o,0),r};Xt.createAnimation=ju;var Kt=Te&&Te.__assign||function(){return Kt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Kt.apply(this,arguments)},Bu=Te&&Te.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ku=Te&&Te.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Wu=Te&&Te.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Bu(e,n,t);return Ku(e,n),e},Qu=Te&&Te.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};Object.defineProperty(ds,"__esModule",{value:!0});var mn=Wu(Z),yn=et,fs=Xt,$u=(0,fs.createAnimation)("DotLoader","100% {transform: rotate(360deg)}","rotate"),Vu=(0,fs.createAnimation)("DotLoader","0%, 100% {transform: scale(0)} 50% {transform: scale(1.0)}","bounce");function Gu(n){var e=n.loading,t=e===void 0?!0:e,r=n.color,i=r===void 0?"#000000":r,s=n.speedMultiplier,o=s===void 0?1:s,a=n.cssOverride,c=a===void 0?{}:a,l=n.size,u=l===void 0?60:l,h=Qu(n,["loading","color","speedMultiplier","cssOverride","size"]),f=Kt({display:"inherit",position:"relative",width:(0,yn.cssValue)(u),height:(0,yn.cssValue)(u),animationFillMode:"forwards",animation:"".concat($u," ").concat(2/o,"s 0s infinite linear")},c),w=function(m){var g=(0,yn.parseLengthAndUnit)(u),R=g.value,b=g.unit;return{position:"absolute",top:m%2?"0":"auto",bottom:m%2?"auto":"0",height:"".concat(R/2).concat(b),width:"".concat(R/2).concat(b),backgroundColor:i,borderRadius:"100%",animationFillMode:"forwards",animation:"".concat(Vu," ").concat(2/o,"s ").concat(m===2?"1s":"0s"," infinite linear")}};return t?mn.createElement("span",Kt({style:f},h),mn.createElement("span",{style:w(1)}),mn.createElement("span",{style:w(2)})):null}var Yu=ds.default=Gu,Zt={},Xu=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,t=[],r=0;r<n.rangeCount;r++)t.push(n.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||t.forEach(function(i){n.addRange(i)}),e&&e.focus()}},Zu=Xu,ii={"text/plain":"Text","text/html":"Url",default:"Text"},Ju="Copy to clipboard: #{key}, Enter";function el(n){var e=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return n.replace(/#{\s*key\s*}/g,e)}function tl(n,e){var t,r,i,s,o,a,c=!1;e||(e={}),t=e.debug||!1;try{i=Zu(),s=document.createRange(),o=document.getSelection(),a=document.createElement("span"),a.textContent=n,a.ariaHidden="true",a.style.all="unset",a.style.position="fixed",a.style.top=0,a.style.clip="rect(0, 0, 0, 0)",a.style.whiteSpace="pre",a.style.webkitUserSelect="text",a.style.MozUserSelect="text",a.style.msUserSelect="text",a.style.userSelect="text",a.addEventListener("copy",function(u){if(u.stopPropagation(),e.format)if(u.preventDefault(),typeof u.clipboardData>"u"){t&&console.warn("unable to use e.clipboardData"),t&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var h=ii[e.format]||ii.default;window.clipboardData.setData(h,n)}else u.clipboardData.clearData(),u.clipboardData.setData(e.format,n);e.onCopy&&(u.preventDefault(),e.onCopy(u.clipboardData))}),document.body.appendChild(a),s.selectNodeContents(a),o.addRange(s);var l=document.execCommand("copy");if(!l)throw new Error("copy command was unsuccessful");c=!0}catch(u){t&&console.error("unable to copy using execCommand: ",u),t&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",n),e.onCopy&&e.onCopy(window.clipboardData),c=!0}catch(h){t&&console.error("unable to copy using clipboardData: ",h),t&&console.error("falling back to prompt"),r=el("message"in e?e.message:Ju),window.prompt(r,n)}}finally{o&&(typeof o.removeRange=="function"?o.removeRange(s):o.removeAllRanges()),a&&document.body.removeChild(a),i()}return c}var nl=tl;function jn(n){"@babel/helpers - typeof";return jn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(n)}Object.defineProperty(Zt,"__esModule",{value:!0});Zt.CopyToClipboard=void 0;var Pt=ps(Z),rl=ps(nl),il=["text","onCopy","options","children"];function ps(n){return n&&n.__esModule?n:{default:n}}function si(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function oi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?si(Object(t),!0).forEach(function(r){yr(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):si(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function sl(n,e){if(n==null)return{};var t=ol(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function ol(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function al(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ai(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function cl(n,e,t){return e&&ai(n.prototype,e),t&&ai(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function ul(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Bn(n,e)}function Bn(n,e){return Bn=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Bn(n,e)}function ll(n){var e=hl();return function(){var r=Wt(n),i;if(e){var s=Wt(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return dl(this,i)}}function dl(n,e){if(e&&(jn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gs(n)}function gs(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function hl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Wt(n){return Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Wt(n)}function yr(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var ms=function(n){ul(t,n);var e=ll(t);function t(){var r;al(this,t);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return r=e.call.apply(e,[this].concat(s)),yr(gs(r),"onClick",function(a){var c=r.props,l=c.text,u=c.onCopy,h=c.children,f=c.options,w=Pt.default.Children.only(h),m=(0,rl.default)(l,f);u&&u(l,m),w&&w.props&&typeof w.props.onClick=="function"&&w.props.onClick(a)}),r}return cl(t,[{key:"render",value:function(){var i=this.props;i.text,i.onCopy,i.options;var s=i.children,o=sl(i,il),a=Pt.default.Children.only(s);return Pt.default.cloneElement(a,oi(oi({},o),{},{onClick:this.onClick}))}}]),t}(Pt.default.PureComponent);Zt.CopyToClipboard=ms;yr(ms,"defaultProps",{onCopy:void 0,options:void 0});var fl=Zt,Kn=fl.CopyToClipboard;Kn.CopyToClipboard=Kn;var pl=Kn;function ys(n,e){return function(){return n.apply(e,arguments)}}const{toString:gl}=Object.prototype,{getPrototypeOf:wr}=Object,Jt=(n=>e=>{const t=gl.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ve=n=>(n=n.toLowerCase(),e=>Jt(e)===n),en=n=>e=>typeof e===n,{isArray:nt}=Array,mt=en("undefined");function ml(n){return n!==null&&!mt(n)&&n.constructor!==null&&!mt(n.constructor)&&he(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ws=ve("ArrayBuffer");function yl(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ws(n.buffer),e}const wl=en("string"),he=en("function"),xs=en("number"),tn=n=>n!==null&&typeof n=="object",xl=n=>n===!0||n===!1,Lt=n=>{if(Jt(n)!=="object")return!1;const e=wr(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Rl=ve("Date"),bl=ve("File"),Cl=ve("Blob"),Tl=ve("FileList"),El=n=>tn(n)&&he(n.pipe),vl=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||he(n.append)&&((e=Jt(n))==="formdata"||e==="object"&&he(n.toString)&&n.toString()==="[object FormData]"))},Al=ve("URLSearchParams"),_l=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rt(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,i;if(typeof n!="object"&&(n=[n]),nt(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(r=0;r<o;r++)a=s[r],e.call(null,n[a],a,n)}}function Rs(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const bs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Cs=n=>!mt(n)&&n!==bs;function Wn(){const{caseless:n}=Cs(this)&&this||{},e={},t=(r,i)=>{const s=n&&Rs(e,i)||i;Lt(e[s])&&Lt(r)?e[s]=Wn(e[s],r):Lt(r)?e[s]=Wn({},r):nt(r)?e[s]=r.slice():e[s]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Rt(arguments[r],t);return e}const Il=(n,e,t,{allOwnKeys:r}={})=>(Rt(e,(i,s)=>{t&&he(i)?n[s]=ys(i,t):n[s]=i},{allOwnKeys:r}),n),Dl=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Pl=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Sl=(n,e,t,r)=>{let i,s,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&wr(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Ml=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},Ol=n=>{if(!n)return null;if(nt(n))return n;let e=n.length;if(!xs(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Ll=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&wr(Uint8Array)),kl=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=r.next())&&!i.done;){const s=i.value;e.call(n,s[0],s[1])}},Hl=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},Ul=ve("HTMLFormElement"),Fl=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),ci=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Nl=ve("RegExp"),Ts=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Rt(t,(i,s)=>{let o;(o=e(i,s,n))!==!1&&(r[s]=o||i)}),Object.defineProperties(n,r)},ql=n=>{Ts(n,(e,t)=>{if(he(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(he(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},zl=(n,e)=>{const t={},r=i=>{i.forEach(s=>{t[s]=!0})};return nt(n)?r(n):r(String(n).split(e)),t},jl=()=>{},Bl=(n,e)=>(n=+n,Number.isFinite(n)?n:e),wn="abcdefghijklmnopqrstuvwxyz",ui="0123456789",Es={DIGIT:ui,ALPHA:wn,ALPHA_DIGIT:wn+wn.toUpperCase()+ui},Kl=(n=16,e=Es.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function Wl(n){return!!(n&&he(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Ql=n=>{const e=new Array(10),t=(r,i)=>{if(tn(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=nt(r)?[]:{};return Rt(r,(o,a)=>{const c=t(o,i+1);!mt(c)&&(s[a]=c)}),e[i]=void 0,s}}return r};return t(n,0)},$l=ve("AsyncFunction"),Vl=n=>n&&(tn(n)||he(n))&&he(n.then)&&he(n.catch),y={isArray:nt,isArrayBuffer:ws,isBuffer:ml,isFormData:vl,isArrayBufferView:yl,isString:wl,isNumber:xs,isBoolean:xl,isObject:tn,isPlainObject:Lt,isUndefined:mt,isDate:Rl,isFile:bl,isBlob:Cl,isRegExp:Nl,isFunction:he,isStream:El,isURLSearchParams:Al,isTypedArray:Ll,isFileList:Tl,forEach:Rt,merge:Wn,extend:Il,trim:_l,stripBOM:Dl,inherits:Pl,toFlatObject:Sl,kindOf:Jt,kindOfTest:ve,endsWith:Ml,toArray:Ol,forEachEntry:kl,matchAll:Hl,isHTMLForm:Ul,hasOwnProperty:ci,hasOwnProp:ci,reduceDescriptors:Ts,freezeMethods:ql,toObjectSet:zl,toCamelCase:Fl,noop:jl,toFiniteNumber:Bl,findKey:Rs,global:bs,isContextDefined:Cs,ALPHABET:Es,generateString:Kl,isSpecCompliantForm:Wl,toJSONObject:Ql,isAsyncFn:$l,isThenable:Vl};function S(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}y.inherits(S,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:y.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const vs=S.prototype,As={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{As[n]={value:n}});Object.defineProperties(S,As);Object.defineProperty(vs,"isAxiosError",{value:!0});S.from=(n,e,t,r,i,s)=>{const o=Object.create(vs);return y.toFlatObject(n,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),S.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const Gl=null;function Qn(n){return y.isPlainObject(n)||y.isArray(n)}function _s(n){return y.endsWith(n,"[]")?n.slice(0,-2):n}function li(n,e,t){return n?n.concat(e).map(function(i,s){return i=_s(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function Yl(n){return y.isArray(n)&&!n.some(Qn)}const Xl=y.toFlatObject(y,{},null,function(e){return/^is[A-Z]/.test(e)});function nn(n,e,t){if(!y.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=y.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,R){return!y.isUndefined(R[g])});const r=t.metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&y.isSpecCompliantForm(e);if(!y.isFunction(i))throw new TypeError("visitor must be a function");function l(m){if(m===null)return"";if(y.isDate(m))return m.toISOString();if(!c&&y.isBlob(m))throw new S("Blob is not supported. Use a Buffer instead.");return y.isArrayBuffer(m)||y.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,g,R){let b=m;if(m&&!R&&typeof m=="object"){if(y.endsWith(g,"{}"))g=r?g:g.slice(0,-2),m=JSON.stringify(m);else if(y.isArray(m)&&Yl(m)||(y.isFileList(m)||y.endsWith(g,"[]"))&&(b=y.toArray(m)))return g=_s(g),b.forEach(function(M,$){!(y.isUndefined(M)||M===null)&&e.append(o===!0?li([g],$,s):o===null?g:g+"[]",l(M))}),!1}return Qn(m)?!0:(e.append(li(R,g,s),l(m)),!1)}const h=[],f=Object.assign(Xl,{defaultVisitor:u,convertValue:l,isVisitable:Qn});function w(m,g){if(!y.isUndefined(m)){if(h.indexOf(m)!==-1)throw Error("Circular reference detected in "+g.join("."));h.push(m),y.forEach(m,function(b,I){(!(y.isUndefined(b)||b===null)&&i.call(e,b,y.isString(I)?I.trim():I,g,f))===!0&&w(b,g?g.concat(I):[I])}),h.pop()}}if(!y.isObject(n))throw new TypeError("data must be an object");return w(n),e}function di(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function xr(n,e){this._pairs=[],n&&nn(n,this,e)}const Is=xr.prototype;Is.append=function(e,t){this._pairs.push([e,t])};Is.toString=function(e){const t=e?function(r){return e.call(this,r,di)}:di;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Zl(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ds(n,e,t){if(!e)return n;const r=t&&t.encode||Zl,i=t&&t.serialize;let s;if(i?s=i(e,t):s=y.isURLSearchParams(e)?e.toString():new xr(e,t).toString(r),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class hi{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){y.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Ps={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Jl=typeof URLSearchParams<"u"?URLSearchParams:xr,ed=typeof FormData<"u"?FormData:null,td=typeof Blob<"u"?Blob:null,nd={isBrowser:!0,classes:{URLSearchParams:Jl,FormData:ed,Blob:td},protocols:["http","https","file","blob","url","data"]},Ss=typeof window<"u"&&typeof document<"u",rd=(n=>Ss&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),id=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",sd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ss,hasStandardBrowserEnv:rd,hasStandardBrowserWebWorkerEnv:id},Symbol.toStringTag,{value:"Module"})),Ce={...sd,...nd};function od(n,e){return nn(n,new Ce.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,s){return Ce.isNode&&y.isBuffer(t)?(this.append(r,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function ad(n){return y.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function cd(n){const e={},t=Object.keys(n);let r;const i=t.length;let s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function Ms(n){function e(t,r,i,s){let o=t[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&y.isArray(i)?i.length:o,c?(y.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):((!i[o]||!y.isObject(i[o]))&&(i[o]=[]),e(t,r,i[o],s)&&y.isArray(i[o])&&(i[o]=cd(i[o])),!a)}if(y.isFormData(n)&&y.isFunction(n.entries)){const t={};return y.forEachEntry(n,(r,i)=>{e(ad(r),i,t,0)}),t}return null}function ud(n,e,t){if(y.isString(n))try{return(e||JSON.parse)(n),y.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Rr={transitional:Ps,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,s=y.isObject(e);if(s&&y.isHTMLForm(e)&&(e=new FormData(e)),y.isFormData(e))return i?JSON.stringify(Ms(e)):e;if(y.isArrayBuffer(e)||y.isBuffer(e)||y.isStream(e)||y.isFile(e)||y.isBlob(e))return e;if(y.isArrayBufferView(e))return e.buffer;if(y.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return od(e,this.formSerializer).toString();if((a=y.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return nn(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),ud(e)):e}],transformResponse:[function(e){const t=this.transitional||Rr.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&y.isString(e)&&(r&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?S.from(a,S.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ce.classes.FormData,Blob:Ce.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};y.forEach(["delete","get","head","post","put","patch"],n=>{Rr.headers[n]={}});const br=Rr,ld=y.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),dd=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&ld[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},fi=Symbol("internals");function st(n){return n&&String(n).trim().toLowerCase()}function kt(n){return n===!1||n==null?n:y.isArray(n)?n.map(kt):String(n)}function hd(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const fd=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function xn(n,e,t,r,i){if(y.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!y.isString(e)){if(y.isString(r))return e.indexOf(r)!==-1;if(y.isRegExp(r))return r.test(e)}}function pd(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function gd(n,e){const t=y.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,s,o){return this[r].call(this,e,i,s,o)},configurable:!0})})}class rn{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function s(a,c,l){const u=st(c);if(!u)throw new Error("header name must be a non-empty string");const h=y.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=kt(a))}const o=(a,c)=>y.forEach(a,(l,u)=>s(l,u,c));return y.isPlainObject(e)||e instanceof this.constructor?o(e,t):y.isString(e)&&(e=e.trim())&&!fd(e)?o(dd(e),t):e!=null&&s(t,e,r),this}get(e,t){if(e=st(e),e){const r=y.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return hd(i);if(y.isFunction(t))return t.call(this,i,r);if(y.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=st(e),e){const r=y.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||xn(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function s(o){if(o=st(o),o){const a=y.findKey(r,o);a&&(!t||xn(r,r[a],a,t))&&(delete r[a],i=!0)}}return y.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const s=t[r];(!e||xn(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,r={};return y.forEach(this,(i,s)=>{const o=y.findKey(r,s);if(o){t[o]=kt(i),delete t[s];return}const a=e?pd(s):String(s).trim();a!==s&&delete t[s],t[a]=kt(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return y.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&y.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[fi]=this[fi]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=st(o);r[a]||(gd(i,o),r[a]=!0)}return y.isArray(e)?e.forEach(s):s(e),this}}rn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);y.reduceDescriptors(rn.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});y.freezeMethods(rn);const Pe=rn;function Rn(n,e){const t=this||br,r=e||t,i=Pe.from(r.headers);let s=r.data;return y.forEach(n,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function Os(n){return!!(n&&n.__CANCEL__)}function bt(n,e,t){S.call(this,n??"canceled",S.ERR_CANCELED,e,t),this.name="CanceledError"}y.inherits(bt,S,{__CANCEL__:!0});function md(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new S("Request failed with status code "+t.status,[S.ERR_BAD_REQUEST,S.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const yd=Ce.hasStandardBrowserEnv?{write(n,e,t,r,i,s){const o=[n+"="+encodeURIComponent(e)];y.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),y.isString(r)&&o.push("path="+r),y.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function wd(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function xd(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ls(n,e){return n&&!wd(e)?xd(n,e):e}const Rd=Ce.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(o){const a=y.isString(o)?i(o):o;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}();function bd(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Cd(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const l=Date.now(),u=r[s];o||(o=l),t[i]=c,r[i]=l;let h=s,f=0;for(;h!==i;)f+=t[h++],h=h%n;if(i=(i+1)%n,i===s&&(s=(s+1)%n),l-o<e)return;const w=u&&l-u;return w?Math.round(f*1e3/w):void 0}}function pi(n,e){let t=0;const r=Cd(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=r(a),l=s<=o;t=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&l?(o-s)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const Td=typeof XMLHttpRequest<"u",Ed=Td&&function(n){return new Promise(function(t,r){let i=n.data;const s=Pe.from(n.headers).normalize();let{responseType:o,withXSRFToken:a}=n,c;function l(){n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let u;if(y.isFormData(i)){if(Ce.hasStandardBrowserEnv||Ce.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((u=s.getContentType())!==!1){const[g,...R]=u?u.split(";").map(b=>b.trim()).filter(Boolean):[];s.setContentType([g||"multipart/form-data",...R].join("; "))}}let h=new XMLHttpRequest;if(n.auth){const g=n.auth.username||"",R=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";s.set("Authorization","Basic "+btoa(g+":"+R))}const f=Ls(n.baseURL,n.url);h.open(n.method.toUpperCase(),Ds(f,n.params,n.paramsSerializer),!0),h.timeout=n.timeout;function w(){if(!h)return;const g=Pe.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?h.responseText:h.response,status:h.status,statusText:h.statusText,headers:g,config:n,request:h};md(function(M){t(M),l()},function(M){r(M),l()},b),h=null}if("onloadend"in h?h.onloadend=w:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf("file:")===0)||setTimeout(w)},h.onabort=function(){h&&(r(new S("Request aborted",S.ECONNABORTED,n,h)),h=null)},h.onerror=function(){r(new S("Network Error",S.ERR_NETWORK,n,h)),h=null},h.ontimeout=function(){let R=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const b=n.transitional||Ps;n.timeoutErrorMessage&&(R=n.timeoutErrorMessage),r(new S(R,b.clarifyTimeoutError?S.ETIMEDOUT:S.ECONNABORTED,n,h)),h=null},Ce.hasStandardBrowserEnv&&(a&&y.isFunction(a)&&(a=a(n)),a||a!==!1&&Rd(f))){const g=n.xsrfHeaderName&&n.xsrfCookieName&&yd.read(n.xsrfCookieName);g&&s.set(n.xsrfHeaderName,g)}i===void 0&&s.setContentType(null),"setRequestHeader"in h&&y.forEach(s.toJSON(),function(R,b){h.setRequestHeader(b,R)}),y.isUndefined(n.withCredentials)||(h.withCredentials=!!n.withCredentials),o&&o!=="json"&&(h.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&h.addEventListener("progress",pi(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",pi(n.onUploadProgress)),(n.cancelToken||n.signal)&&(c=g=>{h&&(r(!g||g.type?new bt(null,n,h):g),h.abort(),h=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const m=bd(f);if(m&&Ce.protocols.indexOf(m)===-1){r(new S("Unsupported protocol "+m+":",S.ERR_BAD_REQUEST,n));return}h.send(i||null)})},$n={http:Gl,xhr:Ed};y.forEach($n,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const gi=n=>`- ${n}`,vd=n=>y.isFunction(n)||n===null||n===!1,ks={getAdapter:n=>{n=y.isArray(n)?n:[n];const{length:e}=n;let t,r;const i={};for(let s=0;s<e;s++){t=n[s];let o;if(r=t,!vd(t)&&(r=$n[(o=String(t)).toLowerCase()],r===void 0))throw new S(`Unknown adapter '${o}'`);if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(gi).join(`
`):" "+gi(s[0]):"as no adapter specified";throw new S("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:$n};function bn(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new bt(null,n)}function mi(n){return bn(n),n.headers=Pe.from(n.headers),n.data=Rn.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),ks.getAdapter(n.adapter||br.adapter)(n).then(function(r){return bn(n),r.data=Rn.call(n,n.transformResponse,r),r.headers=Pe.from(r.headers),r},function(r){return Os(r)||(bn(n),r&&r.response&&(r.response.data=Rn.call(n,n.transformResponse,r.response),r.response.headers=Pe.from(r.response.headers))),Promise.reject(r)})}const yi=n=>n instanceof Pe?n.toJSON():n;function tt(n,e){e=e||{};const t={};function r(l,u,h){return y.isPlainObject(l)&&y.isPlainObject(u)?y.merge.call({caseless:h},l,u):y.isPlainObject(u)?y.merge({},u):y.isArray(u)?u.slice():u}function i(l,u,h){if(y.isUndefined(u)){if(!y.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function s(l,u){if(!y.isUndefined(u))return r(void 0,u)}function o(l,u){if(y.isUndefined(u)){if(!y.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,u)=>i(yi(l),yi(u),!0)};return y.forEach(Object.keys(Object.assign({},n,e)),function(u){const h=c[u]||i,f=h(n[u],e[u],u);y.isUndefined(f)&&h!==a||(t[u]=f)}),t}const Hs="1.6.7",Cr={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Cr[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const wi={};Cr.transitional=function(e,t,r){function i(s,o){return"[Axios v"+Hs+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return(s,o,a)=>{if(e===!1)throw new S(i(o," has been removed"+(t?" in "+t:"")),S.ERR_DEPRECATED);return t&&!wi[o]&&(wi[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Ad(n,e,t){if(typeof n!="object")throw new S("options must be an object",S.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=n[s],c=a===void 0||o(a,s,n);if(c!==!0)throw new S("option "+s+" must be "+c,S.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new S("Unknown option "+s,S.ERR_BAD_OPTION)}}const Vn={assertOptions:Ad,validators:Cr},Oe=Vn.validators;class Qt{constructor(e){this.defaults=e,this.interceptors={request:new hi,response:new hi}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";r.stack?s&&!String(r.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+s):r.stack=s}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=tt(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&Vn.assertOptions(r,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),i!=null&&(y.isFunction(i)?t.paramsSerializer={serialize:i}:Vn.assertOptions(i,{encode:Oe.function,serialize:Oe.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&y.merge(s.common,s[t.method]);s&&y.forEach(["delete","get","head","post","put","patch","common"],m=>{delete s[m]}),t.headers=Pe.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(c=c&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const l=[];this.interceptors.response.forEach(function(g){l.push(g.fulfilled,g.rejected)});let u,h=0,f;if(!c){const m=[mi.bind(this),void 0];for(m.unshift.apply(m,a),m.push.apply(m,l),f=m.length,u=Promise.resolve(t);h<f;)u=u.then(m[h++],m[h++]);return u}f=a.length;let w=t;for(h=0;h<f;){const m=a[h++],g=a[h++];try{w=m(w)}catch(R){g.call(this,R);break}}try{u=mi.call(this,w)}catch(m){return Promise.reject(m)}for(h=0,f=l.length;h<f;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=tt(this.defaults,e);const t=Ls(e.baseURL,e.url);return Ds(t,e.params,e.paramsSerializer)}}y.forEach(["delete","get","head","options"],function(e){Qt.prototype[e]=function(t,r){return this.request(tt(r||{},{method:e,url:t,data:(r||{}).data}))}});y.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(tt(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Qt.prototype[e]=t(),Qt.prototype[e+"Form"]=t(!0)});const Ht=Qt;class Tr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(s,o,a){r.reason||(r.reason=new bt(s,o,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Tr(function(i){e=i}),cancel:e}}}const _d=Tr;function Id(n){return function(t){return n.apply(null,t)}}function Dd(n){return y.isObject(n)&&n.isAxiosError===!0}const Gn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Gn).forEach(([n,e])=>{Gn[e]=n});const Pd=Gn;function Us(n){const e=new Ht(n),t=ys(Ht.prototype.request,e);return y.extend(t,Ht.prototype,e,{allOwnKeys:!0}),y.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return Us(tt(n,i))},t}const k=Us(br);k.Axios=Ht;k.CanceledError=bt;k.CancelToken=_d;k.isCancel=Os;k.VERSION=Hs;k.toFormData=nn;k.AxiosError=S;k.Cancel=k.CanceledError;k.all=function(e){return Promise.all(e)};k.spread=Id;k.isAxiosError=Dd;k.mergeConfig=tt;k.AxiosHeaders=Pe;k.formToJSON=n=>Ms(y.isHTMLForm(n)?new FormData(n):n);k.getAdapter=ks.getAdapter;k.HttpStatusCode=Pd;k.default=k;function rt(n){const e=[],t=/```([\s\S]*?)```/;let r=n;const i=n&&n.match(t);for(i&&i.index===0&&(e.push({type:"code",content:i[1].trim()}),r=r.slice(i[0].length));;){const s=r.match(t);if(!s){r.trim()&&e.push({type:"text",content:r.trim()});break}e.push({type:"code",content:s[1].trim()}),r=r.slice(s.index+s[0].length)}return e}async function Sd(n,e,t){let r=[],i={role:"system",content:"As an AI assistant, your task is to welcome the user to our service. You must explain that you are designed to create a wide variety of written content, customized to their specific needs. You should begin with the first question and wait for the user's response. Remember to take one step at a time. Based on their response, you should ask subsequent question related to the type of content. You need to use the responses to these questions to guide the creation of the content. After collection all the necessary information call the creative_tool function with query parameter containing all the details. (REMEMBER: You will make sure to ask one question at a time to gather the necessary information.)"};return n.messages.push(i),await k.post("https://afscreativechattotfuncapp.azurewebsites.net/api/CreativeTrigger?code=QOEHGggXFMsQ4P7jVClRjINaCYAjGT_3VvIcE4Y1VgBTAzFuRBux2w==",n.messages,{headersCors:t}).then(s=>{console.log("Writting Assistant Triggered!!!"),r.push(rt(s.data.content))}).catch(s=>{console.error(s)}),e(!1),r}async function Md(n,e,t){let r=[],i={role:"system",content:"You are a knowledge assistant dedicated to sharing information and assisting learners. Your responses are informative and designed to aid learning. You offer explanations, examples, and resources to support the learning process. Remember current date is 05/02/2024 (DD/MM/YYYY) and timezone is ${timezone} and for getting latest data you can search the internet using master_search. And finally provide a detailed descriptive answer with source attribution."};return n.messages.push(i),await k.post("https://afsknowledgeassistantddgsfunctionapp.azurewebsites.net/api/KnowledgeTrigger?code=UdyA43lr-fgfTyVP3QXCJyTxFeGRkn2Z20oNKc9QAeNEAzFuAZ_0VA==",n.messages,{headersCors:t}).then(s=>{console.log("Knowledge Assistant Triggered!!!"),r.push(rt(s.data.content))}).catch(s=>{console.error(s)}),e(!1),r}async function Od(n,e,t){let r=[],i={role:"system",content:"You are a Summarization Assistant! As a Summarization Assistant, your task is to create concise and effective summaries of the provided text. Your summaries should contain an executive overview that captures the main essence and a detailed version presented in bullet points. Distilling complex information into clear and concise summaries is crucial for helping users quickly understand the core elements of the content. We appreciate your commitment to producing impactful summaries. To ensure the highest quality responses, always adhere to the guidelines outlined in our comprehensive Summarizing style guide. --- Summarizing Style Guide: **Executive Summary**: Compose a succinct executive summary that encapsulates the key points of the text. **Summary**:  Summarize a major point or idea from the text.  Summarize another important point or concept.  Continue summarizing key aspects of the text.  Highlight additional significant information.  Conclude the summary with any remaining essential insights."};return n.messages.push(i),await k.post("https://afschatsummarizingassistantfuncapp.azurewebsites.net/api/SummarizeTrigger?code=eAIjHlfADl0Njx906CFxuOUkpEErIitEO9JH-mTgn9vzAzFu3AW9wg==",n.messages,{headersCors:t}).then(s=>{console.log("Summary Assistant is Triggered!!!"),r.push(rt(s.data.content))}).catch(s=>{console.error(s)}),e(!1),r}async function Ld(n,e,t){let r=[],i={role:"system",content:"Greetings! You are a multi-faceted AI assistant, a digital polymath with a diverse set of skills designed to cater to a wide array of user needs. As a **Knowledge Assistant**, you are a digital scholar, a fountain of information. You provide detailed explanations, illustrative examples, and valuable resources to support the learning journey of the user. You are connected to the vast expanse of the internet, ready to delve into its depths to fetch the most current and relevant data. As a **Grammar Assistant**, you are a linguistic expert, a guardian of language purity. You help users navigate the complex labyrinth of grammar, ensuring their text is free from errors and their message is conveyed with clarity and precision. As a **Summarizing Assistant**, you are a master of brevity, an essence extractor. You distill lengthy text into concise summaries, capturing the core essence in a nutshell. You can also summarize URLs and links, providing a brief overview of the content they hold. As a **Technical Assistant**, you are a digital problem solver, a code whisperer. You assist users in resolving technology-related queries, decoding programming dilemmas, and understanding complex technical concepts. As a **Writing Assistant**, you are a virtual scribe, a muse in the machine. You assist users in all writing tasks, infusing creativity into words and helping to craft compelling narratives. You are equipped to understand the user's query and determine which assistant's skills are best suited to provide the most relevant and accurate response. You are the embodiment of AI versatility, ready to assist, inform, correct, summarize, solve, and create! Note: Properly differentiate the query of user between grammar assistant and writing assistant. If the user wants to improve or correct his/her grammar, then select grammar assistant on the top over any other. And if the user wants some writing related tasks, then kindly select Writing Assistant. Note: Today's date is 07/02/2024 (DD/MM/YYYY)"};return n.messages.push(i),await k.post("https://afschat-masterfunction.azurewebsites.net/api/MasterTrigger?code=AUJWDrt3pYq4dVTlxzNRsh50-jlRSvl_2sGp6iHLt4vZAzFuWcRsxw==",n.messages,{headersCors:t}).then(s=>{console.log("Master Assistant is Triggered!!!"),r.push(rt(s.data.content))}).catch(s=>{console.error(s)}),e(!1),r}async function kd(n,e,t){let r=[];return await k.post("https://danielingitaraj.openai.azure.com/openai/deployments/DanielGPT4/chat/completions?api-version=2023-07-01-preview",n,{headers:t}).then(i=>{console.log("Technical Assistant is Triggered!!!");const s=i.data;s&&s.choices.map(o=>{r.push(rt(o.message.content))})}).catch(i=>{console.error(i)}),e(!1),r}async function Hd(n,e,t){let r=[],i={role:"system",content:"You are a Grammar Assistant here to help you with any grammar-related questions or concerns I may have. Whether I need assistance with punctuation, sentence structure, or word usage, you here to provide guidance and clarification. Feel free to ask me anything about grammar rules, common mistakes, or improving the clarity of your writing. Let's work together to ensure your communication is polished and error-free!"};return n.messages.push(i),await k.post("https://danielingitaraj.openai.azure.com/openai/deployments/DanielGPT4/chat/completions?api-version=2023-07-01-preview",n,{headers:t}).then(s=>{console.log("Grammer Asistant is Triggered!!!");const o=s.data;o&&o.choices.map(a=>{r.push(rt(a.message.content))})}).catch(s=>{console.error(s)}),e(!1),r}async function Ud(n,e,t){let r=[];const s={"Content-Type":"application/json","api-key":"a5c4e09a50dd4e13a69e7ef19d07b48c"},o={"Content-Type":"application/json","Access-Control-Allow-Origin'":"*",cors:"no-cors"};return e=="0"?r=await Sd(n,t,o):e=="1"?r=await Md(n,t,o):e=="2"?r=await Hd(n,t,s):e=="3"?r=await Od(n,t,o):e=="4"?r=await kd(n,t,s):e=="5"&&(r=await Ld(n,t,o)),r}class xi{constructor(e,t,r,i,s,o){this.userName=e,this.question=t,this.answer=r,this.timestamp=i,this.questiontype=s,this.persona=o}}class Fd{constructor(e,t,r,i){this.userId=e,this.userName=t,this.sessions=r,this.timestamp=i}}class Cn{constructor(e,t,r,i){this.sessionId=e,this.userName=t,this.questions=r,this.timestamp=i}}const Nd="AccountEndpoint=https://testafschatdb.documents.azure.com:443/;AccountKey=uq6mIAbz6sAlXEuj3ieWHnnyvu7qRI9SrL1D3zba98r45qDVZum10wwgefDFL6fi13AdBQe36Zd1ACDbxSTvkg==;",qd=new Nu(Nd),Qe=qd.database("Testing_Purpose").container("test"),Fe=localStorage.getItem("userName"),Fs=()=>{const[n,e]=Z.useState(!1),[t,r]=Z.useState([]),[i,s]=Z.useState([]),[o,a]=Z.useState(0),[c,l]=Z.useState(!0),[u,h]=Z.useState(""),[f,w]=Z.useState(5),[m,g]=Z.useState(!1);let[R,b]=Z.useState([]),I=o;const M=Z.useRef(null),$=async()=>{try{const{resources:L}=await Qe.items.readAll().fetchAll();let N=!1;if(L.forEach(W=>{var fe;W.userName===Fe&&(N=!0,r(W),b(((fe=W.sessions[0])==null?void 0:fe.questions)||[]),s(W.sessions))}),!N){const W=new Date,fe=Ns(),X=new Cn(sn(),Fe,[],W),it=new Fd(fe,Fe,[X],W);await Qe.items.create(it),b([])}}catch(L){console.error("Error retrieving messages from Cosmos DB:",L)}finally{l(!1)}};Z.useEffect(()=>{$()},[]);let Ct=t.sessions&&t.sessions[I];R=Ct&&Ct.questions;const Ns=()=>Math.random().toString(36).substr(2,8),qs=L=>{h(L.target.value)},zs=async(L,N,W,fe,X,it)=>{let on=X.sessions&&X.sessions[it];const Ys=new Date,Xs="New Chat",Zs=new xi(L,W,N,Ys,Xs,fe);on.questions.push(Zs),r(Js=>({...Js,sessions:[on]})),b(on.questions),await Qe.items.upsert(X)},js=()=>{e(!0),setTimeout(()=>{e(!1)},2e3)},sn=()=>Math.random().toString(36).substr(2,8),Bs=()=>{var L;(L=M.current)==null||L.scrollIntoView({behavior:"smooth"})};Z.useEffect(()=>{Bs()},[R]);const Ks=async()=>{try{if(u=="")return;const L={messages:[{role:"user",content:u}]};l(!0);const N=await Ud(L,f,l),W=new Date,fe="New Chat",X=new xi(Fe,u,N,W,fe,f==0?"Writing Assistant":f==1?"Knowledge Assistant":"Simple");t.sessions.length==0&&(t.sessions.push(new Cn(sn(),Fe,[],W)),s(t.sessions)),zs(Fe,N,u,"Assistant",t,I),h("")}catch(L){console.error(L)}},Ws=async L=>{const N=[...R];N.splice(L,1),b(N);let W=t.sessions&&t.sessions[I];W.questions=N,r(t),await Qe.items.upsert(t)},Qs=async L=>{const N=t.sessions;N.splice(L,1),t.sessions=N,s(t.sessions),r(t),g(!0),setTimeout(()=>{g(!1)},1e3),b(N.questions),await Qe.items.upsert(t)};async function $s(){const L=new Date;t.sessions.push(new Cn(sn(),Fe,[],L)),b([]),s(t.sessions),r(t),await Qe.items.upsert(t)}const Vs={display:"flex",borderColor:"white"};function Gs(L){const X=L.replace(/\n/g,"<br>").replace(/\((https?:\/\/[^\s]+)\)/g,"").replace(/\*\*(.*?)\*\*/g,'<h1 style="font-size: 1.5rem">$1</h1>').replace(/`([^`]+)`/g,"<b>$1</b>");return console.log(X),X}return P.jsx("div",{className:"flex flex-col h-screen w-full items-center justify-cneter",children:P.jsxs("div",{className:"flex w-full h-full",children:[P.jsx("div",{className:"w-[20rem]",children:P.jsx(to,{session_no:I,sessionData:i,setSession:a})}),m==!0?P.jsx("div",{className:"w-full h-full flex absolute items-center justify-center z-50",children:P.jsx(Yu,{color:"#FCA5A5",loading:m,cssOverride:Vs,size:250,"aria-label":"Loading Spinner","data-testid":"loader"})}):P.jsxs("div",{className:"flex flex-col bg-gray-200 w-full h-full border gap-4 p-12",children:[P.jsx(eo,{icons:an,handleSessions:$s,handleDeleteSession:Qs}),P.jsxs("div",{className:"gap-4 h-full flex flex-col",children:[P.jsxs("div",{className:"relative flex flex-col w-full h-[65vh] rounded-[1rem] overflow-y-scroll p-4",children:[R&&R.map((L,N)=>P.jsxs("div",{className:"flex relative flex-col bg-black text-white p-12 rounded-[2rem] gap-2 m-2 message",children:[P.jsx("div",{className:"flex justify-end",children:P.jsx("button",{className:"text-center w-32",onClick:()=>Ws(N),children:an.deleteMessage})}),P.jsx("p",{children:P.jsx("b",{children:"User"})}),P.jsx("span",{className:"rounded-xl pb-8",children:L.question}),P.jsx("p",{children:P.jsx("b",{children:"Assistant"})}),L.answer.map((W,fe)=>P.jsx("div",{children:W.map((X,it)=>P.jsx("div",{children:X.type==="code"?P.jsxs("div",{className:"flex flex-col justify-end w-full",children:[P.jsx(pl.CopyToClipboard,{text:X.content,onCopy:js,children:P.jsx("button",{className:"text-right px-8",children:n?"Copied!":"Copy"})}),P.jsx("pre",{className:"bg-gray-300 rounded-xl p-12 m-4 text-black ",children:X.content})]}):P.jsx("div",{className:" text-white",dangerouslySetInnerHTML:{__html:Gs(X.content)}})},it))},fe))]},N)),P.jsx("div",{ref:M})]}),P.jsx("div",{className:"flex ",children:P.jsxs("p",{className:"p-4",children:["Switched to :"," ",f==0?"Writing Assistant":f==1?"Knowledge Assistant":f==2?"Grammer Assistant":f==3?"Summary Assistant":f==4?"TOT Assistant":f==5?"Master Assistant":"Assistant"]})}),P.jsxs("div",{className:"flex h-fit w-full flex-col items-end justify-center",children:[P.jsx("input",{placeholder:"search anything here ...",onChange:qs,value:u,className:"p-4 relative shadow-lg rounded-[2rem] w-full",id:"search"}),P.jsx("button",{className:"absolute px-8",onClick:Ks,type:"submit",children:c?P.jsx("div",{className:"wrapper",children:an.hourGlass}):P.jsx("div",{className:"hover:translate-x-2 hover:ease-in-out hover:transition-all",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28px",height:"28px",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M11.5003 12H5.41872M5.24634 12.7972L4.24158 15.7986C3.69128 17.4424 3.41613 18.2643 3.61359 18.7704C3.78506 19.21 4.15335 19.5432 4.6078 19.6701C5.13111 19.8161 5.92151 19.4604 7.50231 18.7491L17.6367 14.1886C19.1797 13.4942 19.9512 13.1471 20.1896 12.6648C20.3968 12.2458 20.3968 11.7541 20.1896 11.3351C19.9512 10.8529 19.1797 10.5057 17.6367 9.81135L7.48483 5.24303C5.90879 4.53382 5.12078 4.17921 4.59799 4.32468C4.14397 4.45101 3.77572 4.78336 3.60365 5.22209C3.40551 5.72728 3.67772 6.54741 4.22215 8.18767L5.24829 11.2793C5.34179 11.561 5.38855 11.7019 5.407 11.8459C5.42338 11.9738 5.42321 12.1032 5.40651 12.231C5.38768 12.375 5.34057 12.5157 5.24634 12.7972Z",stroke:"#000000","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})})})})]})]})]})]})})},Qd=Fs;Fs.__docgenInfo={description:"",methods:[],displayName:"chatClient"};export{Qd as C};
